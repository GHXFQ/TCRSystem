"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[577],{2577:function(e,a,s){s.r(a),s.d(a,{default:function(){return ae}});var l=s(6768),t=s(4232),i=s(5130),n=s(144),o=s(1219),u=s(788),r=s.n(u);const d={class:"assignments-container"},c={class:"card-header"},v={class:"statistics-row"},f={class:"stat-box"},m={class:"stat-value"},k={class:"stat-box"},b={class:"stat-value"},p={class:"stat-box"},w={class:"stat-value"},g={class:"stat-box"},y={class:"stat-value"},_={key:0,class:"assignments-tip"},h={class:"assignment-detail"},I={class:"detail-row"},L={class:"detail-value description"},F={key:0,class:"detail-row"},W={class:"detail-value"},C={key:0,class:"submit-time"},X={key:1,class:"detail-row"},z={class:"detail-value score"},x={key:2,class:"detail-row"},Q={class:"detail-value comment"},E={key:3,class:"detail-row"},R={class:"detail-value content"},K={key:4,class:"detail-row"},N={class:"detail-value"},V={class:"detail-actions"},P={class:"assignment-title"},S={key:0},D={key:1},$={class:"pagination-container"},U={key:0,class:"submission-form"},A={class:"assignment-info"},B={class:"info-row"},O={class:"info-value"},T={class:"info-row"},M={class:"info-value"},j={key:0,class:"info-row"},J={class:"info-value description"},q={class:"submission-section"},G={class:"submission-notice"},H={class:"dialog-footer"};var Y={__name:"Assignments",setup(e){const a=(0,n.KR)(!1),s=(0,n.KR)(!1),u=(0,n.KR)([]),Y=(0,n.KR)([]),Z=(0,n.KR)(0),ee=(0,n.KR)(!1),ae=(0,n.KR)(null),se=(0,n.KR)([]),le=(0,n.KR)({}),te=(0,n.KR)({}),ie=(0,n.Kh)({current:1,pageSize:10,courseId:null,status:null}),ne=(0,n.KR)(null),oe=(0,n.Kh)({assignmentId:null,content:"",filePath:"",fileName:""}),ue=(0,l.EW)((()=>ie.courseId)),re=e=>{switch(e){case 0:return"danger";case 1:return"primary";case 2:return"success";default:return"info"}},de=e=>{switch(e){case 0:return"已关闭";case 1:return"进行中";case 2:return"已结束";default:return"未知"}},ce=e=>{switch(e){case 0:return"info";case 1:return"warning";case 2:return"success";default:return"info"}},ve=e=>{switch(e){case 0:return"未提交";case 1:return"已提交";case 2:return"已批改";default:return"未知"}},fe=e=>0===e.status?"已关闭":2===e.status?"已结束":e.submissionInfo&&2===e.submissionInfo.status?"已批改":"提交",me=e=>{if(!e||!e.deadline)return!1;const a=new Date,s=new Date(e.deadline),l=(s-a)/36e5;return 1===e.status&&l>0&&l<24},ke=e=>me(e),be=e=>{if(!e||!e.deadline)return!1;const a=new Date,s=new Date(e.deadline);return a>s},pe=e=>1===e.status,we=async()=>{try{const e=JSON.parse(localStorage.getItem("userInfo")||"{}"),a=e.id;if(!a)return void o.nk.warning("无法获取用户信息，请重新登录");const s=await r().get(`/api/course/student/${a}`);Y.value=s.data.data||[]}catch(e){console.error("获取课程列表失败:",e),o.nk.error("获取课程列表失败")}},ge=async()=>{a.value=!0;try{const e={current:ie.current,size:ie.pageSize,courseId:ie.courseId,status:ie.status},a=await r().get("/api/assignment/student/list",{params:e});200===a.data.code?(u.value=a.data.data.records||[],Z.value=a.data.data.total||0,u.value.forEach((e=>{e.isUrgent=me(e)}))):o.nk.error(a.data.message||"获取作业列表失败")}catch(e){console.error("获取作业列表失败:",e),o.nk.error("获取作业列表失败："+(e.response?.data?.message||e.message))}finally{a.value=!1}},ye=async()=>{if(ie.courseId)try{const e=await r().get(`/api/assignment/student/completion-rate?courseId=${ie.courseId}`);200===e.data.code&&(te.value=e.data.data||{})}catch(e){console.error("获取统计数据失败:",e),o.nk.error("获取统计数据失败")}else te.value={}},_e=()=>{ie.courseId=null,ie.status=null,ie.current=1,ge(),te.value={}},he=()=>{ie.current=1,ge(),ye()},Ie=e=>{ie.current=e,ge()},Le=e=>{ie.pageSize=e,ie.current=1,ge()},Fe=e=>{console.log("点击作业:",e)},We=e=>{ae.value=e,oe.assignmentId=e.id,oe.content=e.submissionInfo?.content||"",oe.filePath="",oe.fileName="",se.value=[],e.submissionInfo?.filePath&&e.submissionInfo?.fileName&&(se.value=[{name:e.submissionInfo.fileName,url:`/api/assignment/submission/download/${e.submissionInfo.id}`}]);const a=localStorage.getItem("token");a&&(le.value={Authorization:`Bearer ${a}`}),ee.value=!0},Ce=e=>{const a=10485760;return!(e.size>a)||(o.nk.error("文件大小不能超过10MB"),!1)},Xe=e=>{200===e.code?(o.nk.success("文件上传成功"),oe.filePath=e.data.filePath,oe.fileName=e.data.fileName):o.nk.error(e.message||"文件上传失败")},ze=e=>{console.error("文件上传失败:",e),o.nk.error("文件上传失败")},xe=()=>{oe.filePath="",oe.fileName=""},Qe=async()=>{if(oe.content||oe.filePath){s.value=!0;try{const e=new FormData;e.append("assignmentId",oe.assignmentId),e.append("content",oe.content||""),oe.filePath&&(e.append("filePath",oe.filePath),e.append("fileName",oe.fileName));const a=await r().post("/api/assignment/submit",e,{headers:{"Content-Type":"multipart/form-data"}});200===a.data.code?(o.nk.success("作业提交成功"),ee.value=!1,ge(),ye()):o.nk.error(a.data.message||"作业提交失败")}catch(e){console.error("作业提交失败:",e),o.nk.error("作业提交失败："+(e.response?.data?.message||e.message))}finally{s.value=!1}}else o.nk.warning("请至少提供文本内容或上传文件")};return(0,l.sV)((async()=>{await we(),await ge()})),(e,n)=>{const o=(0,l.g2)("el-tag"),r=(0,l.g2)("el-card"),we=(0,l.g2)("el-option"),ye=(0,l.g2)("el-select"),Ee=(0,l.g2)("el-form-item"),Re=(0,l.g2)("el-button"),Ke=(0,l.g2)("el-form"),Ne=(0,l.g2)("el-empty"),Ve=(0,l.g2)("el-link"),Pe=(0,l.g2)("el-table-column"),Se=(0,l.g2)("el-table"),De=(0,l.g2)("el-pagination"),$e=(0,l.g2)("el-input"),Ue=(0,l.g2)("el-upload"),Ae=(0,l.g2)("el-alert"),Be=(0,l.g2)("el-dialog"),Oe=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",d,[n[30]||(n[30]=(0,l.Lk)("h1",null,"课程作业",-1)),ue.value?((0,l.uX)(),(0,l.Wv)(r,{key:0,class:"statistics-card"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",c,[n[5]||(n[5]=(0,l.Lk)("span",null,"课程完成情况",-1)),te.value.completionRate?((0,l.uX)(),(0,l.Wv)(o,{key:0,type:"success"},{default:(0,l.k6)((()=>[(0,l.eW)("完成率: "+(0,t.v_)(te.value.completionRate),1)])),_:1})):(0,l.Q3)("",!0)])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",v,[(0,l.Lk)("div",f,[(0,l.Lk)("div",m,(0,t.v_)(te.value.totalAssignments||0),1),n[6]||(n[6]=(0,l.Lk)("div",{class:"stat-label"},"总作业数",-1))]),(0,l.Lk)("div",k,[(0,l.Lk)("div",b,(0,t.v_)(te.value.submittedCount||0),1),n[7]||(n[7]=(0,l.Lk)("div",{class:"stat-label"},"已提交数",-1))]),(0,l.Lk)("div",p,[(0,l.Lk)("div",w,(0,t.v_)(te.value.gradedCount||0),1),n[8]||(n[8]=(0,l.Lk)("div",{class:"stat-label"},"已批改数",-1))]),(0,l.Lk)("div",g,[(0,l.Lk)("div",y,(0,t.v_)(te.value.averageScore||"暂无"),1),n[9]||(n[9]=(0,l.Lk)("div",{class:"stat-label"},"平均分",-1))])])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(r,{class:"filter-card"},{default:(0,l.k6)((()=>[(0,l.bF)(Ke,{inline:!0,model:ie,class:"filter-form"},{default:(0,l.k6)((()=>[(0,l.bF)(Ee,{label:"课程"},{default:(0,l.k6)((()=>[(0,l.bF)(ye,{modelValue:ie.courseId,"onUpdate:modelValue":n[0]||(n[0]=e=>ie.courseId=e),placeholder:"选择课程",clearable:"",filterable:"",style:{width:"220px"},onChange:he},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Y.value,(e=>((0,l.uX)(),(0,l.Wv)(we,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(Ee,{label:"状态"},{default:(0,l.k6)((()=>[(0,l.bF)(ye,{modelValue:ie.status,"onUpdate:modelValue":n[1]||(n[1]=e=>ie.status=e),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:(0,l.k6)((()=>[(0,l.bF)(we,{label:"进行中",value:1}),(0,l.bF)(we,{label:"已结束",value:2}),(0,l.bF)(we,{label:"已关闭",value:0})])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(Ee,null,{default:(0,l.k6)((()=>[(0,l.bF)(Re,{type:"primary",onClick:ge},{default:(0,l.k6)((()=>n[10]||(n[10]=[(0,l.eW)("查询")]))),_:1}),(0,l.bF)(Re,{onClick:_e},{default:(0,l.k6)((()=>n[11]||(n[11]=[(0,l.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(r,{class:"assignments-card"},{default:(0,l.k6)((()=>[u.value.length||a.value?((0,l.uX)(),(0,l.Wv)(Se,{key:1,data:u.value,style:{width:"100%"},border:"",onRowClick:Fe},{default:(0,l.k6)((()=>[(0,l.bF)(Pe,{type:"expand"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",h,[(0,l.Lk)("div",I,[n[12]||(n[12]=(0,l.Lk)("div",{class:"detail-label"},"作业描述：",-1)),(0,l.Lk)("div",L,(0,t.v_)(e.row.description||"无"),1)]),e.row.submissionInfo?((0,l.uX)(),(0,l.CE)("div",F,[n[13]||(n[13]=(0,l.Lk)("div",{class:"detail-label"},"提交状态：",-1)),(0,l.Lk)("div",W,[(0,l.bF)(o,{type:ce(e.row.submissionInfo.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(ve(e.row.submissionInfo.status)),1)])),_:2},1032,["type"]),e.row.submissionInfo.status>0?((0,l.uX)(),(0,l.CE)("span",C," 提交时间: "+(0,t.v_)(e.row.submissionInfo.submitTime),1)):(0,l.Q3)("",!0),e.row.submissionInfo.status>0?((0,l.uX)(),(0,l.Wv)(o,{key:1,type:e.row.submissionInfo.isOverdue?"danger":"success",size:"small",style:{"margin-left":"10px"}},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(e.row.submissionInfo.isOverdue?"已逾期":"按时提交"),1)])),_:2},1032,["type"])):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0),e.row.submissionInfo&&2===e.row.submissionInfo.status?((0,l.uX)(),(0,l.CE)("div",X,[n[14]||(n[14]=(0,l.Lk)("div",{class:"detail-label"},"得分：",-1)),(0,l.Lk)("div",z,(0,t.v_)(e.row.submissionInfo.score)+" / "+(0,t.v_)(e.row.maxScore||100),1)])):(0,l.Q3)("",!0),e.row.submissionInfo&&e.row.submissionInfo.comment?((0,l.uX)(),(0,l.CE)("div",x,[n[15]||(n[15]=(0,l.Lk)("div",{class:"detail-label"},"教师评语：",-1)),(0,l.Lk)("div",Q,(0,t.v_)(e.row.submissionInfo.comment),1)])):(0,l.Q3)("",!0),e.row.submissionInfo&&e.row.submissionInfo.content?((0,l.uX)(),(0,l.CE)("div",E,[n[16]||(n[16]=(0,l.Lk)("div",{class:"detail-label"},"提交内容：",-1)),(0,l.Lk)("div",R,(0,t.v_)(e.row.submissionInfo.content),1)])):(0,l.Q3)("",!0),e.row.submissionInfo&&e.row.submissionInfo.filePath?((0,l.uX)(),(0,l.CE)("div",K,[n[17]||(n[17]=(0,l.Lk)("div",{class:"detail-label"},"提交文件：",-1)),(0,l.Lk)("div",N,[(0,l.bF)(Ve,{href:`/api/assignment/submission/download/${e.row.submissionInfo.id}`,target:"_blank",type:"primary"},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(e.row.submissionInfo.fileName||"下载文件"),1)])),_:2},1032,["href"])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",V,[pe(e.row)?((0,l.uX)(),(0,l.Wv)(Re,{key:0,type:"primary",onClick:(0,i.D$)((a=>We(e.row)),["stop"])},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(e.row.submissionInfo&&e.row.submissionInfo.status>0?"重新提交":"提交作业"),1)])),_:2},1032,["onClick"])):(0,l.Q3)("",!0)])])])),_:1}),(0,l.bF)(Pe,{prop:"title",label:"作业标题","min-width":"200","show-overflow-tooltip":""},{default:(0,l.k6)((e=>[(0,l.Lk)("div",P,[(0,l.eW)((0,t.v_)(e.row.title)+" ",1),me(e.row)?((0,l.uX)(),(0,l.Wv)(o,{key:0,type:"danger",size:"small",effect:"dark",style:{"margin-left":"8px"}},{default:(0,l.k6)((()=>n[18]||(n[18]=[(0,l.eW)("紧急")]))),_:1})):(0,l.Q3)("",!0)])])),_:1}),(0,l.bF)(Pe,{prop:"courseName",label:"所属课程",width:"180","show-overflow-tooltip":""}),(0,l.bF)(Pe,{prop:"deadline",label:"截止时间",width:"180"}),(0,l.bF)(Pe,{prop:"status",label:"状态",width:"100"},{default:(0,l.k6)((e=>[(0,l.bF)(o,{type:re(e.row.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(de(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,l.bF)(Pe,{label:"提交状态",width:"120"},{default:(0,l.k6)((e=>[e.row.submissionInfo?((0,l.uX)(),(0,l.Wv)(o,{key:0,type:ce(e.row.submissionInfo.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(ve(e.row.submissionInfo.status)),1)])),_:2},1032,["type"])):((0,l.uX)(),(0,l.Wv)(o,{key:1,type:"info"},{default:(0,l.k6)((()=>n[19]||(n[19]=[(0,l.eW)("未提交")]))),_:1}))])),_:1}),(0,l.bF)(Pe,{label:"得分",width:"100",align:"center"},{default:(0,l.k6)((e=>[e.row.submissionInfo&&2===e.row.submissionInfo.status?((0,l.uX)(),(0,l.CE)("span",S,(0,t.v_)(e.row.submissionInfo.score),1)):((0,l.uX)(),(0,l.CE)("span",D,"-"))])),_:1}),(0,l.bF)(Pe,{prop:"createTime",label:"发布时间",width:"180"}),(0,l.bF)(Pe,{label:"操作",width:"120",fixed:"right"},{default:(0,l.k6)((e=>[pe(e.row)?((0,l.uX)(),(0,l.Wv)(Re,{key:0,type:"primary",size:"small",plain:"",onClick:(0,i.D$)((a=>We(e.row)),["stop"])},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(e.row.submissionInfo&&e.row.submissionInfo.status>0?"重新提交":"提交"),1)])),_:2},1032,["onClick"])):((0,l.uX)(),(0,l.Wv)(Re,{key:1,type:"info",size:"small",plain:"",disabled:""},{default:(0,l.k6)((()=>[(0,l.eW)((0,t.v_)(fe(e.row)),1)])),_:2},1024))])),_:1})])),_:1},8,["data"])):((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(Ne,{description:"暂无符合条件的作业"})])),(0,l.Lk)("div",$,[(0,l.bF)(De,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:Z.value,"page-sizes":[10,20,50,100],"page-size":ie.pageSize,"current-page":ie.current,onSizeChange:Le,onCurrentChange:Ie},null,8,["total","page-size","current-page"])])])),_:1})),[[Oe,a.value]]),(0,l.bF)(Be,{modelValue:ee.value,"onUpdate:modelValue":n[4]||(n[4]=e=>ee.value=e),title:"提交作业",width:"600px","close-on-click-modal":!1},{footer:(0,l.k6)((()=>[(0,l.Lk)("span",H,[(0,l.bF)(Re,{onClick:n[3]||(n[3]=e=>ee.value=!1)},{default:(0,l.k6)((()=>n[28]||(n[28]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(Re,{type:"primary",onClick:Qe,loading:s.value},{default:(0,l.k6)((()=>n[29]||(n[29]=[(0,l.eW)("提交")]))),_:1},8,["loading"])])])),default:(0,l.k6)((()=>[ae.value?((0,l.uX)(),(0,l.CE)("div",U,[(0,l.Lk)("div",A,[n[24]||(n[24]=(0,l.Lk)("h3",null,"作业信息",-1)),(0,l.Lk)("div",B,[n[20]||(n[20]=(0,l.Lk)("div",{class:"info-label"},"标题",-1)),(0,l.Lk)("div",O,(0,t.v_)(ae.value.title),1)]),(0,l.Lk)("div",T,[n[22]||(n[22]=(0,l.Lk)("div",{class:"info-label"},"截止时间",-1)),(0,l.Lk)("div",M,[(0,l.eW)((0,t.v_)(ae.value.deadline)+" ",1),me(ae.value)?((0,l.uX)(),(0,l.Wv)(o,{key:0,type:"danger",size:"small",effect:"dark",style:{"margin-left":"8px"}},{default:(0,l.k6)((()=>n[21]||(n[21]=[(0,l.eW)("即将截止")]))),_:1})):(0,l.Q3)("",!0)])]),ae.value.description?((0,l.uX)(),(0,l.CE)("div",j,[n[23]||(n[23]=(0,l.Lk)("div",{class:"info-label"},"描述",-1)),(0,l.Lk)("div",J,(0,t.v_)(ae.value.description),1)])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",q,[n[27]||(n[27]=(0,l.Lk)("h3",null,"提交内容",-1)),(0,l.bF)(Ke,{model:oe,ref_key:"submissionFormRef",ref:ne,"label-width":"80px"},{default:(0,l.k6)((()=>[(0,l.bF)(Ee,{label:"文本内容"},{default:(0,l.k6)((()=>[(0,l.bF)($e,{modelValue:oe.content,"onUpdate:modelValue":n[2]||(n[2]=e=>oe.content=e),type:"textarea",rows:6,placeholder:"请输入作业内容"},null,8,["modelValue"])])),_:1}),(0,l.bF)(Ee,{label:"上传文件"},{default:(0,l.k6)((()=>[(0,l.bF)(Ue,{class:"upload-area",action:"/api/assignment/submission/upload",headers:le.value,"on-success":Xe,"on-error":ze,"before-upload":Ce,limit:1,"file-list":se.value,"on-remove":xe},{tip:(0,l.k6)((()=>n[26]||(n[26]=[(0,l.Lk)("div",{class:"el-upload__tip"}," 支持任意格式文件，单个文件不超过10MB ",-1)]))),default:(0,l.k6)((()=>[(0,l.bF)(Re,{type:"primary"},{default:(0,l.k6)((()=>n[25]||(n[25]=[(0,l.eW)("选择文件")]))),_:1})])),_:1},8,["headers","file-list"])])),_:1})])),_:1},8,["model"]),(0,l.Lk)("div",G,[ke(ae.value)?((0,l.uX)(),(0,l.Wv)(Ae,{key:0,title:"警告：此作业即将截止，请尽快提交",type:"warning",closable:!1,"show-icon":""})):(0,l.Q3)("",!0),be(ae.value)?((0,l.uX)(),(0,l.Wv)(Ae,{key:1,title:"注意：此作业已过截止时间，将被标记为逾期提交",type:"error",closable:!1,"show-icon":""})):(0,l.Q3)("",!0)])])])):(0,l.Q3)("",!0)])),_:1},8,["modelValue"])])}}},Z=s(1241);const ee=(0,Z.A)(Y,[["__scopeId","data-v-11312528"]]);var ae=ee}}]);
//# sourceMappingURL=577.446784fc.js.map