"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[238],{3238:function(e,a,l){l.r(a),l.d(a,{default:function(){return x}});var t=l(6768),r=l(4232),s=l(144),c=l(2933),n=l(1219),o=l(788),d=l.n(o);const u={class:"feedback-container"},i={key:0,class:"filter-info"},k={key:0,class:"feedback-list"},v={class:"feedback-header"},p={class:"user-info"},g={class:"avatar-container"},m={class:"user-name"},f={class:"feedback-actions"},y={class:"feedback-time"},h={class:"feedback-content"},b={key:0,class:"reply-list"},_={class:"reply-header"},I={class:"user-info"},C={class:"avatar-container"},L={class:"user-name-above"},w={class:"user-name"},F={class:"reply-actions"},X={class:"reply-time"},W={class:"reply-content"},z={class:"reply-form"},K={key:1,class:"empty-block"},E={key:2,class:"pagination-container"};var V={__name:"CourseFeedback",setup(e){const a=e=>e?e.startsWith("http")?e:`http://localhost:8080${e}`:"",l=(0,s.KR)(0),o=(0,s.KR)(!1),V=(0,s.KR)([]),N=(0,s.KR)([]),S=(0,s.KR)(!1),x=(0,s.KR)(0),R=(0,s.Kh)({}),Q=(0,s.Kh)({pageNum:1,pageSize:10,courseId:void 0}),A=()=>{try{const e=JSON.parse(localStorage.getItem("userInfo")||"{}");l.value=e.id,o.value=2===e.role,console.log("当前用户ID:",l.value,"角色:",e.role)}catch(e){console.error("获取用户信息失败:",e)}},$=e=>(e.id&&!e.userName&&console.warn(`ID为${e.id}的${e.parentId?"回复":"反馈"}没有用户名`,e),e.userName||"匿名用户"),T=e=>{if(!e)return"";try{const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("日期格式化错误:",a),e}},U=e=>e.userId===l.value||o.value,D=async e=>{try{await c.s.confirm("确定要删除这条内容吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await d()["delete"](`/api/feedback/${e}`);200===a.data.code?(n.nk.success("删除成功"),J()):n.nk.error(a.data.message||"删除失败")}catch(a){"cancel"!==a&&(console.error("删除失败:",a),n.nk.error("删除失败"))}},B=async()=>{try{const e=JSON.parse(localStorage.getItem("userInfo")||"{}"),a=e.id,l=await d().get(`/api/course/teacher/${a}`);V.value=l.data.data||[],V.value.length>0&&!Q.courseId&&(Q.courseId=V.value[0].id,await J())}catch(e){console.error("获取课程列表失败:",e),n.nk.error("获取课程列表失败")}},J=async()=>{if(!Q.courseId)return N.value=[],void(x.value=0);S.value=!0;try{const e=await d().get("/api/feedback/list",{params:Q});console.log("反馈列表原始数据:",e.data.data),N.value=e.data.data.records||[],console.log("反馈列表处理后数据:",N.value),x.value=e.data.data.total||0}catch(e){console.error("获取反馈列表失败:",e),n.nk.error("获取反馈列表失败")}finally{S.value=!1}},O=()=>{Q.courseId=void 0,N.value=[],x.value=0},j=()=>{J()},q=e=>{Q.pageNum=e,J()},G=e=>{Q.pageSize=e,J()},H=async e=>{const a=R[e];if(a&&""!==a.trim())try{const l=await d().post("/api/feedback/reply",{content:a,courseId:Q.courseId,parentId:e});200===l.data.code?(n.nk.success("回复提交成功"),R[e]="",J()):n.nk.error(l.data.message||"回复提交失败")}catch(l){console.error("提交回复失败:",l),n.nk.error("提交回复失败")}else n.nk.warning("请输入回复内容")},M=(0,s.KR)(null),P=(0,s.Kh)({content:""}),Y={content:[{required:!0,message:"请输入反馈内容",trigger:"blur"},{min:2,max:500,message:"长度在2到500个字符之间",trigger:"blur"}]},Z=()=>{Q.courseId?M.value.validate((async e=>{if(e)try{const e=await d().post("/api/feedback/add",{content:P.content,courseId:Q.courseId});200===e.data.code?(n.nk.success("反馈发布成功"),P.content="",J()):n.nk.error(e.data.message||"反馈发布失败")}catch(a){console.error("提交反馈失败:",a),n.nk.error("提交反馈失败")}})):n.nk.warning("请先选择课程")};return(0,t.sV)((()=>{A(),B()})),(e,s)=>{const c=(0,t.g2)("el-option"),n=(0,t.g2)("el-select"),d=(0,t.g2)("el-form-item"),A=(0,t.g2)("el-col"),B=(0,t.g2)("el-row"),ee=(0,t.g2)("el-tag"),ae=(0,t.g2)("el-button"),le=(0,t.g2)("el-card"),te=(0,t.g2)("el-input"),re=(0,t.g2)("el-form"),se=(0,t.g2)("el-avatar"),ce=(0,t.g2)("el-empty"),ne=(0,t.g2)("el-pagination"),oe=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",u,[s[13]||(s[13]=(0,t.Lk)("h1",null,"课程反馈管理",-1)),(0,t.bF)(le,{class:"filter-card"},{header:(0,t.k6)((()=>s[2]||(s[2]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"反馈过滤")],-1)]))),default:(0,t.k6)((()=>[(0,t.bF)(B,{gutter:20},{default:(0,t.k6)((()=>[(0,t.bF)(A,{span:8},{default:(0,t.k6)((()=>[(0,t.bF)(d,{label:"选择课程"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:Q.courseId,"onUpdate:modelValue":s[0]||(s[0]=e=>Q.courseId=e),placeholder:"请选择课程",clearable:"",onChange:j,style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.value,(e=>((0,t.uX)(),(0,t.Wv)(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Q.courseId?((0,t.uX)(),(0,t.CE)("div",i,[s[5]||(s[5]=(0,t.Lk)("span",null,"当前过滤：",-1)),Q.courseId?((0,t.uX)(),(0,t.Wv)(ee,{key:0,class:"filter-tag"},{default:(0,t.k6)((()=>[(0,t.eW)(" 课程："+(0,r.v_)(V.value.find((e=>e.id===Q.courseId))?.name),1)])),_:1})):(0,t.Q3)("",!0),(0,t.bF)(ae,{type:"primary",size:"small",onClick:J},{default:(0,t.k6)((()=>s[3]||(s[3]=[(0,t.eW)("刷新数据")]))),_:1}),(0,t.bF)(ae,{size:"small",onClick:O},{default:(0,t.k6)((()=>s[4]||(s[4]=[(0,t.eW)("重置")]))),_:1})])):(0,t.Q3)("",!0)])),_:1}),Q.courseId?((0,t.uX)(),(0,t.Wv)(le,{key:0,class:"add-feedback-card"},{header:(0,t.k6)((()=>s[6]||(s[6]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"创建新话题")],-1)]))),default:(0,t.k6)((()=>[(0,t.bF)(re,{ref_key:"feedbackFormRef",ref:M,model:P,rules:Y},{default:(0,t.k6)((()=>[(0,t.bF)(d,{prop:"content"},{default:(0,t.k6)((()=>[(0,t.bF)(te,{modelValue:P.content,"onUpdate:modelValue":s[1]||(s[1]=e=>P.content=e),type:"textarea",rows:"3",placeholder:"输入新话题内容...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,null,{default:(0,t.k6)((()=>[(0,t.bF)(ae,{type:"primary",onClick:Z},{default:(0,t.k6)((()=>s[7]||(s[7]=[(0,t.eW)("发布话题")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1})):(0,t.Q3)("",!0),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(le,{class:"feedback-list-card"},{header:(0,t.k6)((()=>s[8]||(s[8]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"反馈列表")],-1)]))),default:(0,t.k6)((()=>[N.value.length>0?((0,t.uX)(),(0,t.CE)("div",k,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(N.value,(e=>((0,t.uX)(),(0,t.CE)("div",{class:"feedback-item",key:e.id},[(0,t.Lk)("div",v,[(0,t.Lk)("div",p,[(0,t.Lk)("div",g,[s[9]||(s[9]=(0,t.Lk)("div",{class:"user-name-above"},"用户",-1)),(0,t.bF)(se,{size:40,src:a(e.userAvatar)},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)($(e).charAt(0)),1)])),_:2},1032,["src"])]),(0,t.Lk)("div",m,(0,r.v_)($(e)),1)]),(0,t.Lk)("div",f,[(0,t.Lk)("span",y,(0,r.v_)(T(e.createTime)),1),o.value?((0,t.uX)(),(0,t.Wv)(ae,{key:0,type:"danger",size:"small",onClick:a=>D(e.id)},{default:(0,t.k6)((()=>s[10]||(s[10]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"])):(0,t.Q3)("",!0)])]),(0,t.Lk)("div",h,(0,r.v_)(e.content),1),e.children&&e.children.length>0?((0,t.uX)(),(0,t.CE)("div",b,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.children,(e=>((0,t.uX)(),(0,t.CE)("div",{class:"reply-item",key:e.id},[(0,t.Lk)("div",_,[(0,t.Lk)("div",I,[(0,t.Lk)("div",C,[(0,t.Lk)("div",L,(0,r.v_)(e.userId===l.value?"我":"用户"),1),(0,t.bF)(se,{size:30,src:a(e.userAvatar)},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)($(e).charAt(0)),1)])),_:2},1032,["src"])]),(0,t.Lk)("div",w,(0,r.v_)($(e)),1)]),(0,t.Lk)("div",F,[(0,t.Lk)("span",X,(0,r.v_)(T(e.createTime)),1),U(e)?((0,t.uX)(),(0,t.Wv)(ae,{key:0,type:"danger",size:"small",onClick:a=>D(e.id)},{default:(0,t.k6)((()=>s[11]||(s[11]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"])):(0,t.Q3)("",!0)])]),(0,t.Lk)("div",W,(0,r.v_)(e.content),1)])))),128))])):(0,t.Q3)("",!0),(0,t.Lk)("div",z,[(0,t.bF)(te,{modelValue:R[e.id],"onUpdate:modelValue":a=>R[e.id]=a,type:"textarea",rows:"2",placeholder:"输入回复内容...",maxlength:"500","show-word-limit":"",style:{width:"90%"}},null,8,["modelValue","onUpdate:modelValue"]),(0,t.bF)(ae,{type:"primary",onClick:a=>H(e.id)},{default:(0,t.k6)((()=>s[12]||(s[12]=[(0,t.eW)("回复")]))),_:2},1032,["onClick"])])])))),128))])):((0,t.uX)(),(0,t.CE)("div",K,[(0,t.bF)(ce,{description:"暂无反馈数据"})])),x.value>0?((0,t.uX)(),(0,t.CE)("div",E,[(0,t.bF)(ne,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:x.value,"page-size":Q.pageSize,"current-page":Q.pageNum,"page-sizes":[10,20,50,100],onCurrentChange:q,onSizeChange:G},null,8,["total","page-size","current-page"])])):(0,t.Q3)("",!0)])),_:1})),[[oe,S.value]])])}}},N=l(1241);const S=(0,N.A)(V,[["__scopeId","data-v-f15ef3c0"]]);var x=S}}]);
//# sourceMappingURL=238.5fb8c95a.js.map