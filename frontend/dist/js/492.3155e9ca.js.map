{"version":3,"file":"js/492.3155e9ca.js","mappings":"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","sources":["webpack://tcr-system-frontend/./src/views/student/AssignmentDetail.vue","webpack://tcr-system-frontend/./src/views/student/AssignmentDetail.vue?b3c7"],"sourcesContent":["<template>\n  <div class=\"assignment-detail\">\n    <div class=\"page-header\">\n      <el-page-header @back=\"goBack\" :title=\"assignment.courseName || '课程作业'\" :content=\"assignment.title || '作业详情'\" />\n    </div>\n    \n    <el-card v-loading=\"loading\" class=\"assignment-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <span>作业详情</span>\n          <div>\n            <el-tag :type=\"getStatusTag(assignment.status)\">{{ getStatusLabel(assignment.status) }}</el-tag>\n            <el-tag v-if=\"submission.id\" type=\"success\" class=\"ml-10\">已提交</el-tag>\n            <el-tag v-else type=\"danger\" class=\"ml-10\">未提交</el-tag>\n          </div>\n        </div>\n      </template>\n      \n      <div class=\"assignment-info\">\n        <h2>{{ assignment.title }}</h2>\n        <div class=\"meta-info\">\n          <span>课程：{{ assignment.courseName }}</span>\n          <span>教师：{{ assignment.teacherName }}</span>\n          <span>截止日期：{{ formatDate(assignment.deadline) }}</span>\n          <span v-if=\"submission.score !== null && submission.score !== undefined\">得分：{{ submission.score }}</span>\n        </div>\n        \n        <div class=\"description\">\n          <h3>作业描述</h3>\n          <div class=\"description-content\">{{ assignment.description }}</div>\n        </div>\n        \n        <div class=\"submission-section\" v-if=\"submission.id\">\n          <h3>我的提交</h3>\n          <div class=\"submission-info\">\n            <p><strong>提交时间：</strong>{{ formatDate(submission.createTime) }}</p>\n            <p v-if=\"submission.filePath\"><strong>提交文件：</strong>{{ submission.fileName }} \n              <el-button type=\"primary\" size=\"small\" @click=\"downloadFile(submission.id)\">下载</el-button>\n            </p>\n            <div class=\"submission-content\">\n              <p><strong>提交内容：</strong></p>\n              <div class=\"content-box\">{{ submission.content }}</div>\n            </div>\n            <div v-if=\"submission.status === 1\" class=\"feedback\">\n              <p><strong>教师评语：</strong></p>\n              <div class=\"content-box\">{{ submission.comment || '无评语' }}</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"submit-form\" v-else>\n          <h3>提交作业</h3>\n          <el-form :model=\"submitForm\" label-width=\"100px\">\n            <el-form-item label=\"提交内容\">\n              <el-input \n                v-model=\"submitForm.content\" \n                type=\"textarea\" \n                :rows=\"6\" \n                placeholder=\"请输入作业内容\"\n              ></el-input>\n            </el-form-item>\n            <el-form-item label=\"上传文件\">\n              <el-upload\n                class=\"upload-demo\"\n                :action=\"`/api/assignment/submission/upload`\"\n                :headers=\"uploadHeaders\"\n                :on-success=\"handleUploadSuccess\"\n                :on-error=\"handleUploadError\"\n                :before-upload=\"beforeUpload\"\n                :file-list=\"fileList\"\n                :limit=\"1\"\n              >\n                <el-button type=\"primary\">点击上传</el-button>\n                <template #tip>\n                  <div class=\"el-upload__tip\">\n                    支持任意类型文件，单个文件不超过50MB\n                    <div v-if=\"submitForm.filePath\" class=\"uploaded-file\">\n                      已上传: {{ submitForm.fileName }}\n                    </div>\n                  </div>\n                </template>\n              </el-upload>\n            </el-form-item>\n            <el-form-item>\n              <el-button type=\"primary\" @click=\"submitAssignment\" :loading=\"submitting\">提交作业</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport axios from 'axios'\nimport { ElMessage } from 'element-plus'\n\nconst router = useRouter()\nconst route = useRoute()\nconst assignmentId = ref(route.params.id)\n\n// 数据对象\nconst assignment = ref({})\nconst submission = ref({})\nconst loading = ref(false)\nconst submitting = ref(false)\n\n// 提交表单\nconst submitForm = reactive({\n  content: '',\n  filePath: '',\n  fileSize: 0,\n  fileType: '',\n  fileName: ''\n})\n\n// 文件上传相关\nconst fileList = ref([])\nconst uploadHeaders = reactive({\n  Authorization: `Bearer ${localStorage.getItem('token')}`\n})\n\n// 初始化\nonMounted(() => {\n  fetchAssignmentDetail()\n})\n\n// 获取作业详情\nconst fetchAssignmentDetail = async () => {\n  loading.value = true\n  try {\n    // 获取作业详情\n    const assignmentResponse = await axios.get(`/api/assignment/${assignmentId.value}`)\n    if (assignmentResponse.data.code === 200) {\n      assignment.value = assignmentResponse.data.data || {}\n      \n      // 获取提交详情\n      const submissionResponse = await axios.get(`/api/assignment/submission/assignment/${assignmentId.value}`)\n      if (submissionResponse.data.code === 200) {\n        submission.value = submissionResponse.data.data || {}\n      }\n    } else {\n      ElMessage.error(assignmentResponse.data.message || '获取作业详情失败')\n    }\n  } catch (error) {\n    console.error('获取作业详情失败:', error)\n    ElMessage.error('获取作业详情失败')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 提交作业\nconst submitAssignment = async () => {\n  if (!submitForm.content && !submitForm.filePath) {\n    ElMessage.warning('请输入作业内容或上传文件')\n    return\n  }\n  \n  submitting.value = true\n  try {\n    const formData = new FormData()\n    formData.append('assignmentId', assignmentId.value)\n    formData.append('content', submitForm.content)\n    \n    if (fileList.value.length > 0) {\n      // 如果已经通过el-upload上传了文件，我们只需传递文件路径\n      formData.append('filePath', submitForm.filePath)\n    }\n    \n    const response = await axios.post('/api/assignment/submission', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    })\n    \n    if (response.data.code === 200) {\n      ElMessage.success('提交成功')\n      // 重新获取作业详情\n      fetchAssignmentDetail()\n    } else {\n      ElMessage.error(response.data.message || '提交失败')\n    }\n  } catch (error) {\n    console.error('提交失败:', error)\n    ElMessage.error('提交失败：' + (error.response?.data?.message || error.message))\n  } finally {\n    submitting.value = false\n  }\n}\n\n// 文件上传成功\nconst handleUploadSuccess = (response) => {\n  if (response.code === 200) {\n    submitForm.filePath = response.data.filePath;\n    submitForm.fileName = response.data.fileName;\n    ElMessage.success('文件上传成功');\n  } else {\n    ElMessage.error(response.message || '文件上传失败');\n  }\n}\n\n// 文件上传失败\nconst handleUploadError = () => {\n  ElMessage.error('文件上传失败')\n}\n\n// 上传前检查\nconst beforeUpload = (file) => {\n  const isLt50M = file.size / 1024 / 1024 < 50\n  if (!isLt50M) {\n    ElMessage.error('文件大小不能超过50MB')\n    return false\n  }\n  return true\n}\n\n// 下载文件\nconst downloadFile = (submissionId) => {\n  if (!submissionId) {\n    ElMessage.warning('提交ID为空')\n    return\n  }\n  \n  try {\n    // 创建下载链接\n    const downloadUrl = `/api/assignment/submission/download/${submissionId}`\n    \n    // 创建一个隐藏的a标签，用于下载\n    const link = document.createElement('a')\n    link.href = downloadUrl\n    link.setAttribute('download', '') // 强制使用下载属性\n    document.body.appendChild(link)\n    link.click()\n    \n    // 清理DOM\n    setTimeout(() => {\n      document.body.removeChild(link)\n    }, 100)\n    \n    ElMessage.success('开始下载文件')\n  } catch (error) {\n    console.error('下载文件失败:', error)\n    ElMessage.error('下载文件失败')\n  }\n}\n\n// 返回上一页\nconst goBack = () => {\n  router.push({\n    name: 'StudentAssignments',\n    query: { courseId: assignment.value.courseId }\n  })\n}\n\n// 格式化日期\nconst formatDate = (dateString) => {\n  if (!dateString) return '未知时间'\n  const date = new Date(dateString)\n  return date.toLocaleString()\n}\n\n// 获取作业状态标签类型\nconst getStatusTag = (status) => {\n  switch (status) {\n    case 0: return 'danger'\n    case 1: return 'success'\n    case 2: return 'info'\n    default: return ''\n  }\n}\n\n// 获取作业状态标签文本\nconst getStatusLabel = (status) => {\n  switch (status) {\n    case 0: return '已关闭'\n    case 1: return '进行中'\n    case 2: return '已结束'\n    default: return '未知'\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.assignment-detail {\n  .page-header {\n    margin-bottom: 20px;\n  }\n  \n  .assignment-card {\n    margin-bottom: 20px;\n  }\n  \n  .card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  \n  .ml-10 {\n    margin-left: 10px;\n  }\n  \n  .assignment-info {\n    h2 {\n      margin-top: 0;\n      margin-bottom: 15px;\n      color: #303133;\n    }\n    \n    .meta-info {\n      display: flex;\n      flex-wrap: wrap;\n      margin-bottom: 20px;\n      color: #606266;\n      \n      span {\n        margin-right: 20px;\n        margin-bottom: 10px;\n      }\n    }\n    \n    .description {\n      margin-bottom: 30px;\n      \n      h3 {\n        margin-top: 0;\n        margin-bottom: 10px;\n        font-size: 16px;\n        color: #303133;\n      }\n      \n      .description-content {\n        padding: 15px;\n        background-color: #f5f7fa;\n        border-radius: 4px;\n        white-space: pre-wrap;\n      }\n    }\n    \n    .submission-section {\n      margin-bottom: 30px;\n      \n      h3 {\n        margin-top: 0;\n        margin-bottom: 10px;\n        font-size: 16px;\n        color: #303133;\n      }\n      \n      .submission-info {\n        p {\n          margin: 10px 0;\n        }\n        \n        .content-box {\n          padding: 15px;\n          background-color: #f5f7fa;\n          border-radius: 4px;\n          margin-top: 5px;\n          white-space: pre-wrap;\n        }\n        \n        .feedback {\n          margin-top: 20px;\n        }\n      }\n    }\n    \n    .submit-form {\n      h3 {\n        margin-top: 0;\n        margin-bottom: 20px;\n        font-size: 16px;\n        color: #303133;\n      }\n      \n      .uploaded-file {\n        margin-top: 8px;\n        padding: 5px 10px;\n        background-color: #f0f9eb;\n        color: #67c23a;\n        border-radius: 4px;\n        display: inline-block;\n      }\n    }\n  }\n}\n</style> ","import script from \"./AssignmentDetail.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./AssignmentDetail.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./AssignmentDetail.vue?vue&type=style&index=0&id=901e7f16&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-901e7f16\"]])\n\nexport default __exports__"],"names":["router","useRouter","route","useRoute","assignmentId","ref","params","id","assignment","submission","loading","submitting","submitForm","reactive","content","filePath","fileSize","fileType","fileName","fileList","uploadHeaders","Authorization","localStorage","getItem","onMounted","fetchAssignmentDetail","async","value","assignmentResponse","axios","data","code","submissionResponse","ElMessage","error","message","console","submitAssignment","formData","FormData","append","length","response","headers","success","warning","handleUploadSuccess","handleUploadError","beforeUpload","file","isLt50M","size","downloadFile","submissionId","downloadUrl","link","document","createElement","href","setAttribute","body","appendChild","click","setTimeout","removeChild","goBack","push","name","query","courseId","formatDate","dateString","date","Date","toLocaleString","getStatusTag","status","getStatusLabel","__exports__"],"sourceRoot":""}