"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[412],{3412:function(e,a,l){l.r(a),l.d(a,{default:function(){return _}});var t=l(6768),u=l(4232),r=l(144),n=l(1219),o=l(2933),d=l(788),i=l.n(d);const s={class:"materials-container"},c={key:0,class:"filter-info"},p={class:"pagination-container"};var m={__name:"Materials",setup(e){const a=(0,r.KR)(!1),l=(0,r.KR)([]),d=(0,r.KR)([]),m=(0,r.KR)(0),f=(0,r.Kh)({pageNum:1,pageSize:10,courseId:void 0,type:void 0}),v=(0,t.EW)({get:()=>f.pageNum,set:e=>{f.pageNum=e}}),_=(0,t.EW)({get:()=>f.pageSize,set:e=>{f.pageSize=e}}),b=(0,t.EW)((()=>{if(!f.courseId)return"";const e=d.value.find((e=>e.id===f.courseId));return e?e.name:""})),g=(0,t.EW)((()=>void 0===f.type?"":0===f.type?"课程资料":"学生资料")),k=async()=>{try{const e=await i().get("/api/student/courses");d.value=e.data.data||[],d.value.length>0&&!f.courseId&&(f.courseId=d.value[0].id,await y())}catch(e){console.error("获取课程列表失败:",e),n.nk.error("获取课程列表失败")}},y=async()=>{a.value=!0;try{const e=await i().get("/api/material/list",{params:f});if(l.value=e.data.data.records||[],l.value.length>0){const e=l.value[0];console.log("资料列表第一条数据:",e),console.log("资料列表第一条数据的所有字段:",Object.keys(e));const a=["uploadUserName","upload_user_name","uploaderName","uploader_name","userName","user_name"];a.forEach((a=>{console.log(`字段 ${a} 的值:`,e[a])}))}l.value=l.value.map((e=>{if(e.courseId&&!e.courseName&&!e.course_name){const a=d.value.find((a=>a.id===e.courseId));a&&(e.courseName=a.name)}return e.uploadUserName&&""!==e.uploadUserName.trim()||console.log("资料缺少上传者信息:",e.id,e.name,"所有字段:",Object.keys(e)),e})),m.value=e.data.data.total||0}catch(e){console.error("获取资料列表失败:",e),n.nk.error("获取资料列表失败")}finally{a.value=!1}},h=()=>{f.courseId=void 0,f.type=void 0,y()},w=e=>{f.pageNum=e,y()},F=e=>{f.pageSize=e,y()},N=e=>{o.s.confirm("确认下载该资料?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((()=>{window.open(`/api/material/download/${e.id}`,"_blank")})).catch((()=>{}))},W=e=>{if(!e)return"0 B";const a=["B","KB","MB","GB","TB"];let l=0;while(e>=1024&&l<a.length-1)e/=1024,l++;return e.toFixed(2)+" "+a[l]},I=e=>e?e.includes("image")?"success":e.includes("pdf")?"danger":e.includes("word")||e.includes("document")?"primary":e.includes("excel")||e.includes("sheet")?"":e.includes("zip")||e.includes("rar")?"warning":"info":"",z=e=>e?e.includes("image")?"图片":e.includes("pdf")?"PDF":e.includes("word")||e.includes("document")?"Word":e.includes("excel")||e.includes("sheet")?"Excel":e.includes("zip")||e.includes("rar")?"压缩包":e.split("/")[1]||e:"未知",C=e=>{if(e.courseName)return e.courseName;if(e.course_name)return e.course_name;if(e.courseId||e.course_id){const a=e.courseId||e.course_id,l=d.value.find((e=>e.id===a));return l?l.name:"未知课程"}return"未知课程"},x=e=>e.uploadUserName&&""!==e.uploadUserName.trim()?e.uploadUserName:e.upload_user_name&&""!==e.upload_user_name.trim()?e.upload_user_name:e.uploaderName&&""!==e.uploaderName.trim()?e.uploaderName:e.uploader_name&&""!==e.uploader_name.trim()?e.uploader_name:e.userName&&""!==e.userName.trim()?e.userName:e.user_name&&""!==e.user_name.trim()?e.user_name:(console.log("找不到上传者名称字段，资料ID:",e.id,"可用字段:",Object.keys(e)),"未知用户");return(0,t.sV)((async()=>{await k()})),(e,r)=>{const n=(0,t.g2)("el-option"),o=(0,t.g2)("el-select"),i=(0,t.g2)("el-form-item"),k=(0,t.g2)("el-button"),U=(0,t.g2)("el-form"),E=(0,t.g2)("el-tag"),B=(0,t.g2)("el-card"),S=(0,t.g2)("el-table-column"),K=(0,t.g2)("el-table"),T=(0,t.g2)("el-pagination"),V=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",s,[r[9]||(r[9]=(0,t.Lk)("h1",null,"课程资料",-1)),(0,t.bF)(B,{class:"filter-card"},{default:(0,t.k6)((()=>[(0,t.bF)(U,{inline:!0,model:f,class:"filter-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"课程"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:f.courseId,"onUpdate:modelValue":r[0]||(r[0]=e=>f.courseId=e),placeholder:"选择课程",clearable:"",style:{width:"220px"},filterable:""},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(d.value,(e=>((0,t.uX)(),(0,t.Wv)(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"资料类型"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:f.type,"onUpdate:modelValue":r[1]||(r[1]=e=>f.type=e),placeholder:"选择类型",clearable:"",style:{width:"150px"}},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"课程资料",value:0}),(0,t.bF)(n,{label:"学生资料",value:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,null,{default:(0,t.k6)((()=>[(0,t.bF)(k,{type:"primary",onClick:y},{default:(0,t.k6)((()=>r[4]||(r[4]=[(0,t.eW)("查询")]))),_:1}),(0,t.bF)(k,{onClick:h},{default:(0,t.k6)((()=>r[5]||(r[5]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),b.value||g.value?((0,t.uX)(),(0,t.CE)("div",c,[r[6]||(r[6]=(0,t.Lk)("span",null,"当前筛选: ",-1)),b.value?((0,t.uX)(),(0,t.Wv)(E,{key:0,type:"info",class:"filter-tag"},{default:(0,t.k6)((()=>[(0,t.eW)(" 课程: "+(0,u.v_)(b.value),1)])),_:1})):(0,t.Q3)("",!0),g.value?((0,t.uX)(),(0,t.Wv)(E,{key:1,type:"info",class:"filter-tag"},{default:(0,t.k6)((()=>[(0,t.eW)(" 类型: "+(0,u.v_)(g.value),1)])),_:1})):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(B,{class:"material-list-card"},{header:(0,t.k6)((()=>r[7]||(r[7]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"资料列表")],-1)]))),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(K,{data:l.value,style:{width:"100%"},border:""},{default:(0,t.k6)((()=>[(0,t.bF)(S,{prop:"name",label:"资料名称","min-width":"180"}),(0,t.bF)(S,{prop:"description",label:"资料描述","min-width":"200"}),(0,t.bF)(S,{label:"所属课程","min-width":"120"},{default:(0,t.k6)((e=>[(0,t.eW)((0,u.v_)(C(e.row)),1)])),_:1}),(0,t.bF)(S,{prop:"fileType",label:"文件类型","min-width":"100"},{default:(0,t.k6)((e=>[(0,t.bF)(E,{type:I(e.row.fileType)},{default:(0,t.k6)((()=>[(0,t.eW)((0,u.v_)(z(e.row.fileType)),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(S,{prop:"fileSize",label:"文件大小","min-width":"100"},{default:(0,t.k6)((e=>[(0,t.eW)((0,u.v_)(W(e.row.fileSize)),1)])),_:1}),(0,t.bF)(S,{prop:"downloadCount",label:"下载次数","min-width":"100"}),(0,t.bF)(S,{label:"上传者","min-width":"100"},{default:(0,t.k6)((e=>[(0,t.eW)((0,u.v_)(x(e.row)),1)])),_:1}),(0,t.bF)(S,{prop:"createTime",label:"上传时间","min-width":"160"}),(0,t.bF)(S,{label:"操作",width:"120",fixed:"right"},{default:(0,t.k6)((e=>[(0,t.bF)(k,{type:"primary",link:"",onClick:a=>N(e.row)},{default:(0,t.k6)((()=>r[8]||(r[8]=[(0,t.eW)("下载")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[V,a.value]]),(0,t.Lk)("div",p,[(0,t.bF)(T,{"current-page":v.value,"page-size":_.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:m.value,onSizeChange:F,onCurrentChange:w,"onUpdate:currentPage":r[2]||(r[2]=e=>v.value=e),"onUpdate:pageSize":r[3]||(r[3]=e=>_.value=e)},null,8,["current-page","page-size","total"])])])),_:1})])}}},f=l(1241);const v=(0,f.A)(m,[["__scopeId","data-v-2fc4fb59"]]);var _=v}}]);
//# sourceMappingURL=412.9e4ae34a.js.map