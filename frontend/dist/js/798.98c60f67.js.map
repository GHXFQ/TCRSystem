{"version":3,"file":"js/798.98c60f67.js","mappings":"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","sources":["webpack://tcr-system-frontend/./src/views/student/Home.vue","webpack://tcr-system-frontend/./src/views/student/Home.vue?13eb"],"sourcesContent":["<template>\n  <div class=\"student-home\">\n    <h1>学生首页</h1>\n    <el-card class=\"welcome-card\">\n      <div class=\"welcome-message\">\n        <h2>欢迎回来，{{ userInfo?.realName || '同学' }}</h2>\n        <p>您可以在这里查看您的课程、学习资料和提交反馈。</p>\n      </div>\n    </el-card>\n    \n    <el-row :gutter=\"20\" class=\"mt-20\">\n      <el-col :span=\"12\">\n        <el-card v-loading=\"coursesLoading\">\n          <template #header>\n            <div class=\"card-header\">\n              <span>我的课程</span>\n              <el-button type=\"text\" @click=\"goToCourses\">查看全部</el-button>\n            </div>\n          </template>\n          <div class=\"empty-block\" v-if=\"recentCourses.length === 0\">\n            <el-empty description=\"暂无课程数据\"></el-empty>\n          </div>\n          <div v-else class=\"table-container\">\n            <el-table \n              v-if=\"showCoursesTable\"\n              :data=\"recentCourses\" \n              style=\"width: 100%\"\n              :height=\"tableHeight\"\n              :show-header=\"true\"\n              :highlight-current-row=\"false\"\n            >\n              <el-table-column prop=\"name\" label=\"课程名称\" />\n              <el-table-column prop=\"teacherName\" label=\"教师\" width=\"120\" />\n              <el-table-column prop=\"classTime\" label=\"上课时间\" width=\"130\" />\n              <el-table-column prop=\"classLocation\" label=\"上课地点\" width=\"130\" />\n              <el-table-column label=\"状态\" width=\"100\">\n                <template #default=\"scope\">\n                  <el-tag :type=\"getStatusTag(scope.row.status)\">\n                    {{ getStatusLabel(scope.row.status) }}\n                  </el-tag>\n                </template>\n              </el-table-column>\n              <el-table-column label=\"操作\" width=\"100\">\n                <template #default=\"scope\">\n                  <el-button type=\"primary\" size=\"small\" @click=\"viewMaterials(scope.row.id)\">\n                    查看资料\n                  </el-button>\n                </template>\n              </el-table-column>\n            </el-table>\n            <div v-else class=\"loading-placeholder\"></div>\n          </div>\n        </el-card>\n      </el-col>\n      <el-col :span=\"12\">\n        <el-card v-loading=\"materialsLoading\">\n          <template #header>\n            <div class=\"card-header\">\n              <span>最新资料</span>\n              <el-button type=\"text\" @click=\"goToMaterials\">查看全部</el-button>\n            </div>\n          </template>\n          <div class=\"empty-block\" v-if=\"recentMaterials.length === 0\">\n            <el-empty description=\"暂无资料数据\"></el-empty>\n          </div>\n          <div v-else class=\"table-container\">\n            <el-table \n              v-if=\"showMaterialsTable\"\n              :data=\"recentMaterials\" \n              style=\"width: 100%\"\n              :height=\"tableHeight\"\n              :show-header=\"true\"\n              :highlight-current-row=\"false\"\n            >\n              <el-table-column prop=\"name\" label=\"资料名称\" />\n              <el-table-column prop=\"courseName\" label=\"所属课程\" width=\"120\" />\n              <el-table-column label=\"上传时间\" width=\"180\">\n                <template #default=\"scope\">\n                  {{ formatDate(scope.row.createTime) }}\n                </template>\n              </el-table-column>\n              <el-table-column label=\"操作\" width=\"100\">\n                <template #default=\"scope\">\n                  <el-button type=\"primary\" size=\"small\" @click=\"downloadMaterial(scope.row)\">\n                    下载\n                  </el-button>\n                </template>\n              </el-table-column>\n            </el-table>\n            <div v-else class=\"loading-placeholder\"></div>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n    \n    <el-row class=\"mt-20\">\n      <el-col :span=\"24\">\n        <el-card v-loading=\"assignmentsLoading\">\n          <template #header>\n            <div class=\"card-header\">\n              <span>待完成作业</span>\n              <el-button type=\"text\" @click=\"goToAssignments\">查看全部</el-button>\n            </div>\n          </template>\n          <div class=\"empty-block\" v-if=\"recentAssignments.length === 0\">\n            <el-empty description=\"暂无待完成作业\"></el-empty>\n          </div>\n          <div v-else class=\"table-container\">\n            <el-table \n              v-if=\"showAssignmentsTable\"\n              :data=\"recentAssignments\" \n              style=\"width: 100%\"\n              :height=\"tableHeight\"\n              :show-header=\"true\"\n              :highlight-current-row=\"false\"\n            >\n              <el-table-column prop=\"title\" label=\"作业标题\" min-width=\"180\" />\n              <el-table-column prop=\"courseName\" label=\"所属课程\" width=\"150\" />\n              <el-table-column label=\"截止日期\" width=\"180\">\n                <template #default=\"scope\">\n                  {{ formatDate(scope.row.deadline) }}\n                </template>\n              </el-table-column>\n              <el-table-column label=\"状态\" width=\"100\">\n                <template #default=\"scope\">\n                  <el-tag :type=\"getStatusTag(scope.row.status)\">\n                    {{ getStatusLabel(scope.row.status) }}\n                  </el-tag>\n                </template>\n              </el-table-column>\n              <el-table-column label=\"提交状态\" width=\"100\">\n                <template #default=\"scope\">\n                  <el-tag v-if=\"scope.row.submitted\" type=\"success\">已提交</el-tag>\n                  <el-tag v-else type=\"danger\">未提交</el-tag>\n                </template>\n              </el-table-column>\n              <el-table-column label=\"操作\" width=\"120\">\n                <template #default>\n                  <el-button \n                    type=\"success\" \n                    size=\"small\" \n                    @click=\"goToAssignments\"\n                  >\n                    查看\n                  </el-button>\n                </template>\n              </el-table-column>\n            </el-table>\n            <div v-else class=\"loading-placeholder\"></div>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onBeforeUnmount, nextTick } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\nimport axios from 'axios'\nimport { ElMessage } from 'element-plus'\n\nconst store = useStore()\nconst router = useRouter()\nconst userInfo = computed(() => store.state.user.userInfo)\n\n// 课程相关\nconst coursesLoading = ref(false)\nconst recentCourses = ref([])\nconst showCoursesTable = ref(false)\n\n// 资料相关\nconst materialsLoading = ref(false)\nconst recentMaterials = ref([])\nconst showMaterialsTable = ref(false)\n\n// 作业相关\nconst assignmentsLoading = ref(false)\nconst recentAssignments = ref([])\nconst showAssignmentsTable = ref(false)\n\n// 表格高度\nconst tableHeight = 200\n\n// 添加 ResizeObserver 错误处理\nconst originalError = window.console.error;\nconst errorHandler = function() {\n  const args = Array.from(arguments);\n  const firstArg = args[0];\n  \n  if (firstArg && typeof firstArg === 'string' && firstArg.includes('ResizeObserver')) {\n    // 忽略 ResizeObserver 错误\n    return;\n  }\n  return originalError.apply(window.console, args);\n};\n\n// 获取最近的课程（最多5个）\nconst fetchRecentCourses = async () => {\n  coursesLoading.value = true\n  try {\n    const token = localStorage.getItem('token')\n    const response = await axios.get('/api/student/courses', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    })\n    \n    if (response.data.code === 200) {\n      // 获取最近的5个课程\n      recentCourses.value = (response.data.data || []).slice(0, 5)\n      console.log('获取最近课程成功:', recentCourses.value)\n      \n      // 延迟显示表格\n      nextTick(() => {\n        showCoursesTable.value = true\n      })\n      \n      // 获取作业列表\n      fetchRecentAssignments()\n    } else {\n      console.error('获取课程失败:', response.data.message)\n    }\n  } catch (error) {\n    console.error('获取课程出错:', error)\n  } finally {\n    coursesLoading.value = false\n  }\n}\n\n// 获取最近的资料（最多5个）\nconst fetchRecentMaterials = async () => {\n  materialsLoading.value = true\n  try {\n    const token = localStorage.getItem('token')\n    // 先获取课程列表，用于后续关联课程名称\n    const coursesResponse = await axios.get('/api/student/courses', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    })\n    \n    if (coursesResponse.data.code === 200) {\n      const courses = coursesResponse.data.data || []\n      \n      // 直接查询所有课程资料，不限定特定课程\n      const materialsResponse = await axios.get('/api/material/list', {\n        params: {\n          pageNum: 1,\n          pageSize: 5,\n          // 不指定courseId，查询所有课程\n          // 按创建时间降序排序\n          orderBy: 'create_time',\n          orderType: 'desc'\n        },\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (materialsResponse.data.code === 200) {\n        // 获取最新的5个资料\n        const materials = materialsResponse.data.data.records || []\n        \n        // 添加课程名称\n        recentMaterials.value = materials.map(material => {\n          const course = courses.find(c => c.id === material.courseId)\n          return {\n            ...material,\n            courseName: course ? course.name : '未知课程'\n          }\n        })\n        \n        // 延迟显示表格\n        nextTick(() => {\n          showMaterialsTable.value = true\n        })\n        \n        console.log('获取最新资料成功:', recentMaterials.value)\n      } else {\n        console.error('获取资料失败:', materialsResponse.data.message)\n      }\n    }\n  } catch (error) {\n    console.error('获取资料出错:', error)\n  } finally {\n    materialsLoading.value = false\n  }\n}\n\n// 获取待完成作业（最多5个）\nconst fetchRecentAssignments = async () => {\n  assignmentsLoading.value = true\n  try {\n    // 使用正确的学生作业列表API\n    const response = await axios.get('/api/assignment/student/list', {\n      params: {\n        current: 1,\n        size: 5,\n        status: 1 // 只查询进行中的作业\n      }\n    })\n    \n    if (response.data.code === 200) {\n      // 获取所有作业\n      const allAssignments = response.data.data.records || []\n      \n      // 筛选未提交的作业\n      const pendingAssignments = allAssignments\n        .filter(a => !a.submitted)\n        .slice(0, 5)\n      \n      recentAssignments.value = pendingAssignments\n      \n      // 延迟显示表格\n      nextTick(() => {\n        showAssignmentsTable.value = true\n      })\n      \n      console.log('获取待完成作业成功:', recentAssignments.value)\n    } else {\n      console.error('获取作业失败:', response.data.message)\n    }\n  } catch (error) {\n    console.error('获取作业出错:', error)\n  } finally {\n    assignmentsLoading.value = false\n  }\n}\n\n// 格式化日期\nconst formatDate = (dateString) => {\n  if (!dateString) return '未知时间'\n  const date = new Date(dateString)\n  return date.toLocaleString()\n}\n\n// 获取课程状态标签类型\nconst getStatusTag = (status) => {\n  switch (status) {\n    case 0: return 'danger'\n    case 1: return 'success'\n    case 2: return 'info'\n    default: return ''\n  }\n}\n\n// 获取课程状态标签文本\nconst getStatusLabel = (status) => {\n  switch (status) {\n    case 0: return '已关闭'\n    case 1: return '正常'\n    case 2: return '已结束'\n    default: return '未知'\n  }\n}\n\n// 查看课程资料\nconst viewMaterials = (courseId) => {\n  router.push({\n    name: 'StudentMaterials',\n    query: { courseId }\n  })\n}\n\n\n// 下载资料\nconst downloadMaterial = (material) => {\n  window.open(`/api/material/download/${material.id}`, '_blank')\n  ElMessage.success('开始下载资料')\n}\n\n// 跳转到课程页面\nconst goToCourses = () => {\n  router.push({ name: 'StudentCourses' })\n}\n\n// 跳转到资料页面\nconst goToMaterials = () => {\n  // 如果有课程，跳转到第一个课程的资料页面\n  if (recentCourses.value.length > 0) {\n    router.push({\n      name: 'StudentMaterials',\n      query: { courseId: recentCourses.value[0].id }\n    })\n  } else {\n    // 否则跳转到课程页面\n    router.push({ name: 'StudentCourses' })\n    ElMessage.info('请先选择一门课程')\n  }\n}\n\n// 跳转到作业页面\nconst goToAssignments = () => {\n  router.push({ name: 'StudentAssignments' })\n}\n\n// 页面加载时获取数据\nonMounted(() => {\n  // 设置错误处理器\n  window.console.error = errorHandler;\n  \n  // 获取数据\n  fetchRecentCourses();\n  fetchRecentMaterials();\n});\n\nonBeforeUnmount(() => {\n  // 恢复原始错误处理\n  window.console.error = originalError;\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.student-home {\n  h1 {\n    margin-bottom: 20px;\n  }\n  \n  .welcome-card {\n    margin-bottom: 20px;\n    \n    .welcome-message {\n      h2 {\n        margin-top: 0;\n        margin-bottom: 10px;\n        color: #409EFF;\n      }\n      \n      p {\n        margin: 0;\n        color: #606266;\n      }\n    }\n  }\n  \n  .mt-20 {\n    margin-top: 20px;\n  }\n  \n  .card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  \n  .empty-block {\n    padding: 30px 0;\n  }\n  \n  .table-container {\n    height: 200px;\n    overflow: hidden;\n    \n    .el-table {\n      width: 100%;\n      height: 100%;\n    }\n  }\n  \n  .loading-placeholder {\n    height: 200px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: #f5f7fa;\n    border-radius: 4px;\n    color: #909399;\n    font-size: 14px;\n    \n    &::before {\n      content: \"加载中...\";\n    }\n  }\n}\n</style> ","import script from \"./Home.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Home.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Home.vue?vue&type=style&index=0&id=784ed8f5&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-784ed8f5\"]])\n\nexport default __exports__"],"names":["tableHeight","store","useStore","router","useRouter","userInfo","computed","state","user","coursesLoading","ref","recentCourses","showCoursesTable","materialsLoading","recentMaterials","showMaterialsTable","assignmentsLoading","recentAssignments","showAssignmentsTable","originalError","window","console","error","errorHandler","args","Array","from","arguments","firstArg","includes","apply","fetchRecentCourses","async","value","token","localStorage","getItem","response","axios","headers","data","code","slice","log","nextTick","fetchRecentAssignments","message","fetchRecentMaterials","coursesResponse","courses","materialsResponse","params","pageNum","pageSize","orderBy","orderType","materials","records","map","material","course","find","c","id","courseId","courseName","name","current","size","status","allAssignments","pendingAssignments","filter","a","submitted","formatDate","dateString","date","Date","toLocaleString","getStatusTag","getStatusLabel","viewMaterials","push","query","downloadMaterial","open","ElMessage","success","goToCourses","goToMaterials","length","info","goToAssignments","onMounted","onBeforeUnmount","__exports__"],"sourceRoot":""}