"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[264],{7264:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});var l=t(6768),s=t(144),r=t(4232),i=t(1387),d=t(1219),n=t(2933),c=t(788),o=t.n(c),u=t(9671),p=t(3988);const m={class:"material-statistics"},v={class:"overview-content"},k={class:"overview-number"},b={class:"overview-content"},h={class:"overview-number"},f={class:"overview-content"},g={class:"overview-number"},w={class:"card-header"},y={key:0,class:"loading-container"},_={key:1,class:"empty-data"},F={class:"pagination-container"};var L={__name:"MaterialStatistics",setup(e){const a=(0,i.rd)(),t=(0,s.KR)(!1),c=(0,s.KR)([]),L=(0,s.KR)(0),z=(0,s.KR)(null),I=(0,s.KR)(null);let C=null,T=null;const R=(0,s.Kh)({current:1,size:10,materialTypeId:"",academicYear:"",semester:""}),x=(0,s.Kh)({totalMaterials:0,completedTeachers:0,uncompletedTeachers:0}),K=(0,s.KR)([]),W=(0,s.KR)([]),V=()=>{const e=[],a=(new Date).getFullYear();for(let t=0;t<5;t++){const l=a-t;e.push(`${l}-${l+1}`)}W.value=e},Y=async()=>{try{const e=await o().get("/api/material-type/list");200===e.data.code&&e.data.data&&(K.value=e.data.data)}catch(e){console.error("获取材料类型出错:",e),d.nk.error("获取材料类型失败")}},E=async()=>{t.value=!0;try{const e=await o().get("/api/admin/material-statistics/overview",{params:{materialTypeId:R.materialTypeId,academicYear:R.academicYear,semester:R.semester}});200===e.data.code&&e.data.data&&Object.assign(x,e.data.data);const a=await o().get("/api/admin/material-statistics/uncompleted-teachers",{params:R});200===a.data.code&&(c.value=a.data.data.records||[],L.value=a.data.data.total||0);const t=await o().get("/api/admin/material-statistics/by-type");200===t.data.code&&t.data.data&&(await(0,l.dY)(),O(t.data.data));const s=await o().get("/api/admin/material-statistics/by-college");200===s.data.code&&s.data.data&&(await(0,l.dY)(),N(s.data.data))}catch(e){console.error("获取统计数据出错:",e),d.nk.error("获取统计数据失败")}finally{t.value=!1}},X=()=>{Object.assign(R,{current:1,size:10,materialTypeId:"",academicYear:"",semester:""}),E()},O=e=>{if(!z.value)return;C&&C.dispose(),C=u.Ts(z.value);const a=e.map((e=>e.name)),t=e.map((e=>e.completed)),l=e.map((e=>e.uncompleted)),s={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["已完成","未完成"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:a},series:[{name:"已完成",type:"bar",stack:"total",label:{show:!0},emphasis:{focus:"series"},data:t},{name:"未完成",type:"bar",stack:"total",label:{show:!0},emphasis:{focus:"series"},data:l}]};C.setOption(s),window.addEventListener("resize",(()=>{C&&C.resize()}))},N=e=>{if(!I.value)return;T&&T.dispose(),T=u.Ts(I.value);const a={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:10,data:e.map((e=>e.name))},series:[{name:"未完成比例",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:e.map((e=>({value:e.count,name:e.name})))}]};T.setOption(a),window.addEventListener("resize",(()=>{T&&T.resize()}))},j=async(e,a)=>{try{const t=await o().post("/api/admin/material-task/remind",{teacherId:e,taskId:a});200===t.data.code?d.nk.success("已发送提醒通知"):d.nk.error(t.data.message||"发送提醒失败")}catch(t){console.error("发送提醒出错:",t),d.nk.error("发送提醒失败，请稍后重试")}},A=async()=>{0!==c.value.length?n.s.confirm(`确定要提醒所有 ${c.value.length} 位未完成的教师吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const e=c.value.map((e=>({taskId:e.taskId,teacherId:e.teacherId}))),a=await o().post("/api/admin/material-task/remind-batch",{reminders:e});200===a.data.code?d.nk.success("批量发送提醒成功"):d.nk.error(a.data.message||"批量发送提醒失败")}catch(e){console.error("批量发送提醒出错:",e),d.nk.error("批量发送提醒失败，请稍后重试")}})).catch((()=>{})):d.nk.warning("没有需要提醒的教师")},G=e=>{a.push({path:"/admin/material-tasks",query:{taskId:e}})},M=e=>{R.size=e,E()},S=e=>{R.current=e,E()};return(0,l.sV)((()=>{V(),Y(),E(),window.addEventListener("resize",(()=>{C&&C.resize(),T&&T.resize()}))})),(0,l.hi)((()=>{C&&(C.dispose(),C=null),T&&(T.dispose(),T=null),window.removeEventListener("resize",(()=>{C&&C.resize(),T&&T.resize()}))})),(e,a)=>{const i=(0,l.g2)("el-option"),d=(0,l.g2)("el-select"),n=(0,l.g2)("el-form-item"),o=(0,l.g2)("el-button"),u=(0,l.g2)("el-form"),C=(0,l.g2)("el-card"),T=(0,l.g2)("el-col"),V=(0,l.g2)("el-row"),Y=(0,l.g2)("el-skeleton"),O=(0,l.g2)("el-empty"),N=(0,l.g2)("el-table-column"),U=(0,l.g2)("el-button-group"),$=(0,l.g2)("el-table"),B=(0,l.g2)("el-pagination");return(0,l.uX)(),(0,l.CE)("div",m,[a[14]||(a[14]=(0,l.Lk)("h1",{class:"page-title"},"教学材料统计与分析",-1)),(0,l.bF)(C,{class:"filter-card"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{inline:!0,model:R,class:"demo-form-inline"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{label:"材料类型"},{default:(0,l.k6)((()=>[(0,l.bF)(d,(0,l.v6)({modelValue:R.materialTypeId,"onUpdate:modelValue":a[0]||(a[0]=e=>R.materialTypeId=e),placeholder:"请选择材料类型",clearable:"",style:{width:"200px"}},(0,s.R1)(p.G)),{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(K.value,(e=>((0,l.uX)(),(0,l.Wv)(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},16,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"学年"},{default:(0,l.k6)((()=>[(0,l.bF)(d,(0,l.v6)({modelValue:R.academicYear,"onUpdate:modelValue":a[1]||(a[1]=e=>R.academicYear=e),placeholder:"请选择学年",clearable:"",style:{width:"200px"}},(0,s.R1)(p.G)),{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(W.value,(e=>((0,l.uX)(),(0,l.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},16,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"学期"},{default:(0,l.k6)((()=>[(0,l.bF)(d,(0,l.v6)({modelValue:R.semester,"onUpdate:modelValue":a[2]||(a[2]=e=>R.semester=e),placeholder:"请选择学期",clearable:"",style:{width:"200px"}},(0,s.R1)(p.G)),{default:(0,l.k6)((()=>[(0,l.bF)(i,{label:"第一学期",value:1}),(0,l.bF)(i,{label:"第二学期",value:2})])),_:1},16,["modelValue"])])),_:1}),(0,l.bF)(n,null,{default:(0,l.k6)((()=>[(0,l.bF)(o,{type:"primary",onClick:E},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)("查询")]))),_:1}),(0,l.bF)(o,{onClick:X},{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,l.bF)(V,{gutter:20,class:"statistics-overview"},{default:(0,l.k6)((()=>[(0,l.bF)(T,{span:8},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"overview-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",v,[a[5]||(a[5]=(0,l.Lk)("div",{class:"overview-title"},"上传材料总数",-1)),(0,l.Lk)("div",k,(0,r.v_)(x.totalMaterials||0),1)])])),_:1})])),_:1}),(0,l.bF)(T,{span:8},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"overview-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",b,[a[6]||(a[6]=(0,l.Lk)("div",{class:"overview-title"},"已完成教师数",-1)),(0,l.Lk)("div",h,(0,r.v_)(x.completedTeachers||0),1)])])),_:1})])),_:1}),(0,l.bF)(T,{span:8},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"overview-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",f,[a[7]||(a[7]=(0,l.Lk)("div",{class:"overview-title"},"未完成教师数",-1)),(0,l.Lk)("div",g,(0,r.v_)(x.uncompletedTeachers||0),1)])])),_:1})])),_:1})])),_:1}),(0,l.bF)(V,{gutter:20,class:"statistics-charts"},{default:(0,l.k6)((()=>[(0,l.bF)(T,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"chart-card"},{header:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("span",null,"按材料类型统计")],-1)]))),default:(0,l.k6)((()=>[(0,l.Lk)("div",{class:"chart-container",ref_key:"typeChartRef",ref:z},null,512)])),_:1})])),_:1}),(0,l.bF)(T,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"chart-card"},{header:(0,l.k6)((()=>a[9]||(a[9]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("span",null,"按学院统计")],-1)]))),default:(0,l.k6)((()=>[(0,l.Lk)("div",{class:"chart-container",ref_key:"collegeChartRef",ref:I},null,512)])),_:1})])),_:1})])),_:1}),(0,l.bF)(C,{class:"table-card"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",w,[a[11]||(a[11]=(0,l.Lk)("span",null,"未完成教师列表",-1)),(0,l.bF)(o,{size:"small",type:"warning",onClick:A},{default:(0,l.k6)((()=>a[10]||(a[10]=[(0,l.eW)("一键提醒")]))),_:1})])])),default:(0,l.k6)((()=>[t.value?((0,l.uX)(),(0,l.CE)("div",y,[(0,l.bF)(Y,{rows:5,animated:""})])):0===c.value.length?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(O,{description:"暂无未完成的教师"})])):((0,l.uX)(),(0,l.Wv)($,{key:2,data:c.value,style:{width:"100%"}},{default:(0,l.k6)((()=>[(0,l.bF)(N,{prop:"teacherId",label:"教师ID",width:"80"}),(0,l.bF)(N,{prop:"teacherName",label:"教师姓名"}),(0,l.bF)(N,{prop:"courseName",label:"课程名称"}),(0,l.bF)(N,{prop:"collegeName",label:"所属学院"}),(0,l.bF)(N,{prop:"materialTypeName",label:"材料类型"}),(0,l.bF)(N,{prop:"academicYear",label:"学年"}),(0,l.bF)(N,{prop:"semester",label:"学期"},{default:(0,l.k6)((e=>[(0,l.eW)((0,r.v_)(1===e.row.semester?"第一学期":"第二学期"),1)])),_:1}),(0,l.bF)(N,{prop:"deadline",label:"截止日期"}),(0,l.bF)(N,{label:"操作",width:"150"},{default:(0,l.k6)((e=>[(0,l.bF)(U,null,{default:(0,l.k6)((()=>[(0,l.bF)(o,{size:"small",type:"warning",onClick:a=>j(e.row.teacherId,e.row.taskId)},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)("提醒")]))),_:2},1032,["onClick"]),(0,l.bF)(o,{size:"small",type:"primary",onClick:a=>G(e.row.taskId)},{default:(0,l.k6)((()=>a[13]||(a[13]=[(0,l.eW)("查看任务")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])),(0,l.Lk)("div",F,[L.value>0?((0,l.uX)(),(0,l.Wv)(B,{key:0,"current-page":R.current,"page-size":R.size,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:L.value,onSizeChange:M,onCurrentChange:S},null,8,["current-page","page-size","total"])):(0,l.Q3)("",!0)])])),_:1})])}}},z=t(1241);const I=(0,z.A)(L,[["__scopeId","data-v-97a297c0"]]);var C=I}}]);
//# sourceMappingURL=264.8788fb5c.js.map