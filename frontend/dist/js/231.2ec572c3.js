"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[231],{231:function(e,a,l){l.r(a),l.d(a,{default:function(){return D}});var r=l(6768),t=l(4232),n=l(144),c=l(2933),s=l(1219),o=l(788),d=l.n(o);const u={class:"feedback-container"},i={key:0,class:"filter-info"},k={key:0,class:"empty-block"},v={key:1,class:"feedback-list"},p={class:"feedback-header"},g={class:"user-info"},m={class:"avatar-container"},f={class:"user-name-above"},y={class:"feedback-actions"},b={class:"feedback-time"},h={class:"feedback-content"},I={key:0,class:"reply-list"},_={class:"reply-header"},C={class:"user-info"},F={class:"avatar-container"},L={class:"user-name-above"},w={class:"reply-actions"},X={class:"reply-time"},E={class:"reply-content"},z={class:"reply-form"},W={class:"pagination-container"},K="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png";var V={__name:"Feedback",setup(e){const a=(0,n.KR)(!1),l=(0,n.KR)([]),o=(0,n.KR)([]),V=(0,n.KR)(0),$=(0,n.KR)(null),N=(0,n.KR)(null),D=(0,n.Kh)({pageNum:1,pageSize:10,courseId:void 0}),x=(0,n.Kh)({content:"",courseId:(0,r.EW)((()=>D.courseId))}),Q=(0,n.Kh)({}),R={content:[{required:!0,message:"请输入反馈内容",trigger:"blur"},{min:5,max:500,message:"长度在 5 到 500 个字符",trigger:"blur"}]},S=(0,r.EW)((()=>{if(!D.courseId)return"";const e=o.value.find((e=>e.id===D.courseId));return e?e.name:""})),T=()=>{try{const e=JSON.parse(localStorage.getItem("userInfo")||"{}");N.value=e.id,console.log("当前用户ID:",N.value)}catch(e){console.error("获取用户信息失败:",e)}},U=e=>(e.id&&!e.userName&&console.warn(`ID为${e.id}的${e.parentId?"回复":"反馈"}没有用户名`,e),e.userName||"匿名用户"),A=e=>{if(!e)return"";try{const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("日期格式化错误:",a),e}},B=e=>e.userId===N.value,j=async e=>{try{await c.s.confirm("确定要删除这条内容吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await d()["delete"](`/api/feedback/${e}`);200===a.data.code?(s.nk.success("删除成功"),J()):s.nk.error(a.data.message||"删除失败")}catch(a){"cancel"!==a&&(console.error("删除失败:",a),s.nk.error("删除失败"))}},q=async()=>{try{const e=await d().get("/api/student/courses");o.value=e.data.data||[],o.value.length>0&&!D.courseId&&(D.courseId=o.value[0].id,await J())}catch(e){console.error("获取课程列表失败:",e),s.nk.error("获取课程列表失败")}},J=async()=>{if(!D.courseId)return l.value=[],void(V.value=0);a.value=!0;try{const e=await d().get("/api/feedback/list",{params:D});console.log("反馈列表原始数据:",e.data.data),l.value=e.data.data.records||[],console.log("反馈列表处理后数据:",l.value),l.value.length>0&&l.value.forEach(((e,a)=>{console.log(`第${a+1}条反馈 ID:${e.id}, 用户ID:${e.userId}, 用户名:${e.userName}`),e.children&&e.children.length>0&&e.children.forEach(((e,a)=>{console.log(`  - 回复${a+1} ID:${e.id}, 用户ID:${e.userId}, 用户名:${e.userName}`)}))})),V.value=e.data.data.total||0}catch(e){console.error("获取反馈列表失败:",e),s.nk.error("获取反馈列表失败")}finally{a.value=!1}},O=()=>{D.courseId=void 0,l.value=[],V.value=0},G=()=>{J()},H=e=>{D.pageNum=e,J()},M=e=>{D.pageSize=e,J()},P=()=>{D.courseId?$.value.validate((async e=>{if(e)try{const e=await d().post("/api/feedback/add",{content:x.content,courseId:D.courseId});200===e.data.code?(s.nk.success("反馈提交成功"),x.content="",J()):s.nk.error(e.data.message||"反馈提交失败")}catch(a){console.error("提交反馈失败:",a),s.nk.error("提交反馈失败")}})):s.nk.warning("请先选择课程")},Y=async e=>{const a=Q[e];if(a&&""!==a.trim())try{const l=await d().post("/api/feedback/reply",{content:a,courseId:D.courseId,parentId:e});200===l.data.code?(s.nk.success("回复提交成功"),Q[e]="",J()):s.nk.error(l.data.message||"回复提交失败")}catch(l){console.error("提交回复失败:",l),s.nk.error("提交回复失败")}else s.nk.warning("请输入回复内容")};return(0,r.sV)((()=>{T(),q()})),(e,n)=>{const c=(0,r.g2)("el-option"),s=(0,r.g2)("el-select"),d=(0,r.g2)("el-form-item"),N=(0,r.g2)("el-button"),T=(0,r.g2)("el-form"),q=(0,r.g2)("el-tag"),Z=(0,r.g2)("el-card"),ee=(0,r.g2)("el-input"),ae=(0,r.g2)("el-empty"),le=(0,r.g2)("el-avatar"),re=(0,r.g2)("el-pagination"),te=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",u,[n[9]||(n[9]=(0,r.Lk)("h1",null,"课程反馈",-1)),(0,r.bF)(Z,{class:"filter-card"},{default:(0,r.k6)((()=>[(0,r.bF)(T,{inline:!0,model:D,class:"filter-form"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{label:"课程"},{default:(0,r.k6)((()=>[(0,r.bF)(s,{modelValue:D.courseId,"onUpdate:modelValue":n[0]||(n[0]=e=>D.courseId=e),placeholder:"选择课程",clearable:"",onChange:G,style:{width:"220px"},filterable:""},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.value,(e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(N,{type:"primary",onClick:J},{default:(0,r.k6)((()=>n[2]||(n[2]=[(0,r.eW)("查询")]))),_:1}),(0,r.bF)(N,{onClick:O},{default:(0,r.k6)((()=>n[3]||(n[3]=[(0,r.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),S.value?((0,r.uX)(),(0,r.CE)("div",i,[n[4]||(n[4]=(0,r.Lk)("span",null,"当前筛选: ",-1)),S.value?((0,r.uX)(),(0,r.Wv)(q,{key:0,type:"info",class:"filter-tag"},{default:(0,r.k6)((()=>[(0,r.eW)(" 课程: "+(0,t.v_)(S.value),1)])),_:1})):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])),_:1}),D.courseId?((0,r.uX)(),(0,r.Wv)(Z,{key:0,class:"add-feedback-card"},{header:(0,r.k6)((()=>n[5]||(n[5]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"发表反馈")],-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(T,{ref_key:"feedbackFormRef",ref:$,model:x,rules:R},{default:(0,r.k6)((()=>[(0,r.bF)(d,{prop:"content"},{default:(0,r.k6)((()=>[(0,r.bF)(ee,{modelValue:x.content,"onUpdate:modelValue":n[1]||(n[1]=e=>x.content=e),type:"textarea",rows:3,placeholder:"请输入您的反馈或问题..."},null,8,["modelValue"])])),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(N,{type:"primary",onClick:P},{default:(0,r.k6)((()=>n[6]||(n[6]=[(0,r.eW)("提交反馈")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1})):(0,r.Q3)("",!0),D.courseId?((0,r.uX)(),(0,r.Wv)(Z,{key:1,class:"feedback-list-card"},{header:(0,r.k6)((()=>n[7]||(n[7]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"反馈列表")],-1)]))),default:(0,r.k6)((()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",null,[0===l.value.length?((0,r.uX)(),(0,r.CE)("div",k,[(0,r.bF)(ae,{description:"暂无反馈数据"})])):((0,r.uX)(),(0,r.CE)("div",v,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.value,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"feedback-item"},[(0,r.Lk)("div",p,[(0,r.Lk)("div",g,[(0,r.Lk)("div",m,[(0,r.Lk)("div",f,(0,t.v_)(U(e)),1),(0,r.bF)(le,{size:40,src:e.userAvatar||K},null,8,["src"])])]),(0,r.Lk)("div",y,[(0,r.Lk)("span",b,(0,t.v_)(A(e.createTime)),1),B(e)?((0,r.uX)(),(0,r.Wv)(N,{key:0,type:"danger",size:"small",icon:"Delete",circle:"",plain:"",onClick:a=>j(e.id)},null,8,["onClick"])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",h,(0,t.v_)(e.content),1),e.children&&e.children.length>0?((0,r.uX)(),(0,r.CE)("div",I,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.children,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"reply-item"},[(0,r.Lk)("div",_,[(0,r.Lk)("div",C,[(0,r.Lk)("div",F,[(0,r.Lk)("div",L,(0,t.v_)(U(e)),1),(0,r.bF)(le,{size:30,src:e.userAvatar||K},null,8,["src"])])]),(0,r.Lk)("div",w,[(0,r.Lk)("span",X,(0,t.v_)(A(e.createTime)),1),B(e)?((0,r.uX)(),(0,r.Wv)(N,{key:0,type:"danger",size:"small",icon:"Delete",circle:"",plain:"",onClick:a=>j(e.id)},null,8,["onClick"])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",E,(0,t.v_)(e.content),1)])))),128))])):(0,r.Q3)("",!0),(0,r.Lk)("div",z,[(0,r.bF)(ee,{modelValue:Q[e.id],"onUpdate:modelValue":a=>Q[e.id]=a,type:"textarea",rows:2,placeholder:"回复该反馈..."},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(N,{type:"primary",size:"small",onClick:a=>Y(e.id)},{default:(0,r.k6)((()=>n[8]||(n[8]=[(0,r.eW)("回复")]))),_:2},1032,["onClick"])])])))),128))])),(0,r.Lk)("div",W,[(0,r.bF)(re,{"current-page":D.pageNum,"page-size":D.pageSize,"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:M,onCurrentChange:H},null,8,["current-page","page-size","total"])])])),[[te,a.value]])])),_:1})):(0,r.Q3)("",!0)])}}},$=l(1241);const N=(0,$.A)(V,[["__scopeId","data-v-4beeb323"]]);var D=N}}]);
//# sourceMappingURL=231.2ec572c3.js.map