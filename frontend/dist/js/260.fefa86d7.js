"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[260],{5260:function(e,a,l){l.r(a),l.d(a,{default:function(){return D}});var t=l(6768),i=l(4232);const r={class:"material-review"},n={class:"filter-container"},o={class:"pagination-container"},s={class:"filter-container"},u={class:"pagination-container"},d={key:0},c={class:"file-info"},m={class:"review-records"},b={key:0},v={class:"file-info"},p={class:"dialog-footer"};function f(e,a,l,f,g,w){const _=(0,t.g2)("el-option"),k=(0,t.g2)("el-select"),F=(0,t.g2)("el-form-item"),h=(0,t.g2)("el-button"),y=(0,t.g2)("el-form"),C=(0,t.g2)("el-table-column"),R=(0,t.g2)("el-tag"),D=(0,t.g2)("el-table"),T=(0,t.g2)("el-pagination"),V=(0,t.g2)("el-tab-pane"),x=(0,t.g2)("el-tabs"),W=(0,t.g2)("el-card"),z=(0,t.g2)("el-descriptions-item"),L=(0,t.g2)("el-descriptions"),I=(0,t.g2)("el-dialog"),P=(0,t.g2)("el-radio"),S=(0,t.g2)("el-radio-group"),Q=(0,t.g2)("el-input"),K=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(W,{class:"box-card"},{header:(0,t.k6)((()=>a[13]||(a[13]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"教学材料审核")],-1)]))),default:(0,t.k6)((()=>[(0,t.bF)(x,{modelValue:f.activeTab,"onUpdate:modelValue":a[5]||(a[5]=e=>f.activeTab=e),onTabClick:f.handleTabClick},{default:(0,t.k6)((()=>[(0,t.bF)(V,{label:"我提交的审核",name:"submit"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",n,[(0,t.bF)(y,{inline:!0,model:f.submitQueryParams,class:"demo-form-inline"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{label:"学年"},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,t.v6)({modelValue:f.submitQueryParams.academicYear,"onUpdate:modelValue":a[0]||(a[0]=e=>f.submitQueryParams.academicYear=e),placeholder:"请选择学年",clearable:"",style:{width:"250px"}},f.safeElementConfig),{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(f.academicYears,(e=>((0,t.uX)(),(0,t.Wv)(_,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},16,["modelValue"])])),_:1}),(0,t.bF)(F,{label:"学期"},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,t.v6)({modelValue:f.submitQueryParams.semester,"onUpdate:modelValue":a[1]||(a[1]=e=>f.submitQueryParams.semester=e),placeholder:"请选择学期",clearable:"",style:{width:"250px"}},f.safeElementConfig),{default:(0,t.k6)((()=>[(0,t.bF)(_,{label:"第一学期",value:1}),(0,t.bF)(_,{label:"第二学期",value:2})])),_:1},16,["modelValue"])])),_:1}),(0,t.bF)(F,{label:"状态"},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,t.v6)({modelValue:f.submitQueryParams.status,"onUpdate:modelValue":a[2]||(a[2]=e=>f.submitQueryParams.status=e),placeholder:"请选择状态",clearable:"",style:{width:"250px"}},f.safeElementConfig),{default:(0,t.k6)((()=>[(0,t.bF)(_,{label:"待审核",value:0}),(0,t.bF)(_,{label:"课程负责人审核中",value:1}),(0,t.bF)(_,{label:"专业负责人审核中",value:2}),(0,t.bF)(_,{label:"副院长审核中",value:3}),(0,t.bF)(_,{label:"教务人员审核中",value:4}),(0,t.bF)(_,{label:"审核通过",value:5}),(0,t.bF)(_,{label:"审核不通过",value:6})])),_:1},16,["modelValue"])])),_:1}),(0,t.bF)(F,null,{default:(0,t.k6)((()=>[(0,t.bF)(h,{type:"primary",onClick:f.fetchSubmitReviews},{default:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.eW)("查询")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),f.submitTableVisible?(0,t.bo)(((0,t.uX)(),(0,t.Wv)(D,{key:0,data:f.submitReviews,style:{width:"100%"},onResize:f.onTableResize},{default:(0,t.k6)((()=>[(0,t.bF)(C,{prop:"material_name",label:"材料名称",width:"180"}),(0,t.bF)(C,{prop:"course_name",label:"所属课程",width:"180"}),(0,t.bF)(C,{prop:"material_type_name",label:"材料类型"}),(0,t.bF)(C,{prop:"academic_year",label:"学年"}),(0,t.bF)(C,{prop:"semester",label:"学期"},{default:(0,t.k6)((e=>[(0,t.eW)((0,i.v_)(1===e.row.semester?"第一学期":"第二学期"),1)])),_:1}),(0,t.bF)(C,{prop:"status",label:"状态"},{default:(0,t.k6)((e=>[(0,t.bF)(R,{type:f.getStatusType(e.row.status)},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.getStatusText(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(C,{prop:"create_time",label:"提交时间"}),(0,t.bF)(C,{label:"操作",width:"150"},{default:(0,t.k6)((e=>[(0,t.bF)(h,{type:"text",size:"small",onClick:a=>f.viewReviewDetail(e.row.id)},{default:(0,t.k6)((()=>a[15]||(a[15]=[(0,t.eW)("查看详情")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onResize"])),[[K,f.submitLoading]]):(0,t.Q3)("",!0),(0,t.Lk)("div",o,[(0,t.bF)(T,{background:"",layout:"total, prev, pager, next",total:f.submitTotal,"page-size":f.submitQueryParams.size,"current-page":f.submitQueryParams.current,onCurrentChange:f.handleSubmitCurrentChange},null,8,["total","page-size","current-page","onCurrentChange"])])])),_:1}),(0,t.bF)(V,{label:"待我审核",name:"pending"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",s,[(0,t.bF)(y,{inline:!0,model:f.pendingQueryParams,class:"demo-form-inline"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{label:"学年"},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,t.v6)({modelValue:f.pendingQueryParams.academicYear,"onUpdate:modelValue":a[3]||(a[3]=e=>f.pendingQueryParams.academicYear=e),placeholder:"请选择学年",clearable:"",style:{width:"250px"}},f.safeElementConfig),{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(f.academicYears,(e=>((0,t.uX)(),(0,t.Wv)(_,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},16,["modelValue"])])),_:1}),(0,t.bF)(F,{label:"学期"},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,t.v6)({modelValue:f.pendingQueryParams.semester,"onUpdate:modelValue":a[4]||(a[4]=e=>f.pendingQueryParams.semester=e),placeholder:"请选择学期",clearable:"",style:{width:"250px"}},f.safeElementConfig),{default:(0,t.k6)((()=>[(0,t.bF)(_,{label:"第一学期",value:1}),(0,t.bF)(_,{label:"第二学期",value:2})])),_:1},16,["modelValue"])])),_:1}),(0,t.bF)(F,null,{default:(0,t.k6)((()=>[(0,t.bF)(h,{type:"primary",onClick:f.fetchPendingReviews},{default:(0,t.k6)((()=>a[16]||(a[16]=[(0,t.eW)("查询")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),f.pendingTableVisible?(0,t.bo)(((0,t.uX)(),(0,t.Wv)(D,{key:0,data:f.pendingReviews,style:{width:"100%"},onResize:f.onTableResize},{default:(0,t.k6)((()=>[(0,t.bF)(C,{prop:"material_name",label:"材料名称",width:"180"}),(0,t.bF)(C,{prop:"course_name",label:"所属课程",width:"180"}),(0,t.bF)(C,{prop:"material_type_name",label:"材料类型"}),(0,t.bF)(C,{prop:"academic_year",label:"学年"}),(0,t.bF)(C,{prop:"semester",label:"学期"},{default:(0,t.k6)((e=>[(0,t.eW)((0,i.v_)(1===e.row.semester?"第一学期":"第二学期"),1)])),_:1}),(0,t.bF)(C,{prop:"submit_user_name",label:"提交人"}),(0,t.bF)(C,{prop:"status",label:"状态"},{default:(0,t.k6)((e=>[(0,t.bF)(R,{type:f.getStatusType(e.row.status)},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.getStatusText(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(C,{prop:"create_time",label:"提交时间"}),(0,t.bF)(C,{label:"操作",width:"150"},{default:(0,t.k6)((e=>[(0,t.bF)(h,{type:"text",size:"small",onClick:a=>f.reviewMaterial(e.row.id)},{default:(0,t.k6)((()=>a[17]||(a[17]=[(0,t.eW)("审核")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onResize"])),[[K,f.pendingLoading]]):(0,t.Q3)("",!0),(0,t.Lk)("div",u,[(0,t.bF)(T,{background:"",layout:"total, prev, pager, next",total:f.pendingTotal,"page-size":f.pendingQueryParams.size,"current-page":f.pendingQueryParams.current,onCurrentChange:f.handlePendingCurrentChange},null,8,["total","page-size","current-page","onCurrentChange"])])])),_:1})])),_:1},8,["modelValue","onTabClick"])])),_:1}),(0,t.bF)(I,(0,t.v6)({title:"审核详情",modelValue:f.detailDialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>f.detailDialogVisible=e),width:"60%",onClose:f.handleDialogClose},f.safeElementConfig),{default:(0,t.k6)((()=>[f.reviewDetail?((0,t.uX)(),(0,t.CE)("div",d,[(0,t.bF)(L,{column:2,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(z,{label:"材料名称"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.material_name),1)])),_:1}),(0,t.bF)(z,{label:"所属课程"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.course_name),1)])),_:1}),(0,t.bF)(z,{label:"材料类型"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.material_type_name),1)])),_:1}),(0,t.bF)(z,{label:"学年/学期"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.academic_year)+" / "+(0,i.v_)(1===f.reviewDetail.semester?"第一学期":"第二学期"),1)])),_:1}),(0,t.bF)(z,{label:"提交人"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.submit_user_name),1)])),_:1}),(0,t.bF)(z,{label:"提交时间"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.create_time),1)])),_:1}),(0,t.bF)(z,{label:"当前状态"},{default:(0,t.k6)((()=>[(0,t.bF)(R,{type:f.getStatusType(f.reviewDetail.status)},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.getStatusText(f.reviewDetail.status)),1)])),_:1},8,["type"])])),_:1}),(0,t.bF)(z,{label:"当前审核人"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.current_reviewer_name),1)])),_:1}),(0,t.bF)(z,{label:"材料描述",span:2},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.material_description),1)])),_:1})])),_:1}),(0,t.Lk)("div",c,[a[19]||(a[19]=(0,t.Lk)("h3",null,"材料文件",-1)),(0,t.Lk)("p",null,"文件名："+(0,i.v_)(f.reviewDetail.material_name),1),(0,t.Lk)("p",null,"文件大小："+(0,i.v_)(f.formatFileSize(f.reviewDetail.file_size)),1),(0,t.Lk)("p",null,"文件类型："+(0,i.v_)(f.reviewDetail.file_type),1),(0,t.bF)(h,{type:"primary",size:"small",onClick:a[6]||(a[6]=e=>f.downloadFile(f.reviewDetail.material_id))},{default:(0,t.k6)((()=>a[18]||(a[18]=[(0,t.eW)("下载文件")]))),_:1})]),(0,t.Lk)("div",m,[a[20]||(a[20]=(0,t.Lk)("h3",null,"审核记录",-1)),f.reviewRecordTableVisible?((0,t.uX)(),(0,t.Wv)(D,{key:0,data:f.reviewRecords,style:{width:"100%"},onResize:f.onTableResize},{default:(0,t.k6)((()=>[(0,t.bF)(C,{prop:"reviewer_name",label:"审核人",width:"120"}),(0,t.bF)(C,{prop:"reviewer_title",label:"审核人职称",width:"120"},{default:(0,t.k6)((e=>[(0,t.eW)((0,i.v_)(f.getReviewerTitleText(e.row.reviewer_title)),1)])),_:1}),(0,t.bF)(C,{prop:"result",label:"审核结果",width:"100"},{default:(0,t.k6)((e=>[(0,t.bF)(R,{type:1===e.row.result?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(1===e.row.result?"通过":"不通过"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(C,{prop:"comment",label:"审核意见"}),(0,t.bF)(C,{prop:"create_time",label:"审核时间",width:"180"})])),_:1},8,["data","onResize"])):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0)])),_:1},16,["modelValue","onClose"]),(0,t.bF)(I,(0,t.v6)({title:"审核材料",modelValue:f.reviewDialogVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>f.reviewDialogVisible=e),width:"50%",onClose:f.handleDialogClose},f.safeElementConfig),{default:(0,t.k6)((()=>[f.reviewDetail?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.bF)(L,{column:2,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(z,{label:"材料名称"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.material_name),1)])),_:1}),(0,t.bF)(z,{label:"所属课程"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.course_name),1)])),_:1}),(0,t.bF)(z,{label:"材料类型"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.material_type_name),1)])),_:1}),(0,t.bF)(z,{label:"学年/学期"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.academic_year)+" / "+(0,i.v_)(1===f.reviewDetail.semester?"第一学期":"第二学期"),1)])),_:1}),(0,t.bF)(z,{label:"提交人"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.submit_user_name),1)])),_:1}),(0,t.bF)(z,{label:"提交时间"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.create_time),1)])),_:1}),(0,t.bF)(z,{label:"材料描述",span:2},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(f.reviewDetail.material_description),1)])),_:1})])),_:1}),(0,t.Lk)("div",v,[a[22]||(a[22]=(0,t.Lk)("h3",null,"材料文件",-1)),(0,t.Lk)("p",null,"文件名："+(0,i.v_)(f.reviewDetail.material_name),1),(0,t.Lk)("p",null,"文件大小："+(0,i.v_)(f.formatFileSize(f.reviewDetail.file_size)),1),(0,t.Lk)("p",null,"文件类型："+(0,i.v_)(f.reviewDetail.file_type),1),(0,t.bF)(h,{type:"primary",size:"small",onClick:a[8]||(a[8]=e=>f.downloadFile(f.reviewDetail.material_id))},{default:(0,t.k6)((()=>a[21]||(a[21]=[(0,t.eW)("下载文件")]))),_:1})]),(0,t.bF)(y,{model:f.reviewForm,"label-width":"100px",class:"review-form"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{label:"审核结果",required:""},{default:(0,t.k6)((()=>[(0,t.bF)(S,{modelValue:f.reviewForm.result,"onUpdate:modelValue":a[9]||(a[9]=e=>f.reviewForm.result=e)},{default:(0,t.k6)((()=>[(0,t.bF)(P,{label:1},{default:(0,t.k6)((()=>a[23]||(a[23]=[(0,t.eW)("通过")]))),_:1}),(0,t.bF)(P,{label:0},{default:(0,t.k6)((()=>a[24]||(a[24]=[(0,t.eW)("不通过")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(F,{label:"审核意见",required:""},{default:(0,t.k6)((()=>[(0,t.bF)(Q,{modelValue:f.reviewForm.comment,"onUpdate:modelValue":a[10]||(a[10]=e=>f.reviewForm.comment=e),type:"textarea",rows:4,placeholder:"请输入审核意见"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,t.Lk)("div",p,[(0,t.bF)(h,{onClick:a[11]||(a[11]=e=>f.reviewDialogVisible=!1)},{default:(0,t.k6)((()=>a[25]||(a[25]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)(h,{type:"primary",onClick:f.submitReview,loading:f.submitReviewLoading},{default:(0,t.k6)((()=>a[26]||(a[26]=[(0,t.eW)("提交审核")]))),_:1},8,["onClick","loading"])])])):(0,t.Q3)("",!0)])),_:1},16,["modelValue","onClose"])])}var g=l(144),w=l(1219),_=l(788),k=l.n(_),F=l(782),h=l(3988),y={name:"MaterialReview",setup(){const e=(0,F.Pj)(),a=(0,g.KR)("submit"),l=(0,t.EW)((()=>e.state.user)),i=(0,g.KR)([]),r=()=>{const e=(new Date).getFullYear(),a=[];for(let l=0;l<5;l++){const t=e-l;a.push(`${t}-${t+1}`)}i.value=a},n=(0,g.Kh)({current:1,size:10,teacherId:null,academicYear:null,semester:null,status:null}),o=(0,g.KR)([]),s=(0,g.KR)(0),u=(0,g.KR)(!1),d=(0,g.KR)(!0),c=async()=>{u.value=!0;try{let e=l.value?.id;if(!e){const a=JSON.parse(localStorage.getItem("userInfo")||"{}");e=a.id}if(!e)return w.nk.warning("无法获取用户信息，请重新登录"),void(u.value=!1);n.teacherId=e,console.log("提交的审核查询参数:",n);const a=await k().get("/api/material-review/teacher-submit",{params:n});console.log("提交的审核响应:",a.data),a.data&&a.data.data?(o.value=a.data.data.records||[],s.value=a.data.data.total||0):(o.value=[],s.value=0)}catch(e){console.error("获取提交的审核列表失败",e),w.nk.error("获取提交的审核列表失败"),o.value=[],s.value=0}finally{u.value=!1}},m=e=>{n.current=e,c()},b=(0,g.Kh)({current:1,size:10,reviewerId:null,academicYear:null,semester:null}),v=(0,g.KR)([]),p=(0,g.KR)(0),f=(0,g.KR)(!1),_=(0,g.KR)(!0),y=async()=>{f.value=!0;try{let a=l.value?.id;if(!a){const e=JSON.parse(localStorage.getItem("userInfo")||"{}");a=e.id}if(!a)return w.nk.warning("无法获取用户信息，请重新登录"),void(f.value=!1);b.reviewerId=a,console.log("待审核查询参数:",b);let t=!1;try{const e=await k().get("/api/teacher/titles",{params:{teacherId:a}});if(e.data&&200===e.data.code&&e.data.data){const a=e.data.data;t=a.some((e=>2===e.titleType)),console.log("当前用户是否为专业负责人:",t)}}catch(e){console.warn("获取用户职称信息失败:",e)}const i=await k().get("/api/material-review/teacher-pending",{params:b});if(console.log("待审核响应:",i.data),i.data&&i.data.data){const e=i.data.data.records||[],a=new Map;for(const l of e)a.has(l.id)||a.set(l.id,l);if(v.value=Array.from(a.values()),p.value=i.data.data.total||0,v.value.length<e.length){if(console.log(`检测到并移除了 ${e.length-v.value.length} 条重复记录`),t){console.log("专业负责人模式: 记录重复问题诊断");const a={};e.forEach((e=>{a[e.id]=(a[e.id]||0)+1}));const l=Object.entries(a).filter((([,e])=>e>1)).map((([e,a])=>({id:e,count:a})));l.length>0&&(console.log("重复ID列表:",l),l.forEach((({id:a})=>{const l=e.filter((e=>e.id.toString()===a));console.log(`ID ${a} 的重复记录:`,l)})))}p.value=v.value.length}}else v.value=[],p.value=0}catch(e){console.error("获取待审核列表失败",e),w.nk.error("获取待审核列表失败"),v.value=[],p.value=0}finally{f.value=!1}},C=e=>{b.current=e,y()},R=(0,g.KR)(!1),D=(0,g.KR)(null),T=(0,g.KR)([]),V=(0,g.KR)(!0),x=async e=>{try{const a=await k().get(`/api/material-review/detail/${e}`);if(console.log("审核详情响应:",a.data),a.data&&a.data.data){D.value=a.data.data,console.log("材料名称:",D.value.material_name),console.log("材料ID:",D.value.material_id);const l=await k().get(`/api/material-review/records/${e}`);console.log("审核记录响应:",l.data),l.data&&l.data.data?T.value=l.data.data||[]:T.value=[],R.value=!0,V.value=!1,await(0,t.dY)(),V.value=!0}else w.nk.error("获取审核详情失败")}catch(a){console.error("获取审核详情失败",a),w.nk.error("获取审核详情失败"),T.value=[]}},W=(0,g.KR)(!1),z=(0,g.Kh)({reviewId:null,reviewerId:null,reviewerTitle:null,result:1,comment:""}),L=(0,g.KR)(!1),I=async e=>{try{const a=await k().get(`/api/material-review/detail/${e}`);if(console.log("审核材料详情响应:",a.data),a.data&&a.data.data){D.value=a.data.data;let t=l.value?.id;if(!t){const e=JSON.parse(localStorage.getItem("userInfo")||"{}");t=e.id}if(!t)return void w.nk.warning("无法获取用户信息，请重新登录");switch(z.reviewId=e,z.reviewerId=t,D.value.status){case 1:z.reviewerTitle=1;break;case 2:z.reviewerTitle=2;break;case 3:z.reviewerTitle=3;break;case 4:z.reviewerTitle=4;break;default:z.reviewerTitle=0}z.result=1,z.comment="",W.value=!0}else w.nk.error("获取审核详情失败")}catch(a){console.error("获取审核详情失败",a),w.nk.error("获取审核详情失败")}},P=async()=>{if(z.comment){L.value=!0;try{const e=await k().post("/api/material-review/review",z);200===e.data.code?(w.nk.success("审核提交成功"),W.value=!1,y()):w.nk.error(e.data.message||"审核提交失败")}catch(e){console.error("审核提交失败",e),w.nk.error("审核提交失败")}finally{L.value=!1}}else w.nk.warning("请输入审核意见")},S=e=>{switch(e){case 0:return"待审核";case 1:return"课程负责人审核中";case 2:return"专业负责人审核中";case 3:return"副院长审核中";case 4:return"教务人员审核中";case 5:return"审核通过";case 6:return"审核不通过";default:return"未知状态"}},Q=e=>{switch(e){case 0:return"info";case 1:case 2:case 3:case 4:return"warning";case 5:return"success";case 6:return"danger";default:return"info"}},K=e=>{switch(e){case 0:return"普通教师";case 1:return"课程负责人";case 2:return"专业负责人";case 3:return"副院长";case 4:return"教务人员";default:return"未知职称"}},E=e=>{if(!e)return"0 B";const a=["B","KB","MB","GB","TB"];let l=0,t=e;while(t>=1024&&l<a.length-1)t/=1024,l++;return t.toFixed(2)+" "+a[l]},U=async e=>{if(e)try{console.log("下载材料ID:",e);const a=await k().get(`/api/material/download/${e}`,{responseType:"blob"}),l=new Blob([a.data]),t=window.URL.createObjectURL(l),i=document.createElement("a");i.href=t;const r=a.headers["content-disposition"];console.log("Content-Disposition头部:",r);let n="未知文件";const o="undefined"!==typeof D&&D.value&&D.value.material_name,s=o?D.value.material_name:null;if(r)if(s&&""!==s.trim())console.log("使用审核详情中的材料名称:",s),n=s;else{const e=r.match(/filename\*=UTF-8''([^;]+)/i);if(e&&e[1])n=decodeURIComponent(e[1].replace(/\+/g," ")),console.log("从RFC 5987格式解析的文件名:",n);else{const e=r.match(/filename="([^"]*?)"/i);if(e&&e[1])n=e[1],console.log("从带引号格式解析的文件名:",n);else{const e=r.match(/filename=([^;,\s]+)/i);e&&e[1]&&(n=e[1].trim(),console.log("从无引号格式解析的文件名:",n))}}}else o&&(n=s,console.log("使用审核详情中的材料名称:",n));const u=a.headers["content-type"];if(console.log("Content-Type:",u),u&&(!n.includes(".")||"未知文件"===n)){const e=Y(u);e&&(n+=e,console.log("添加扩展名后的文件名:",n))}if(("未知文件"===n||"未知文件.txt"===n)&&o){if(u&&!s.includes(".")){const e=Y(u);n=s+(e||"")}else n=s;console.log("使用审核详情材料名作为最终文件名:",n)}if("未知文件"===n||"未知文件.txt"===n){const a=e.toString().split("/"),l=a[a.length-1];if(l){if(u){const e=Y(u);n=`教学材料_${l}${e||""}`}else n=`教学材料_${l}`;console.log("从URL生成的文件名:",n)}}i.download=n,document.body.appendChild(i),i.click(),setTimeout((()=>{window.URL.revokeObjectURL(t),document.body.removeChild(i)}),100),k().post(`/api/material/download/${e}`).catch((e=>{console.error("更新下载次数失败:",e)})),w.nk.success("文件下载成功")}catch(a){console.error("下载文件失败:",a),w.nk.error("下载文件失败")}else w.nk.warning("材料ID为空")},Y=e=>{const a={"application/pdf":".pdf","application/msword":".doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":".docx","application/vnd.ms-excel":".xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":".xlsx","application/vnd.ms-powerpoint":".ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":".pptx","text/plain":".txt","text/html":".html","text/xml":".xml","image/jpeg":".jpg","image/png":".png","image/gif":".gif","application/zip":".zip","application/x-rar-compressed":".rar","video/mp4":".mp4","audio/mpeg":".mp3"};return a[e]||""},$=()=>{const e=console.error;return console.error=(...a)=>{a[0]&&a[0].toString().includes("ResizeObserver")||e.apply(console,a)},()=>{console.error=e}},X=$();(0,t.xo)((()=>{X()}));const B=e=>{"submit"===e.props.name?(_.value=!1,(0,t.dY)((()=>{d.value=!0,c()}))):"pending"===e.props.name&&(d.value=!1,(0,t.dY)((()=>{_.value=!0,y()})))},O=()=>new Promise((e=>setTimeout(e,0))),j=(e,a)=>{let l=null;return function(...t){l&&clearTimeout(l),l=setTimeout((()=>{e.apply(this,t)}),a)}};(0,t.sV)((()=>{r(),c();const e=j((()=>{"submit"===a.value?d.value&&(d.value=!1,(0,t.dY)((()=>{d.value=!0}))):"pending"===a.value&&_.value&&(_.value=!1,(0,t.dY)((()=>{_.value=!0})))}),300);window.addEventListener("resize",e),(0,t.xo)((()=>{window.removeEventListener("resize",e)}))}));const M=()=>{V.value=!1,(0,t.dY)((()=>{V.value=!0}))};return{activeTab:a,academicYears:i,submitQueryParams:n,submitReviews:o,submitTotal:s,submitLoading:u,fetchSubmitReviews:c,handleSubmitCurrentChange:m,pendingQueryParams:b,pendingReviews:v,pendingTotal:p,pendingLoading:f,fetchPendingReviews:y,handlePendingCurrentChange:C,detailDialogVisible:R,reviewDetail:D,reviewRecords:T,viewReviewDetail:x,reviewDialogVisible:W,reviewForm:z,submitReviewLoading:L,reviewMaterial:I,submitReview:P,getStatusText:S,getStatusType:Q,getReviewerTitleText:K,formatFileSize:E,downloadFile:U,handleTabClick:B,getExtensionFromMimeType:Y,submitTableVisible:d,pendingTableVisible:_,onTableResize:O,reviewRecordTableVisible:V,handleDialogClose:M,safeElementConfig:h.G}}},C=l(1241);const R=(0,C.A)(y,[["render",f],["__scopeId","data-v-7a1f0322"]]);var D=R}}]);
//# sourceMappingURL=260.fefa86d7.js.map