{"version":3,"file":"js/418.f5ad170a.js","mappings":"4dA8LA,MAAMA,GAAUC,EAAAA,EAAAA,KAAI,GACdC,GAAeD,EAAAA,EAAAA,IAAI,IACnBE,GAAaF,EAAAA,EAAAA,IAAI,IACjBG,GAAgBH,EAAAA,EAAAA,IAAI,IACpBI,GAAgBJ,EAAAA,EAAAA,IAAI,IACpBK,GAAQL,EAAAA,EAAAA,IAAI,GACZM,GAAYN,EAAAA,EAAAA,IAAI,CAAC,GACjBO,GAAmBP,EAAAA,EAAAA,IAAI,MACvBQ,GAAwBR,EAAAA,EAAAA,IAAI,IAG5BS,GAAcC,EAAAA,EAAAA,IAAS,CAC3BC,QAAS,EACTC,SAAU,GACVC,SAAU,KACVC,aAAc,KACdC,SAAU,KACVC,eAAgB,OAIZC,GAAqBC,EAAAA,EAAAA,KAAS,MAC7BT,EAAYI,UACVZ,EAAakB,MAAMC,MAAKC,GAC7BA,EAASC,YAAcb,EAAYI,UACnCQ,EAASE,iBAAmBhB,EAAiBY,UAK3CK,GAAuBN,EAAAA,EAAAA,KAAS,MAAQT,EAAYI,WAGpDY,EAAsBC,UAC1B,IAEE,MAAMC,EAAWC,KAAKC,MAAMC,aAAaC,QAAQ,aAAe,MAGhE,GAFAxB,EAAiBY,MAAQQ,EAASK,IAE7BzB,EAAiBY,MAEpB,YADAc,EAAAA,GAAUC,QAAQ,kBAIpB,MAAMC,QAAiBC,IAAAA,IAAU,uBAAuB7B,EAAiBY,SACzEjB,EAAWiB,MAAQgB,EAASE,KAAKA,MAAQ,GAGzCnC,EAAWiB,MAAMmB,SAAQC,IACvBjC,EAAUa,MAAMoB,EAAOP,IAAMO,EAG7B/B,EAAsBW,MAAMqB,KAAKD,EAAOP,GAAG,GAE/C,CAAE,MAAOS,GACPC,QAAQD,MAAM,YAAaA,GAC3BR,EAAAA,GAAUQ,MAAM,WAClB,GAIIE,EAAqBjB,UACzB,IACE,MAAMS,QAAiBC,IAAAA,IAAU,2BACjCjC,EAAcgB,MAAQgB,EAASE,KAAKA,MAAQ,EAC9C,CAAE,MAAOI,GACPC,QAAQD,MAAM,YAAaA,GAC3BR,EAAAA,GAAUQ,MAAM,WAClB,GAIIG,EAAwBA,KAC5B,MAAMC,GAAc,IAAIC,MAAOC,cACzBC,EAAQ,GACd,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMC,EAAOL,EAAcI,EAC3BD,EAAMR,KAAK,GAAGU,KAAQA,EAAO,IAC/B,CACA9C,EAAce,MAAQ6B,CAAK,EAIvBG,EAAiBzB,UACrB3B,EAAQoB,OAAQ,EAChB,IAEE,MAAMiC,EAAS,IAAK3C,IAGf2C,EAAOvC,UAAYL,EAAsBW,MAAMkC,OAAS,IAE3DD,EAAOE,aAAe9C,EAAsBW,MAAMoC,KAAK,MAIjC,OAApBH,EAAOrC,eAAyCyC,IAApBJ,EAAOrC,WACrCqC,EAAOrC,SAAW0C,OAAOL,EAAOrC,WAIJ,OAA1BqC,EAAOpC,qBAAqDwC,IAA1BJ,EAAOpC,iBAC3CoC,EAAOpC,eAAiByC,OAAOL,EAAOpC,iBAGxC0B,QAAQgB,IAAI,QAASN,GAErB,MAAMjB,QAAiBC,IAAAA,IAAU,uBAAwB,CAAEgB,WAC3D,GAA2B,MAAvBjB,EAASE,KAAKsB,KAAc,CAE9B,MAAMC,EAAUzB,EAASE,KAAKA,KAAKuB,SAAW,GAC9C3D,EAAakB,MAAQyC,EAAQC,KAAIC,IAExB,IACFA,EAEHC,mBAAoBD,EAAOC,oBAAsB,OACjDC,YAAaF,EAAOE,aAAe,OACnCC,cAAeH,EAAOG,eAAiB,OAEvClD,SAAU+C,EAAO/C,SAAW0C,OAAOK,EAAO/C,UAAY,SAI1DV,EAAMc,MAAQgB,EAASE,KAAKA,KAAKhC,OAAS,EAG1CqC,QAAQgB,IAAI,YAAazD,EAAakB,OAClClB,EAAakB,MAAMkC,OAAS,IAC9BX,QAAQgB,IAAI,aAAczD,EAAakB,MAAM,IAC7CuB,QAAQgB,IAAI,UAAWzD,EAAakB,MAAM,GAAG4C,oBAC7CrB,QAAQgB,IAAI,MAAOzD,EAAakB,MAAM,GAAG8C,eACzCvB,QAAQgB,IAAI,MAAOzD,EAAakB,MAAM,GAAGJ,SAAU,aAAcd,EAAakB,MAAM,GAAGJ,WAIrFN,EAAYI,UACd6B,QAAQgB,IAAI,QAASzD,EAAakB,MAEtC,MACEc,EAAAA,GAAUQ,MAAMN,EAASE,KAAK6B,SAAW,WAE7C,CAAE,MAAOzB,GACPC,QAAQD,MAAM,YAAaA,GAC3BR,EAAAA,GAAUQ,MAAM,aAAeA,EAAMN,UAAUE,MAAM6B,SAAWzB,EAAMyB,SAAW,QACnF,CAAE,QACAnE,EAAQoB,OAAQ,CAClB,GAIIgD,EAAaA,KACjB1D,EAAYI,SAAW,KACvBJ,EAAYK,aAAe,KAC3BL,EAAYM,SAAW,KACvBN,EAAYO,eAAiB,KAC7BP,EAAYE,QAAU,EACtBwC,GAAgB,EAIZiB,EAAqBA,KACzB3D,EAAYE,QAAU,EACtBwC,GAAgB,EAIZkB,EAAuB1D,IAC3BF,EAAYE,QAAUA,EACtBwC,GAAgB,EAIZmB,EAAoBC,IACxB9D,EAAYG,SAAW2D,EACvB9D,EAAYE,QAAU,EACtBwC,GAAgB,EAIZqB,EAAoBnD,IACxB,GAAKA,EAASW,GAKd,IAEE,MAAMyC,EAAc,0BAA0BpD,EAASW,KAGjD0C,EAAOC,SAASC,cAAc,KACpCF,EAAKG,KAAOJ,EACZC,EAAKI,aAAa,WAAY,IAC9BH,SAASI,KAAKC,YAAYN,GAC1BA,EAAKO,QAGLC,YAAW,KACTP,SAASI,KAAKI,YAAYT,EAAK,GAC9B,KAGHtC,IAAAA,KAAW,0BAA0Bf,EAASW,MAC3CoD,OAAM3C,GAASC,QAAQD,MAAM,YAAaA,KAE7CR,EAAAA,GAAUoD,QAAQ,SACpB,CAAE,MAAO5C,GACPC,QAAQD,MAAM,UAAWA,GACzBR,EAAAA,GAAUQ,MAAM,SAClB,MA5BER,EAAAA,GAAUC,QAAQ,SA4BpB,EAIIoD,EAAgB5D,UACpB,GAAKjB,EAAYI,SAKjB,IACEd,EAAQoB,OAAQ,EAGhB,MAAMH,EAAiBb,EAAcgB,MAAMoE,MAAKC,GAAQA,EAAKC,OAASC,KAAmB1D,GACzF,IAAKhB,EAEH,YADAiB,EAAAA,GAAUC,QAAQ,MAAMwD,SAK1B,MAAMtC,EAAS,CACbvC,SAAUJ,EAAYI,SACtBG,iBACA2E,cAAepF,EAAiBY,OAG5BgB,QAAiBC,IAAAA,IAAU,8BAA+B,CAAEgB,WAC5DwC,EAAYzD,EAASE,KAAKA,MAAQ,GAExC,IAAKuD,EAAUvC,OAEb,YADApB,EAAAA,GAAUC,QAAQ,gBAAgBwD,WAK9BG,EAAAA,EAAaC,QACjB,YAAYJ,OAAsBE,EAAUvC,iBAC5C,OACA,CACE0C,kBAAmB,KACnBC,iBAAkB,KAClBR,KAAM,SAKVvD,EAAAA,GAAUoD,QAAQ,OAAOO,EAAUvC,UAAUqC,kBAG7C,IAAK,IAAIzC,EAAI,EAAGA,EAAI2C,EAAUvC,OAAQJ,IACpCiC,YAAW,KAET,MAAMT,EAAc,0BAA0BmB,EAAU3C,GAAGjB,KAC3DiE,OAAOC,KAAKzB,EAAa,UAGzBrC,IAAAA,KAAW,0BAA0BwD,EAAU3C,GAAGjB,MAC/CoD,OAAM3C,GAASC,QAAQD,MAAM,YAAaA,IAAO,GAC/C,IAAJQ,EAGP,CAAE,MAAOR,GACO,WAAVA,IACFC,QAAQD,MAAM,KAAKiD,OAAuBjD,GAC1CR,EAAAA,GAAUQ,MAAM,KAAKiD,OAEzB,CAAE,QACA3F,EAAQoB,OAAQ,CAClB,MA/DEc,EAAAA,GAAUC,QAAQ,SA+DpB,E,OAIFiE,EAAAA,EAAAA,KAAU,KACR1E,IACAkB,IACAC,IACAO,GAAgB,I,45JCvdlB,MAAMiD,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://tcr-system-frontend/./src/views/teacher/ResourceSharing.vue","webpack://tcr-system-frontend/./src/views/teacher/ResourceSharing.vue?79bb"],"sourcesContent":["<template>\r\n  <div class=\"resource-sharing-container\">\r\n    <h1>课程资源协同</h1>\r\n    \r\n    <!-- 查询过滤卡片 -->\r\n    <el-card class=\"filter-card\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>查询与下载</span>\r\n        </div>\r\n      </template>\r\n      \r\n      <el-form :inline=\"true\" :model=\"queryParams\" class=\"filter-form\">\r\n        <el-form-item label=\"课程\">\r\n          <el-select \r\n            v-model=\"queryParams.courseId\" \r\n            placeholder=\"选择课程\" \r\n            clearable \r\n            filterable\r\n            style=\"width: 220px;\"\r\n            @change=\"handleCourseChange\"\r\n          >\r\n            <el-option\r\n              v-for=\"course in courseList\"\r\n              :key=\"course.id\"\r\n              :label=\"course.name\"\r\n              :value=\"course.id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"学年\">\r\n          <el-select \r\n            v-model=\"queryParams.academicYear\" \r\n            placeholder=\"选择学年\" \r\n            clearable \r\n            style=\"width: 150px;\"\r\n          >\r\n            <el-option\r\n              v-for=\"year in academicYears\"\r\n              :key=\"year\"\r\n              :label=\"year\"\r\n              :value=\"year\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"学期\">\r\n          <el-select \r\n            v-model=\"queryParams.semester\" \r\n            placeholder=\"选择学期\" \r\n            clearable \r\n            style=\"width: 150px;\"\r\n          >\r\n            <el-option label=\"第一学期\" :value=\"1\"></el-option>\r\n            <el-option label=\"第二学期\" :value=\"2\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"材料类型\">\r\n          <el-select \r\n            v-model=\"queryParams.materialTypeId\" \r\n            placeholder=\"选择材料类型\" \r\n            clearable \r\n            style=\"width: 150px;\"\r\n          >\r\n            <el-option\r\n              v-for=\"type in materialTypes\"\r\n              :key=\"type.id\"\r\n              :label=\"type.name\"\r\n              :value=\"type.id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n        \r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"fetchMaterials\">查询</el-button>\r\n          <el-button @click=\"resetQuery\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-card>\r\n    \r\n    <!-- 同步教学大纲和授课计划按钮 -->\r\n    <el-card class=\"sync-card\" v-if=\"queryParams.courseId\">\r\n      <div class=\"sync-actions\">\r\n        <el-button \r\n          type=\"primary\" \r\n          icon=\"Download\" \r\n          @click=\"syncMaterials('教学大纲')\"\r\n          :disabled=\"!hasCourseMaterials\"\r\n        >\r\n          同步本课程教学大纲\r\n        </el-button>\r\n        <el-button \r\n          type=\"success\" \r\n          icon=\"Download\" \r\n          @click=\"syncMaterials('授课计划')\"\r\n          :disabled=\"!hasCourseMaterials\"\r\n        >\r\n          同步本课程授课计划\r\n        </el-button>\r\n      </div>\r\n      <div class=\"sync-tip\" v-if=\"queryParams.courseId && !hasCourseMaterials\">\r\n        <el-alert\r\n          title=\"当前课程暂无其他教师上传的教学大纲或授课计划\"\r\n          type=\"info\"\r\n          show-icon\r\n          :closable=\"false\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n    \r\n    <!-- 材料列表 -->\r\n    <el-card v-loading=\"loading\" class=\"materials-card\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>\r\n            {{ queryParams.courseId ? courseMap[queryParams.courseId]?.name || '所有课程' : '所有课程' }} 教学资源\r\n          </span>\r\n          <el-tag v-if=\"teacherMaterialsOnly\" type=\"success\">仅显示同课程教师的材料</el-tag>\r\n        </div>\r\n      </template>\r\n      \r\n      <div class=\"materials-tip\" v-if=\"!materialList.length && !loading\">\r\n        <el-empty description=\"暂无符合条件的教学资源\"></el-empty>\r\n      </div>\r\n      \r\n      <el-table \r\n        v-else \r\n        :data=\"materialList\" \r\n        style=\"width: 100%\"\r\n        border\r\n      >\r\n        <el-table-column prop=\"name\" label=\"材料名称\" min-width=\"180\" show-overflow-tooltip />\r\n        <el-table-column prop=\"course_name\" label=\"所属课程\" width=\"150\" show-overflow-tooltip />\r\n        <el-table-column prop=\"material_type_name\" label=\"材料类型\" width=\"120\">\r\n          <template #default=\"scope\">\r\n            {{ scope.row.material_type_name || '未知类型' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"academic_year\" label=\"学年\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            {{ scope.row.academic_year || '未知学年' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"semester\" label=\"学期\" width=\"80\">\r\n          <template #default=\"scope\">\r\n            {{ scope.row.semester === 1 ? '第一学期' : scope.row.semester === 2 ? '第二学期' : '未知学期' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"description\" label=\"描述\" min-width=\"150\" show-overflow-tooltip />\r\n        <el-table-column prop=\"upload_user_name\" label=\"上传教师\" width=\"120\" />\r\n        <el-table-column prop=\"create_time\" label=\"上传时间\" width=\"180\" />\r\n        <el-table-column label=\"操作\" width=\"120\" fixed=\"right\">\r\n          <template #default=\"scope\">\r\n            <el-button \r\n              type=\"primary\" \r\n              size=\"small\" \r\n              icon=\"Download\" \r\n              circle \r\n              plain\r\n              @click=\"downloadMaterial(scope.row)\"\r\n              title=\"下载\"\r\n            />\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      \r\n      <div class=\"pagination-container\">\r\n        <el-pagination\r\n          background\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"total\"\r\n          :page-sizes=\"[10, 20, 50, 100]\"\r\n          :page-size=\"queryParams.pageSize\"\r\n          :current-page=\"queryParams.current\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport axios from 'axios'\r\n\r\n// 状态变量\r\nconst loading = ref(false)\r\nconst materialList = ref([])\r\nconst courseList = ref([])\r\nconst materialTypes = ref([])\r\nconst academicYears = ref([])\r\nconst total = ref(0)\r\nconst courseMap = ref({})\r\nconst currentTeacherId = ref(null)\r\nconst currentTeacherCourses = ref([])\r\n\r\n// 查询参数\r\nconst queryParams = reactive({\r\n  current: 1,\r\n  pageSize: 10,\r\n  courseId: null,\r\n  academicYear: null,\r\n  semester: null,\r\n  materialTypeId: null\r\n})\r\n\r\n// 计算当前课程是否有材料\r\nconst hasCourseMaterials = computed(() => {\r\n  if (!queryParams.courseId) return false\r\n  return materialList.value.some(material => \r\n    material.course_id === queryParams.courseId && \r\n    material.upload_user_id !== currentTeacherId.value\r\n  )\r\n})\r\n\r\n// 是否只显示同课程教师的材料\r\nconst teacherMaterialsOnly = computed(() => !!queryParams.courseId)\r\n\r\n// 获取当前教师可访问的课程\r\nconst fetchTeacherCourses = async () => {\r\n  try {\r\n    // 获取用户信息\r\n    const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}')\r\n    currentTeacherId.value = userInfo.id\r\n    \r\n    if (!currentTeacherId.value) {\r\n      ElMessage.warning('无法获取用户信息，请重新登录')\r\n      return\r\n    }\r\n    \r\n    const response = await axios.get(`/api/course/teacher/${currentTeacherId.value}`)\r\n    courseList.value = response.data.data || []\r\n    \r\n    // 创建课程映射，方便查询\r\n    courseList.value.forEach(course => {\r\n      courseMap.value[course.id] = course\r\n      \r\n      // 记录当前教师的课程ID，用于安全管理\r\n      currentTeacherCourses.value.push(course.id)\r\n    })\r\n  } catch (error) {\r\n    console.error('获取教师课程失败:', error)\r\n    ElMessage.error('获取教师课程失败')\r\n  }\r\n}\r\n\r\n// 获取材料类型列表\r\nconst fetchMaterialTypes = async () => {\r\n  try {\r\n    const response = await axios.get('/api/material-type/list')\r\n    materialTypes.value = response.data.data || []\r\n  } catch (error) {\r\n    console.error('获取材料类型失败:', error)\r\n    ElMessage.error('获取材料类型失败')\r\n  }\r\n}\r\n\r\n// 生成学年列表\r\nconst generateAcademicYears = () => {\r\n  const currentYear = new Date().getFullYear()\r\n  const years = []\r\n  for (let i = 0; i < 5; i++) {\r\n    const year = currentYear - i\r\n    years.push(`${year}-${year + 1}`)\r\n  }\r\n  academicYears.value = years\r\n}\r\n\r\n// 查询教学资源\r\nconst fetchMaterials = async () => {\r\n  loading.value = true;\r\n  try {\r\n    // 调用后端API获取教学资源\r\n    const params = { ...queryParams }\r\n    \r\n    // 安全管理：只能查看同一课程的教学资源\r\n    if (!params.courseId && currentTeacherCourses.value.length > 0) {\r\n      // 转换为字符串，便于后端解析\r\n      params.courseIdsStr = currentTeacherCourses.value.join(',');\r\n    }\r\n    \r\n    // 确保semester是数字类型\r\n    if (params.semester !== null && params.semester !== undefined) {\r\n      params.semester = Number(params.semester);\r\n    }\r\n    \r\n    // 确保materialTypeId是数字类型\r\n    if (params.materialTypeId !== null && params.materialTypeId !== undefined) {\r\n      params.materialTypeId = Number(params.materialTypeId);\r\n    }\r\n    \r\n    console.log('查询参数：', params)\r\n    \r\n    const response = await axios.get('/api/material/shared', { params })\r\n    if (response.data.code === 200) {\r\n      // 处理并格式化返回的数据\r\n      const records = response.data.data.records || [];\r\n      materialList.value = records.map(record => {\r\n        // 确保所有必要字段都存在\r\n        return {\r\n          ...record,\r\n          // 如果缺少某些字段，使用默认值\r\n          material_type_name: record.material_type_name || '未知类型',\r\n          course_name: record.course_name || '未知课程',\r\n          academic_year: record.academic_year || '未知学年',\r\n          // 确保学期为数字类型\r\n          semester: record.semester ? Number(record.semester) : null\r\n        };\r\n      });\r\n      \r\n      total.value = response.data.data.total || 0;\r\n      \r\n      // 打印查询结果，检查字段\r\n      console.log('获取到的材料列表:', materialList.value);\r\n      if (materialList.value.length > 0) {\r\n        console.log('第一条材料数据样例:', materialList.value[0]);\r\n        console.log('材料类型名称:', materialList.value[0].material_type_name);\r\n        console.log('学年:', materialList.value[0].academic_year);\r\n        console.log('学期:', materialList.value[0].semester, '类型:', typeof materialList.value[0].semester);\r\n      }\r\n      \r\n      // 检查是否有课程材料用于同步\r\n      if (queryParams.courseId) {\r\n        console.log('检查材料：', materialList.value)\r\n      }\r\n    } else {\r\n      ElMessage.error(response.data.message || '获取教学资源失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取教学资源失败:', error)\r\n    ElMessage.error('获取教学资源失败：' + (error.response?.data?.message || error.message || '未知错误'))\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 重置查询条件\r\nconst resetQuery = () => {\r\n  queryParams.courseId = null\r\n  queryParams.academicYear = null\r\n  queryParams.semester = null\r\n  queryParams.materialTypeId = null\r\n  queryParams.current = 1\r\n  fetchMaterials()\r\n}\r\n\r\n// 处理课程变化\r\nconst handleCourseChange = () => {\r\n  queryParams.current = 1\r\n  fetchMaterials()\r\n}\r\n\r\n// 处理页码变化\r\nconst handleCurrentChange = (current) => {\r\n  queryParams.current = current\r\n  fetchMaterials()\r\n}\r\n\r\n// 处理每页条数变化\r\nconst handleSizeChange = (size) => {\r\n  queryParams.pageSize = size\r\n  queryParams.current = 1\r\n  fetchMaterials()\r\n}\r\n\r\n// 下载教学资源\r\nconst downloadMaterial = (material) => {\r\n  if (!material.id) {\r\n    ElMessage.warning('材料ID为空')\r\n    return\r\n  }\r\n  \r\n  try {\r\n    // 创建下载链接 - 使用完整的API路径\r\n    const downloadUrl = `/api/material/download/${material.id}`\r\n    \r\n    // 创建一个隐藏的a标签，用于下载\r\n    const link = document.createElement('a')\r\n    link.href = downloadUrl\r\n    link.setAttribute('download', '') // 强制使用下载属性\r\n    document.body.appendChild(link)\r\n    link.click()\r\n    \r\n    // 清理DOM\r\n    setTimeout(() => {\r\n      document.body.removeChild(link)\r\n    }, 100)\r\n    \r\n    // 记录下载次数\r\n    axios.post(`/api/material/download/${material.id}`)\r\n      .catch(error => console.error('更新下载次数失败:', error))\r\n    \r\n    ElMessage.success('开始下载文件')\r\n  } catch (error) {\r\n    console.error('下载文件失败:', error)\r\n    ElMessage.error('下载文件失败')\r\n  }\r\n}\r\n\r\n// 同步教学大纲或授课计划\r\nconst syncMaterials = async (materialTypeName) => {\r\n  if (!queryParams.courseId) {\r\n    ElMessage.warning('请先选择课程')\r\n    return\r\n  }\r\n  \r\n  try {\r\n    loading.value = true\r\n    \r\n    // 查找对应的材料类型ID\r\n    const materialTypeId = materialTypes.value.find(type => type.name === materialTypeName)?.id\r\n    if (!materialTypeId) {\r\n      ElMessage.warning(`未找到${materialTypeName}材料类型`)\r\n      return\r\n    }\r\n    \r\n    // 查询同一课程其他教师上传的教学大纲或授课计划\r\n    const params = {\r\n      courseId: queryParams.courseId,\r\n      materialTypeId,\r\n      excludeUserId: currentTeacherId.value\r\n    }\r\n    \r\n    const response = await axios.get('/api/material/course-shared', { params })\r\n    const materials = response.data.data || []\r\n    \r\n    if (!materials.length) {\r\n      ElMessage.warning(`当前课程没有其他教师上传的${materialTypeName}`)\r\n      return\r\n    }\r\n    \r\n    // 显示确认对话框\r\n    await ElMessageBox.confirm(\r\n      `确定要同步本课程的${materialTypeName}吗？共${materials.length}份资料将被下载。`,\r\n      '确认同步',\r\n      {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'info'\r\n      }\r\n    )\r\n    \r\n    // 批量下载确认\r\n    ElMessage.success(`正在同步${materials.length}份${materialTypeName}资料，请在弹出的窗口中查看`)\r\n    \r\n    // 延迟一点时间，避免浏览器阻止批量下载\r\n    for (let i = 0; i < materials.length; i++) {\r\n      setTimeout(() => {\r\n        // 使用下载API\r\n        const downloadUrl = `/api/material/download/${materials[i].id}`\r\n        window.open(downloadUrl, '_blank')\r\n        \r\n        // 记录下载\r\n        axios.post(`/api/material/download/${materials[i].id}`)\r\n          .catch(error => console.error('更新下载次数失败:', error))\r\n      }, i * 1000) // 每次下载间隔1秒\r\n    }\r\n    \r\n  } catch (error) {\r\n    if (error !== 'cancel') {\r\n      console.error(`同步${materialTypeName}失败:`, error)\r\n      ElMessage.error(`同步${materialTypeName}失败`)\r\n    }\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 页面加载时获取数据\r\nonMounted(() => {\r\n  fetchTeacherCourses()\r\n  fetchMaterialTypes()\r\n  generateAcademicYears()\r\n  fetchMaterials()\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.resource-sharing-container {\r\n  padding: 20px;\r\n  \r\n  h1 {\r\n    margin-bottom: 20px;\r\n    font-size: 24px;\r\n    font-weight: 500;\r\n    color: #303133;\r\n  }\r\n  \r\n  .filter-card {\r\n    margin-bottom: 20px;\r\n  }\r\n  \r\n  .sync-card {\r\n    margin-bottom: 20px;\r\n    \r\n    .sync-actions {\r\n      display: flex;\r\n      gap: 15px;\r\n      margin-bottom: 15px;\r\n    }\r\n    \r\n    .sync-tip {\r\n      margin-top: 10px;\r\n    }\r\n  }\r\n  \r\n  .materials-card {\r\n    .card-header {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n    }\r\n    \r\n    .materials-tip {\r\n      padding: 30px 0;\r\n    }\r\n    \r\n    .pagination-container {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      margin-top: 20px;\r\n    }\r\n  }\r\n}\r\n</style> ","import script from \"./ResourceSharing.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceSharing.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceSharing.vue?vue&type=style&index=0&id=6902cbd9&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6902cbd9\"]])\n\nexport default __exports__"],"names":["loading","ref","materialList","courseList","materialTypes","academicYears","total","courseMap","currentTeacherId","currentTeacherCourses","queryParams","reactive","current","pageSize","courseId","academicYear","semester","materialTypeId","hasCourseMaterials","computed","value","some","material","course_id","upload_user_id","teacherMaterialsOnly","fetchTeacherCourses","async","userInfo","JSON","parse","localStorage","getItem","id","ElMessage","warning","response","axios","data","forEach","course","push","error","console","fetchMaterialTypes","generateAcademicYears","currentYear","Date","getFullYear","years","i","year","fetchMaterials","params","length","courseIdsStr","join","undefined","Number","log","code","records","map","record","material_type_name","course_name","academic_year","message","resetQuery","handleCourseChange","handleCurrentChange","handleSizeChange","size","downloadMaterial","downloadUrl","link","document","createElement","href","setAttribute","body","appendChild","click","setTimeout","removeChild","catch","success","syncMaterials","find","type","name","materialTypeName","excludeUserId","materials","ElMessageBox","confirm","confirmButtonText","cancelButtonText","window","open","onMounted","__exports__"],"sourceRoot":""}