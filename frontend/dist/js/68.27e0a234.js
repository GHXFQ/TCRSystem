"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[68],{9068:function(e,o,l){l.r(o),l.d(o,{default:function(){return b}});var a=l(6768),r=l(144),t=l(5130),s=l(1387),n=l(1219),u=l(788),d=l.n(u),i=l(7477);const c={class:"login-container"},g={class:"login-box"},m={class:"login-options"};var p={__name:"Login",setup(e){const o=(0,s.rd)(),l=(0,r.KR)(null),u=(0,r.KR)(!1),p=(0,r.Kh)({username:"",password:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f=async()=>{if(l.value)try{await l.value.validate(),u.value=!0;try{const e=await d().post("/api/user/login",p);if(200===e.data.code){const{data:l}=e.data;localStorage.setItem("token",l.token),localStorage.setItem("userInfo",JSON.stringify(l)),console.log("登录成功，保存的 token:",l.token),console.log("登录成功，保存的用户信息:",l),setTimeout((()=>{console.log("从 localStorage 获取的 token:",localStorage.getItem("token"))}),100),n.nk.success("登录成功"),0===l.role?o.push("/student/home"):1===l.role?o.push("/teacher/home"):2===l.role&&o.push("/admin/home")}else n.nk.error(e.data.message||"登录失败，请重试")}catch(e){console.error(e),n.nk.error(e.response?.data?.message||"登录失败，请重试")}finally{u.value=!1}}catch(e){console.error("表单验证失败",e)}};return(e,o)=>{const s=(0,a.g2)("el-icon"),n=(0,a.g2)("el-input"),d=(0,a.g2)("el-form-item"),b=(0,a.g2)("el-button"),_=(0,a.g2)("router-link"),h=(0,a.g2)("el-form");return(0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",g,[o[4]||(o[4]=(0,a.Lk)("div",{class:"login-title"},[(0,a.Lk)("h2",null,"教学课程资源管理系统")],-1)),(0,a.bF)(h,{ref_key:"loginForm",ref:l,model:p,rules:k,"label-width":"0",class:"login-form"},{default:(0,a.k6)((()=>[(0,a.bF)(d,{prop:"username"},{default:(0,a.k6)((()=>[(0,a.bF)(n,{modelValue:p.username,"onUpdate:modelValue":o[0]||(o[0]=e=>p.username=e),placeholder:"用户名/学号/工号"},{prefix:(0,a.k6)((()=>[(0,a.bF)(s,null,{default:(0,a.k6)((()=>[(0,a.bF)((0,r.R1)(i.User))])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(d,{prop:"password"},{default:(0,a.k6)((()=>[(0,a.bF)(n,{modelValue:p.password,"onUpdate:modelValue":o[1]||(o[1]=e=>p.password=e),type:"password",placeholder:"密码","show-password":"",onKeyup:(0,t.jR)(f,["enter"])},{prefix:(0,a.k6)((()=>[(0,a.bF)(s,null,{default:(0,a.k6)((()=>[(0,a.bF)((0,r.R1)(i.Lock))])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{type:"primary",loading:u.value,class:"login-button",onClick:f},{default:(0,a.k6)((()=>o[2]||(o[2]=[(0,a.eW)("登录")]))),_:1},8,["loading"])])),_:1}),(0,a.Lk)("div",m,[(0,a.bF)(_,{to:"/register"},{default:(0,a.k6)((()=>o[3]||(o[3]=[(0,a.eW)("没有账号？立即注册")]))),_:1})])])),_:1},8,["model"])])])}}},k=l(1241);const f=(0,k.A)(p,[["__scopeId","data-v-84d82236"]]);var b=f}}]);
//# sourceMappingURL=68.27e0a234.js.map