"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[282],{5282:function(e,a,l){l.r(a),l.d(a,{default:function(){return V}});var d=l(6768),r=l(4232),o=l(144),t=l(1219),u=l(2933),s=l(788),i=l.n(s);const n={class:"teacher-management"},c={class:"filter-container"},m={class:"operation-container"},p={class:"pagination-container"},h={class:"dialog-footer"},v={key:0,class:"mt-10"},b={key:0,class:"mt-10"},k={key:0,class:"mt-10"},g={class:"dialog-footer"};var I={__name:"TeacherManagement",setup(e){const a=(0,o.Kh)({pageNum:1,pageSize:10,realName:"",username:"",titleType:void 0}),l=(0,o.KR)([]),s=(0,o.KR)([]),I=(0,o.KR)(0),f=(0,o.KR)(!1),y=(0,o.KR)(!1),V=(0,o.KR)(""),F=(0,o.KR)("add"),_=(0,o.KR)(null),w=(0,o.Kh)({id:void 0,username:"",realName:"",password:"",email:"",phone:"",status:1,role:1}),C={username:[{required:!0,message:"请输入工号",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:"add"===F,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},L=(0,o.KR)(!1),j=(0,o.KR)(null),W=(0,o.KR)({}),T=(0,o.Kh)({teacherId:void 0,isNormalTeacher:!1,isCourseLeader:!1,isMajorLeader:!1,isViceDean:!1,courseId:void 0,majorId:void 0,collegeId:void 0,hasCourseLeader:!1,hasMajorLeader:!1,hasViceDean:!1}),N=(0,o.KR)([]),U=(0,o.KR)([]),D=(0,o.KR)([]),K=async()=>{f.value=!0;try{const e=await i().get("/api/admin/teacher/list",{params:a});200===e.data.code&&(l.value=e.data.data.records,I.value=e.data.data.total)}catch(e){console.error("获取教师列表失败:",e),t.nk.error("获取教师列表失败")}finally{f.value=!1}},M=async()=>{try{const e=await i().get("/api/admin/teacher/titles");200===e.data.code&&(s.value=e.data.data)}catch(e){console.error("获取教师职称列表失败:",e),t.nk.error("获取教师职称列表失败")}},X=async()=>{try{const e=await i().get("/api/course/list",{params:{pageNum:1,pageSize:100}});200===e.data.code&&(N.value=e.data.data.records)}catch(e){console.error("获取课程列表失败:",e),t.nk.error("获取课程列表失败")}},R=async()=>{try{const e=await i().get("/api/admin/major/list");200===e.data.code&&(U.value=e.data.data)}catch(e){console.error("获取专业列表失败:",e),t.nk.error("获取专业列表失败")}},z=async()=>{try{const e=await i().get("/api/admin/college/list");200===e.data.code&&(D.value=e.data.data)}catch(e){console.error("获取学院列表失败:",e),t.nk.error("获取学院列表失败")}},Q=()=>{a.realName="",a.username="",a.titleType=void 0,K()},x=e=>{a.pageNum=e,K()},E=e=>{a.pageSize=e,K()},S=()=>{F.value="add",V.value="添加教师",w.id=void 0,w.username="",w.realName="",w.password="",w.email="",w.phone="",w.status=1,w.role=1,y.value=!0},q=e=>{F.value="edit",V.value="编辑教师",w.id=e.id,w.username=e.username,w.realName=e.realName,w.password="",w.email=e.email,w.phone=e.phone,w.status=e.status,w.role=e.role,y.value=!0},B=e=>{u.s.confirm("确定要删除该教师吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const a=await i()["delete"](`/api/admin/teacher/${e.id}`);200===a.data.code?(t.nk.success("删除成功"),K()):t.nk.error(a.data.message||"删除失败")}catch(a){console.error("删除教师失败:",a),t.nk.error("删除教师失败")}})).catch((()=>{}))},A=async e=>{try{const a=await i().put("/api/admin/teacher/status",{id:e.id,status:e.status});200===a.data.code?t.nk.success((1===e.status?"启用":"禁用")+"成功"):(t.nk.error(a.data.message||"操作失败"),e.status=1===e.status?0:1)}catch(a){console.error("修改状态失败:",a),t.nk.error("修改状态失败"),e.status=1===e.status?0:1}},$=()=>{_.value.validate((async e=>{if(e)try{let e;e="add"===F.value?await i().post("/api/admin/teacher",w):await i().put("/api/admin/teacher",w),200===e.data.code?(t.nk.success("add"===F.value?"添加成功":"修改成功"),y.value=!1,K()):t.nk.error(e.data.message||("add"===F.value?"添加失败":"修改失败"))}catch(a){console.error("add"===F.value?"添加教师失败:":"修改教师失败:",a),t.nk.error("add"===F.value?"添加教师失败":"修改教师失败")}}))},G=(e,a)=>s.value.some((l=>l.teacherId===e&&l.titleType===a)),H=async e=>{try{W.value=e,T.teacherId=e.id,T.isNormalTeacher=G(e.id,0),T.isCourseLeader=G(e.id,1),T.isMajorLeader=G(e.id,2),T.isViceDean=G(e.id,3);const a=s.value.find((a=>a.teacherId===e.id&&1===a.titleType));T.courseId=a?a.courseId:void 0;const l=s.value.find((a=>a.teacherId===e.id&&2===a.titleType));T.majorId=l?l.majorId:void 0;const d=s.value.find((a=>a.teacherId===e.id&&3===a.titleType));T.collegeId=d?d.collegeId:void 0,T.isCourseLeader&&!T.courseId&&N.value.length>0&&(T.courseId=N.value[0].id),T.isMajorLeader&&!T.majorId&&U.value.length>0&&(T.majorId=U.value[0].id),T.isViceDean&&!T.collegeId&&D.value.length>0&&(T.collegeId=D.value[0].id),T.courseId?T.hasCourseLeader=s.value.some((a=>1===a.titleType&&a.teacherId!==e.id&&a.courseId===T.courseId)):T.hasCourseLeader=!1,T.majorId?T.hasMajorLeader=s.value.some((a=>2===a.titleType&&a.teacherId!==e.id&&a.majorId===T.majorId)):T.hasMajorLeader=!1,T.collegeId?T.hasViceDean=s.value.some((a=>3===a.titleType&&a.teacherId!==e.id&&a.collegeId===T.collegeId)):T.hasViceDean=!1,L.value=!0}catch(a){console.error("设置教师职称时出错:",a),t.nk.error("设置教师职称时出错，请刷新页面后重试")}},J=async()=>{try{if(T.isCourseLeader&&!T.courseId)return void t.nk.warning("请选择负责的课程");if(T.isMajorLeader&&!T.majorId)return void t.nk.warning("请选择负责的专业");if(T.isViceDean&&!T.collegeId)return void t.nk.warning("请选择所属学院");const e=await i().post("/api/admin/teacher/titles",{teacherId:T.teacherId,isNormalTeacher:T.isNormalTeacher,isCourseLeader:T.isCourseLeader,isMajorLeader:T.isMajorLeader,isViceDean:T.isViceDean,courseId:T.courseId,majorId:T.majorId,collegeId:T.collegeId});200===e.data.code?(t.nk.success("设置职称成功"),L.value=!1,M(),K()):t.nk.error(e.data.message||"设置职称失败")}catch(e){console.error("设置职称失败:",e),t.nk.error("设置职称失败，请刷新页面后重试")}},O=()=>{try{T.teacherId=void 0,T.isNormalTeacher=!1,T.isCourseLeader=!1,T.isMajorLeader=!1,T.isViceDean=!1,T.courseId=void 0,T.majorId=void 0,T.collegeId=void 0,T.hasCourseLeader=!1,T.hasMajorLeader=!1,T.hasViceDean=!1,W.value={}}catch(e){console.error("关闭对话框重置表单时出错:",e)}},P=e=>{e?!T.courseId&&N.value.length>0&&(T.courseId=N.value[0].id,T.hasCourseLeader=s.value.some((e=>1===e.titleType&&e.teacherId!==T.teacherId&&e.courseId===T.courseId))):(T.courseId=void 0,T.hasCourseLeader=!1)},Y=e=>{T.hasCourseLeader=s.value.some((a=>1===a.titleType&&a.teacherId!==T.teacherId&&a.courseId===e))},Z=e=>{e?!T.majorId&&U.value.length>0&&(T.majorId=U.value[0].id,T.hasMajorLeader=s.value.some((e=>2===e.titleType&&e.teacherId!==T.teacherId&&e.majorId===T.majorId))):(T.majorId=void 0,T.hasMajorLeader=!1)},ee=e=>{T.hasMajorLeader=s.value.some((a=>2===a.titleType&&a.teacherId!==T.teacherId&&a.majorId===e))},ae=e=>{e?!T.collegeId&&D.value.length>0&&(T.collegeId=D.value[0].id,T.hasViceDean=s.value.some((e=>3===e.titleType&&e.teacherId!==T.teacherId&&e.collegeId===T.collegeId))):(T.collegeId=void 0,T.hasViceDean=!1)},le=e=>{T.hasViceDean=s.value.some((a=>3===a.titleType&&a.teacherId!==T.teacherId&&a.collegeId===e))};return(0,d.sV)((()=>{K(),M(),X(),R(),z()})),(e,o)=>{const t=(0,d.g2)("el-input"),u=(0,d.g2)("el-form-item"),s=(0,d.g2)("el-option"),i=(0,d.g2)("el-select"),M=(0,d.g2)("el-button"),X=(0,d.g2)("el-form"),R=(0,d.g2)("el-card"),z=(0,d.g2)("el-table-column"),de=(0,d.g2)("el-tag"),re=(0,d.g2)("el-switch"),oe=(0,d.g2)("el-table"),te=(0,d.g2)("el-pagination"),ue=(0,d.g2)("el-radio"),se=(0,d.g2)("el-radio-group"),ie=(0,d.g2)("el-dialog"),ne=(0,d.g2)("el-divider"),ce=(0,d.gN)("loading");return(0,d.uX)(),(0,d.CE)("div",n,[o[39]||(o[39]=(0,d.Lk)("h1",null,"教师管理",-1)),(0,d.bF)(R,{class:"filter-card"},{default:(0,d.k6)((()=>[(0,d.Lk)("div",c,[(0,d.bF)(X,{inline:!0,model:a,class:"demo-form-inline"},{default:(0,d.k6)((()=>[(0,d.bF)(u,{label:"教师姓名"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:a.realName,"onUpdate:modelValue":o[0]||(o[0]=e=>a.realName=e),placeholder:"请输入教师姓名",clearable:""},null,8,["modelValue"])])),_:1}),(0,d.bF)(u,{label:"工号"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:a.username,"onUpdate:modelValue":o[1]||(o[1]=e=>a.username=e),placeholder:"请输入工号",clearable:""},null,8,["modelValue"])])),_:1}),(0,d.bF)(u,{label:"职称"},{default:(0,d.k6)((()=>[(0,d.bF)(i,{modelValue:a.titleType,"onUpdate:modelValue":o[2]||(o[2]=e=>a.titleType=e),placeholder:"请选择职称",clearable:""},{default:(0,d.k6)((()=>[(0,d.bF)(s,{label:"普通教师",value:0}),(0,d.bF)(s,{label:"课程负责人",value:1}),(0,d.bF)(s,{label:"专业负责人",value:2}),(0,d.bF)(s,{label:"副院长",value:3})])),_:1},8,["modelValue"])])),_:1}),(0,d.bF)(u,null,{default:(0,d.k6)((()=>[(0,d.bF)(M,{type:"primary",onClick:K},{default:(0,d.k6)((()=>o[21]||(o[21]=[(0,d.eW)("查询")]))),_:1}),(0,d.bF)(M,{onClick:Q},{default:(0,d.k6)((()=>o[22]||(o[22]=[(0,d.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),(0,d.Lk)("div",m,[(0,d.bF)(M,{type:"primary",onClick:S},{default:(0,d.k6)((()=>o[23]||(o[23]=[(0,d.eW)("添加教师")]))),_:1})])])),_:1}),(0,d.bF)(R,{class:"table-card"},{default:(0,d.k6)((()=>[(0,d.bo)(((0,d.uX)(),(0,d.Wv)(oe,{data:l.value,style:{width:"100%"}},{default:(0,d.k6)((()=>[(0,d.bF)(z,{prop:"id",label:"ID",width:"80"}),(0,d.bF)(z,{prop:"username",label:"工号",width:"120"}),(0,d.bF)(z,{prop:"realName",label:"姓名",width:"120"}),(0,d.bF)(z,{prop:"email",label:"邮箱"}),(0,d.bF)(z,{prop:"phone",label:"手机号"}),(0,d.bF)(z,{label:"职称"},{default:(0,d.k6)((e=>[G(e.row.id,0)?((0,d.uX)(),(0,d.Wv)(de,{key:0,type:"info"},{default:(0,d.k6)((()=>o[24]||(o[24]=[(0,d.eW)("普通教师")]))),_:1})):(0,d.Q3)("",!0),G(e.row.id,1)?((0,d.uX)(),(0,d.Wv)(de,{key:1,type:"success"},{default:(0,d.k6)((()=>o[25]||(o[25]=[(0,d.eW)("课程负责人")]))),_:1})):(0,d.Q3)("",!0),G(e.row.id,2)?((0,d.uX)(),(0,d.Wv)(de,{key:2,type:"warning"},{default:(0,d.k6)((()=>o[26]||(o[26]=[(0,d.eW)("专业负责人")]))),_:1})):(0,d.Q3)("",!0),G(e.row.id,3)?((0,d.uX)(),(0,d.Wv)(de,{key:3,type:"danger"},{default:(0,d.k6)((()=>o[27]||(o[27]=[(0,d.eW)("副院长")]))),_:1})):(0,d.Q3)("",!0)])),_:1}),(0,d.bF)(z,{label:"状态",width:"100"},{default:(0,d.k6)((e=>[(0,d.bF)(re,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":0,onChange:a=>A(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,d.bF)(z,{label:"操作",width:"250"},{default:(0,d.k6)((e=>[(0,d.bF)(M,{type:"primary",size:"small",onClick:a=>q(e.row)},{default:(0,d.k6)((()=>o[28]||(o[28]=[(0,d.eW)("编辑")]))),_:2},1032,["onClick"]),(0,d.bF)(M,{type:"success",size:"small",onClick:a=>H(e.row)},{default:(0,d.k6)((()=>o[29]||(o[29]=[(0,d.eW)("设置职称")]))),_:2},1032,["onClick"]),(0,d.bF)(M,{type:"danger",size:"small",onClick:a=>B(e.row)},{default:(0,d.k6)((()=>o[30]||(o[30]=[(0,d.eW)("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[ce,f.value]]),(0,d.Lk)("div",p,[(0,d.bF)(te,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:I.value,"page-size":a.pageSize,"current-page":a.pageNum,"page-sizes":[10,20,50,100],onCurrentChange:x,onSizeChange:E},null,8,["total","page-size","current-page"])])])),_:1}),(0,d.bF)(ie,{title:V.value,modelValue:y.value,"onUpdate:modelValue":o[11]||(o[11]=e=>y.value=e),width:"500px"},{footer:(0,d.k6)((()=>[(0,d.Lk)("span",h,[(0,d.bF)(M,{onClick:o[10]||(o[10]=e=>y.value=!1)},{default:(0,d.k6)((()=>o[34]||(o[34]=[(0,d.eW)("取消")]))),_:1}),(0,d.bF)(M,{type:"primary",onClick:$},{default:(0,d.k6)((()=>o[35]||(o[35]=[(0,d.eW)("确定")]))),_:1})])])),default:(0,d.k6)((()=>[(0,d.bF)(X,{model:w,rules:C,ref_key:"teacherFormRef",ref:_,"label-width":"100px"},{default:(0,d.k6)((()=>[(0,d.bF)(u,{label:"工号",prop:"username"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:w.username,"onUpdate:modelValue":o[3]||(o[3]=e=>w.username=e),placeholder:"请输入工号"},null,8,["modelValue"])])),_:1}),(0,d.bF)(u,{label:"姓名",prop:"realName"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:w.realName,"onUpdate:modelValue":o[4]||(o[4]=e=>w.realName=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),"add"===F.value?((0,d.uX)(),(0,d.Wv)(u,{key:0,label:"密码",prop:"password"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:w.password,"onUpdate:modelValue":o[5]||(o[5]=e=>w.password=e),placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1})):(0,d.Q3)("",!0),"edit"===F.value?((0,d.uX)(),(0,d.Wv)(u,{key:1,label:"修改密码"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:w.password,"onUpdate:modelValue":o[6]||(o[6]=e=>w.password=e),placeholder:"不修改请留空","show-password":""},null,8,["modelValue"]),o[31]||(o[31]=(0,d.Lk)("span",{class:"tip-text"},"不修改密码请留空",-1))])),_:1})):(0,d.Q3)("",!0),(0,d.bF)(u,{label:"邮箱",prop:"email"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:w.email,"onUpdate:modelValue":o[7]||(o[7]=e=>w.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),(0,d.bF)(u,{label:"手机号",prop:"phone"},{default:(0,d.k6)((()=>[(0,d.bF)(t,{modelValue:w.phone,"onUpdate:modelValue":o[8]||(o[8]=e=>w.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),(0,d.bF)(u,{label:"状态",prop:"status"},{default:(0,d.k6)((()=>[(0,d.bF)(se,{modelValue:w.status,"onUpdate:modelValue":o[9]||(o[9]=e=>w.status=e)},{default:(0,d.k6)((()=>[(0,d.bF)(ue,{label:1},{default:(0,d.k6)((()=>o[32]||(o[32]=[(0,d.eW)("启用")]))),_:1}),(0,d.bF)(ue,{label:0},{default:(0,d.k6)((()=>o[33]||(o[33]=[(0,d.eW)("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"]),(0,d.bF)(ie,{title:"设置教师职称",modelValue:L.value,"onUpdate:modelValue":o[20]||(o[20]=e=>L.value=e),width:"600px",onClosed:O},{footer:(0,d.k6)((()=>[(0,d.Lk)("span",g,[(0,d.bF)(M,{onClick:o[19]||(o[19]=e=>L.value=!1)},{default:(0,d.k6)((()=>o[37]||(o[37]=[(0,d.eW)("取消")]))),_:1}),(0,d.bF)(M,{type:"primary",onClick:J},{default:(0,d.k6)((()=>o[38]||(o[38]=[(0,d.eW)("确定")]))),_:1})])])),default:(0,d.k6)((()=>[(0,d.bF)(X,{model:T,ref_key:"titleFormRef",ref:j,"label-width":"120px"},{default:(0,d.k6)((()=>[(0,d.bF)(u,{label:"教师"},{default:(0,d.k6)((()=>[(0,d.Lk)("span",null,(0,r.v_)(W.value.realName),1)])),_:1}),(0,d.bF)(ne,{"content-position":"left"},{default:(0,d.k6)((()=>o[36]||(o[36]=[(0,d.eW)("职称设置")]))),_:1}),(0,d.bF)(u,{label:"普通教师"},{default:(0,d.k6)((()=>[(0,d.bF)(re,{modelValue:T.isNormalTeacher,"onUpdate:modelValue":o[12]||(o[12]=e=>T.isNormalTeacher=e)},null,8,["modelValue"])])),_:1}),T.isCourseLeader||!T.hasCourseLeader?((0,d.uX)(),(0,d.Wv)(u,{key:0,label:"课程负责人"},{default:(0,d.k6)((()=>[(0,d.bF)(re,{modelValue:T.isCourseLeader,"onUpdate:modelValue":o[13]||(o[13]=e=>T.isCourseLeader=e),onChange:P},null,8,["modelValue"]),T.isCourseLeader?((0,d.uX)(),(0,d.CE)("div",v,[(0,d.bF)(i,{modelValue:T.courseId,"onUpdate:modelValue":o[14]||(o[14]=e=>T.courseId=e),placeholder:"请选择负责的课程",style:{width:"100%"},filterable:"",clearable:!1,onChange:Y},{default:(0,d.k6)((()=>[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(N.value,(e=>((0,d.uX)(),(0,d.Wv)(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):(0,d.Q3)("",!0)])),_:1})):(0,d.Q3)("",!0),T.isMajorLeader||!T.hasMajorLeader?((0,d.uX)(),(0,d.Wv)(u,{key:1,label:"专业负责人"},{default:(0,d.k6)((()=>[(0,d.bF)(re,{modelValue:T.isMajorLeader,"onUpdate:modelValue":o[15]||(o[15]=e=>T.isMajorLeader=e),onChange:Z},null,8,["modelValue"]),T.isMajorLeader?((0,d.uX)(),(0,d.CE)("div",b,[(0,d.bF)(i,{modelValue:T.majorId,"onUpdate:modelValue":o[16]||(o[16]=e=>T.majorId=e),placeholder:"请选择负责的专业",style:{width:"100%"},filterable:"",clearable:!1,onChange:ee},{default:(0,d.k6)((()=>[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(U.value,(e=>((0,d.uX)(),(0,d.Wv)(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):(0,d.Q3)("",!0)])),_:1})):(0,d.Q3)("",!0),T.isViceDean||!T.hasViceDean?((0,d.uX)(),(0,d.Wv)(u,{key:2,label:"副院长"},{default:(0,d.k6)((()=>[(0,d.bF)(re,{modelValue:T.isViceDean,"onUpdate:modelValue":o[17]||(o[17]=e=>T.isViceDean=e),onChange:ae},null,8,["modelValue"]),T.isViceDean?((0,d.uX)(),(0,d.CE)("div",k,[(0,d.bF)(i,{modelValue:T.collegeId,"onUpdate:modelValue":o[18]||(o[18]=e=>T.collegeId=e),placeholder:"请选择所属学院",style:{width:"100%"},filterable:"",clearable:!1,onChange:le},{default:(0,d.k6)((()=>[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(D.value,(e=>((0,d.uX)(),(0,d.Wv)(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):(0,d.Q3)("",!0)])),_:1})):(0,d.Q3)("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},f=l(1241);const y=(0,f.A)(I,[["__scopeId","data-v-560cd0fb"]]);var V=y}}]);
//# sourceMappingURL=282.76e8c8db.js.map