{"version":3,"file":"js/68.27e0a234.js","mappings":"mXAuCA,MAAMA,GAASC,EAAAA,EAAAA,MACTC,GAAYC,EAAAA,EAAAA,IAAI,MAChBC,GAAUD,EAAAA,EAAAA,KAAI,GAEdE,GAAYC,EAAAA,EAAAA,IAAS,CACzBC,SAAU,GACVC,SAAU,KAGNC,EAAQ,CACZF,SAAU,CACR,CAAEG,UAAU,EAAMC,QAAS,SAAUC,QAAS,SAEhDJ,SAAU,CACR,CAAEE,UAAU,EAAMC,QAAS,QAASC,QAAS,UAI3CC,EAAcC,UAClB,GAAKZ,EAAUa,MAEf,UACQb,EAAUa,MAAMC,WACtBZ,EAAQW,OAAQ,EAEhB,IACE,MAAME,QAAiBC,IAAAA,KAAW,kBAAmBb,GAErD,GAA2B,MAAvBY,EAASE,KAAKC,KAAc,CAC9B,MAAM,KAAED,GAASF,EAASE,KAG1BE,aAAaC,QAAQ,QAASH,EAAKI,OACnCF,aAAaC,QAAQ,WAAYE,KAAKC,UAAUN,IAEhDO,QAAQC,IAAI,kBAAmBR,EAAKI,OACpCG,QAAQC,IAAI,gBAAiBR,GAG7BS,YAAW,KACTF,QAAQC,IAAI,4BAA6BN,aAAaQ,QAAQ,SAAS,GACtE,KAEHC,EAAAA,GAAUC,QAAQ,QAGA,IAAdZ,EAAKa,KACPhC,EAAOiC,KAAK,iBACW,IAAdd,EAAKa,KACdhC,EAAOiC,KAAK,iBACW,IAAdd,EAAKa,MACdhC,EAAOiC,KAAK,cAEhB,MACEH,EAAAA,GAAUI,MAAMjB,EAASE,KAAKR,SAAW,WAE7C,CAAE,MAAOuB,GACPR,QAAQQ,MAAMA,GACdJ,EAAAA,GAAUI,MAAMA,EAAMjB,UAAUE,MAAMR,SAAW,WACnD,CAAE,QACAP,EAAQW,OAAQ,CAClB,CACF,CAAE,MAAOmB,GACPR,QAAQQ,MAAM,SAAUA,EAC1B,G,m5CCjGF,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://tcr-system-frontend/./src/views/Login.vue","webpack://tcr-system-frontend/./src/views/Login.vue?240b"],"sourcesContent":["<template>\r\n  <div class=\"login-container\">\r\n    <div class=\"login-box\">\r\n      <div class=\"login-title\">\r\n        <h2>教学课程资源管理系统</h2>\r\n      </div>\r\n      <el-form ref=\"loginForm\" :model=\"loginData\" :rules=\"rules\" label-width=\"0\" class=\"login-form\">\r\n        <el-form-item prop=\"username\">\r\n          <el-input v-model=\"loginData.username\" placeholder=\"用户名/学号/工号\">\r\n            <template #prefix>\r\n              <el-icon><User /></el-icon>\r\n            </template>\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"password\">\r\n          <el-input v-model=\"loginData.password\" type=\"password\" placeholder=\"密码\" show-password @keyup.enter=\"handleLogin\">\r\n            <template #prefix>\r\n              <el-icon><Lock /></el-icon>\r\n            </template>\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" :loading=\"loading\" class=\"login-button\" @click=\"handleLogin\">登录</el-button>\r\n        </el-form-item>\r\n        <div class=\"login-options\">\r\n          <router-link to=\"/register\">没有账号？立即注册</router-link>\r\n        </div>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport axios from 'axios'\r\nimport { User, Lock } from '@element-plus/icons-vue'\r\n\r\nconst router = useRouter()\r\nconst loginForm = ref(null)\r\nconst loading = ref(false)\r\n\r\nconst loginData = reactive({\r\n  username: '',\r\n  password: ''\r\n})\r\n\r\nconst rules = {\r\n  username: [\r\n    { required: true, message: '请输入用户名', trigger: 'blur' }\r\n  ],\r\n  password: [\r\n    { required: true, message: '请输入密码', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\nconst handleLogin = async () => {\r\n  if (!loginForm.value) return\r\n  \r\n  try {\r\n    await loginForm.value.validate()\r\n    loading.value = true\r\n    \r\n    try {\r\n      const response = await axios.post('/api/user/login', loginData)\r\n      \r\n      if (response.data.code === 200) {\r\n        const { data } = response.data\r\n        \r\n        // 保存token和用户信息到localStorage\r\n        localStorage.setItem('token', data.token)\r\n        localStorage.setItem('userInfo', JSON.stringify(data))\r\n        \r\n        console.log('登录成功，保存的 token:', data.token)\r\n        console.log('登录成功，保存的用户信息:', data)\r\n        \r\n        // 测试 localStorage 是否正确保存了 token\r\n        setTimeout(() => {\r\n          console.log('从 localStorage 获取的 token:', localStorage.getItem('token'))\r\n        }, 100)\r\n        \r\n        ElMessage.success('登录成功')\r\n        \r\n        // 根据角色跳转到不同的首页\r\n        if (data.role === 0) {\r\n          router.push('/student/home')\r\n        } else if (data.role === 1) {\r\n          router.push('/teacher/home')\r\n        } else if (data.role === 2) {\r\n          router.push('/admin/home')\r\n        }\r\n      } else {\r\n        ElMessage.error(response.data.message || '登录失败，请重试')\r\n      }\r\n    } catch (error) {\r\n      console.error(error)\r\n      ElMessage.error(error.response?.data?.message || '登录失败，请重试')\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  } catch (error) {\r\n    console.error('表单验证失败', error)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.login-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100vh;\r\n  background-color: #f5f7fa;\r\n}\r\n\r\n.login-box {\r\n  width: 400px;\r\n  padding: 30px;\r\n  background-color: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.login-title {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.login-title h2 {\r\n  font-weight: 500;\r\n  color: #409eff;\r\n}\r\n\r\n.login-form {\r\n  margin-top: 20px;\r\n}\r\n\r\n.login-button {\r\n  width: 100%;\r\n}\r\n\r\n.login-options {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  margin-top: 10px;\r\n  font-size: 14px;\r\n}\r\n\r\n.login-options a {\r\n  color: #409eff;\r\n  text-decoration: none;\r\n}\r\n</style> ","import script from \"./Login.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Login.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Login.vue?vue&type=style&index=0&id=84d82236&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-84d82236\"]])\n\nexport default __exports__"],"names":["router","useRouter","loginForm","ref","loading","loginData","reactive","username","password","rules","required","message","trigger","handleLogin","async","value","validate","response","axios","data","code","localStorage","setItem","token","JSON","stringify","console","log","setTimeout","getItem","ElMessage","success","role","push","error","__exports__"],"sourceRoot":""}