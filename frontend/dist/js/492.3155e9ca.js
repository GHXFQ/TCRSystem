"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[492],{1492:function(e,a,t){t.r(a),t.d(a,{default:function(){return P}});var l=t(6768),s=t(4232),n=t(144),u=t(1387),i=t(788),o=t.n(i),r=t(1219);const c={class:"assignment-detail"},d={class:"page-header"},v={class:"card-header"},k={class:"assignment-info"},m={class:"meta-info"},p={key:0},f={class:"description"},g={class:"description-content"},h={key:0,class:"submission-section"},_={class:"submission-info"},b={key:0},y={class:"submission-content"},L={class:"content-box"},w={key:1,class:"feedback"},C={class:"content-box"},F={key:1,class:"submit-form"},W={class:"el-upload__tip"},X={key:0,class:"uploaded-file"};var N={__name:"AssignmentDetail",setup(e){const a=(0,u.rd)(),t=(0,u.lq)(),i=(0,n.KR)(t.params.id),N=(0,n.KR)({}),E=(0,n.KR)({}),K=(0,n.KR)(!1),P=(0,n.KR)(!1),I=(0,n.Kh)({content:"",filePath:"",fileSize:0,fileType:"",fileName:""}),R=(0,n.KR)([]),A=(0,n.Kh)({Authorization:`Bearer ${localStorage.getItem("token")}`});(0,l.sV)((()=>{x()}));const x=async()=>{K.value=!0;try{const e=await o().get(`/api/assignment/${i.value}`);if(200===e.data.code){N.value=e.data.data||{};const a=await o().get(`/api/assignment/submission/assignment/${i.value}`);200===a.data.code&&(E.value=a.data.data||{})}else r.nk.error(e.data.message||"获取作业详情失败")}catch(e){console.error("获取作业详情失败:",e),r.nk.error("获取作业详情失败")}finally{K.value=!1}},z=async()=>{if(I.content||I.filePath){P.value=!0;try{const e=new FormData;e.append("assignmentId",i.value),e.append("content",I.content),R.value.length>0&&e.append("filePath",I.filePath);const a=await o().post("/api/assignment/submission",e,{headers:{"Content-Type":"multipart/form-data"}});200===a.data.code?(r.nk.success("提交成功"),x()):r.nk.error(a.data.message||"提交失败")}catch(e){console.error("提交失败:",e),r.nk.error("提交失败："+(e.response?.data?.message||e.message))}finally{P.value=!1}}else r.nk.warning("请输入作业内容或上传文件")},B=e=>{200===e.code?(I.filePath=e.data.filePath,I.fileName=e.data.fileName,r.nk.success("文件上传成功")):r.nk.error(e.message||"文件上传失败")},D=()=>{r.nk.error("文件上传失败")},Q=e=>{const a=e.size/1024/1024<50;return!!a||(r.nk.error("文件大小不能超过50MB"),!1)},S=e=>{if(e)try{const a=`/api/assignment/submission/download/${e}`,t=document.createElement("a");t.href=a,t.setAttribute("download",""),document.body.appendChild(t),t.click(),setTimeout((()=>{document.body.removeChild(t)}),100),r.nk.success("开始下载文件")}catch(a){console.error("下载文件失败:",a),r.nk.error("下载文件失败")}else r.nk.warning("提交ID为空")},T=()=>{a.push({name:"StudentAssignments",query:{courseId:N.value.courseId}})},V=e=>{if(!e)return"未知时间";const a=new Date(e);return a.toLocaleString()},$=e=>{switch(e){case 0:return"danger";case 1:return"success";case 2:return"info";default:return""}},q=e=>{switch(e){case 0:return"已关闭";case 1:return"进行中";case 2:return"已结束";default:return"未知"}};return(e,a)=>{const t=(0,l.g2)("el-page-header"),n=(0,l.g2)("el-tag"),u=(0,l.g2)("el-button"),i=(0,l.g2)("el-input"),o=(0,l.g2)("el-form-item"),r=(0,l.g2)("el-upload"),x=(0,l.g2)("el-form"),M=(0,l.g2)("el-card"),U=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",d,[(0,l.bF)(t,{onBack:T,title:N.value.courseName||"课程作业",content:N.value.title||"作业详情"},null,8,["title","content"])]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(M,{class:"assignment-card"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",v,[a[4]||(a[4]=(0,l.Lk)("span",null,"作业详情",-1)),(0,l.Lk)("div",null,[(0,l.bF)(n,{type:$(N.value.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(q(N.value.status)),1)])),_:1},8,["type"]),E.value.id?((0,l.uX)(),(0,l.Wv)(n,{key:0,type:"success",class:"ml-10"},{default:(0,l.k6)((()=>a[2]||(a[2]=[(0,l.eW)("已提交")]))),_:1})):((0,l.uX)(),(0,l.Wv)(n,{key:1,type:"danger",class:"ml-10"},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)("未提交")]))),_:1}))])])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",k,[(0,l.Lk)("h2",null,(0,s.v_)(N.value.title),1),(0,l.Lk)("div",m,[(0,l.Lk)("span",null,"课程："+(0,s.v_)(N.value.courseName),1),(0,l.Lk)("span",null,"教师："+(0,s.v_)(N.value.teacherName),1),(0,l.Lk)("span",null,"截止日期："+(0,s.v_)(V(N.value.deadline)),1),null!==E.value.score&&void 0!==E.value.score?((0,l.uX)(),(0,l.CE)("span",p,"得分："+(0,s.v_)(E.value.score),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",f,[a[5]||(a[5]=(0,l.Lk)("h3",null,"作业描述",-1)),(0,l.Lk)("div",g,(0,s.v_)(N.value.description),1)]),E.value.id?((0,l.uX)(),(0,l.CE)("div",h,[a[11]||(a[11]=(0,l.Lk)("h3",null,"我的提交",-1)),(0,l.Lk)("div",_,[(0,l.Lk)("p",null,[a[6]||(a[6]=(0,l.Lk)("strong",null,"提交时间：",-1)),(0,l.eW)((0,s.v_)(V(E.value.createTime)),1)]),E.value.filePath?((0,l.uX)(),(0,l.CE)("p",b,[a[8]||(a[8]=(0,l.Lk)("strong",null,"提交文件：",-1)),(0,l.eW)((0,s.v_)(E.value.fileName)+" ",1),(0,l.bF)(u,{type:"primary",size:"small",onClick:a[0]||(a[0]=e=>S(E.value.id))},{default:(0,l.k6)((()=>a[7]||(a[7]=[(0,l.eW)("下载")]))),_:1})])):(0,l.Q3)("",!0),(0,l.Lk)("div",y,[a[9]||(a[9]=(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,"提交内容：")],-1)),(0,l.Lk)("div",L,(0,s.v_)(E.value.content),1)]),1===E.value.status?((0,l.uX)(),(0,l.CE)("div",w,[a[10]||(a[10]=(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,"教师评语：")],-1)),(0,l.Lk)("div",C,(0,s.v_)(E.value.comment||"无评语"),1)])):(0,l.Q3)("",!0)])])):((0,l.uX)(),(0,l.CE)("div",F,[a[15]||(a[15]=(0,l.Lk)("h3",null,"提交作业",-1)),(0,l.bF)(x,{model:I,"label-width":"100px"},{default:(0,l.k6)((()=>[(0,l.bF)(o,{label:"提交内容"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:I.content,"onUpdate:modelValue":a[1]||(a[1]=e=>I.content=e),type:"textarea",rows:6,placeholder:"请输入作业内容"},null,8,["modelValue"])])),_:1}),(0,l.bF)(o,{label:"上传文件"},{default:(0,l.k6)((()=>[(0,l.bF)(r,{class:"upload-demo",action:"/api/assignment/submission/upload",headers:A,"on-success":B,"on-error":D,"before-upload":Q,"file-list":R.value,limit:1},{tip:(0,l.k6)((()=>[(0,l.Lk)("div",W,[a[13]||(a[13]=(0,l.eW)(" 支持任意类型文件，单个文件不超过50MB ")),I.filePath?((0,l.uX)(),(0,l.CE)("div",X," 已上传: "+(0,s.v_)(I.fileName),1)):(0,l.Q3)("",!0)])])),default:(0,l.k6)((()=>[(0,l.bF)(u,{type:"primary"},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)("点击上传")]))),_:1})])),_:1},8,["headers","file-list"])])),_:1}),(0,l.bF)(o,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{type:"primary",onClick:z,loading:P.value},{default:(0,l.k6)((()=>a[14]||(a[14]=[(0,l.eW)("提交作业")]))),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])]))])])),_:1})),[[U,K.value]])])}}},E=t(1241);const K=(0,E.A)(N,[["__scopeId","data-v-901e7f16"]]);var P=K}}]);
//# sourceMappingURL=492.3155e9ca.js.map