"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[390],{9390:function(e,a,t){t.r(a),t.d(a,{default:function(){return J}});var l=t(6768),s=t(4232),n=t(144),i=t(1387),r=t(1219),o=t(788),u=t.n(o);const d={class:"assignment-submissions-container"},c={class:"page-header"},v={class:"title-section"},m={key:0,class:"info-section"},k={class:"statistics-row"},p={class:"stat-box"},b={class:"stat-value"},f={class:"stat-box"},g={class:"stat-value"},_={class:"stat-box"},y={class:"stat-value"},w={class:"stat-box"},h={class:"stat-value"},L={class:"stat-box"},F={class:"stat-value"},C={class:"stat-box"},x={class:"stat-value"},W={key:0,class:"empty-tip"},V={key:0,class:"submission-content"},X={key:1,class:"submission-content empty"},z={key:1},I={class:"pagination-container"},R={key:0,class:"grading-form"},E={class:"submission-info"},K={class:"info-row"},S={class:"info-value"},N={class:"info-row"},q={class:"info-value content"},O={key:0,class:"content-text"},$={key:1,class:"content-text empty"},Q={key:0,class:"info-row"},U={class:"info-value"},A={class:"info-row"},T={class:"info-value"},D={class:"grading-section"},P={class:"score-hint"},j={class:"dialog-footer"};var B={__name:"AssignmentSubmissions",setup(e){const a=(0,i.lq)(),t=(0,i.rd)(),o=(0,n.KR)(!1),B=(0,n.KR)(!1),G=(0,n.KR)([]),H=(0,n.KR)(0),J=(0,n.KR)(null),M=(0,n.KR)(null),Y=(0,n.KR)(!1),Z=(0,n.KR)(null),ee=(0,n.Kh)({current:1,pageSize:10,assignmentId:null,status:null}),ae=(0,n.KR)(null),te=(0,n.Kh)({id:null,score:0,comment:""}),le={score:[{required:!0,message:"请输入分数",trigger:"blur"}]},se=(0,l.EW)((()=>a.query.title?`作业: ${a.query.title}`:"作业提交列表")),ne=e=>{switch(e){case 0:return"danger";case 1:return"primary";case 2:return"success";default:return"info"}},ie=e=>{switch(e){case 0:return"已关闭";case 1:return"进行中";case 2:return"已结束";default:return"未知"}},re=e=>{switch(e){case 0:return"warning";case 1:return"success";default:return"info"}},oe=e=>{switch(e){case 0:return"已提交";case 1:return"已批改";default:return"未知"}},ue=()=>{t.go(-1)},de=async()=>{try{const e=a.query.assignmentId;if(!e)return void r.nk.warning("未指定作业ID");const t=await u().get(`/api/assignment/${e}`);200===t.data.code?J.value=t.data.data:r.nk.error(t.data.message||"获取作业信息失败")}catch(e){console.error("获取作业信息失败:",e),r.nk.error("获取作业信息失败")}},ce=async()=>{try{const e=a.query.assignmentId;if(!e)return;const t=await u().get(`/api/assignment/submission/statistics/${e}`);200===t.data.code&&(M.value=t.data.data)}catch(e){console.error("获取提交统计失败:",e),r.nk.error("获取提交统计失败")}},ve=async()=>{o.value=!0;try{const e=a.query.assignmentId;if(!e)return r.nk.warning("未指定作业ID"),void(o.value=!1);ee.assignmentId=e;const t={current:ee.current,size:ee.pageSize,assignmentId:ee.assignmentId,status:ee.status},l=await u().get("/api/assignment/submission/list",{params:t});200===l.data.code?(G.value=l.data.data.records||[],H.value=l.data.data.total||0):r.nk.error(l.data.message||"获取提交列表失败")}catch(e){console.error("获取提交列表失败:",e),r.nk.error("获取提交列表失败："+(e.response?.data?.message||e.message))}finally{o.value=!1}},me=()=>{ee.status=null,ee.current=1,ve()},ke=e=>{ee.current=e,ve()},pe=e=>{ee.pageSize=e,ee.current=1,ve()},be=e=>{Z.value=e,te.id=e.id,te.score=null!==e.score&&void 0!==e.score?e.score:0,te.comment=e.comment||"",Y.value=!0,setTimeout((()=>{ae.value?.clearValidate()}),0)},fe=async()=>{ae.value&&await ae.value.validate((async e=>{if(!e)return!1;B.value=!0;try{const e={id:te.id,score:te.score,comment:te.comment},a=await u().post("/api/assignment/grade",null,{params:e});if(200===a.data.code){r.nk.success("评分提交成功"),Y.value=!1;const e=G.value.findIndex((e=>e.id===te.id));-1!==e&&(G.value[e].score=te.score,G.value[e].comment=te.comment,G.value[e].status=2),ce()}else r.nk.error(a.data.message||"评分提交失败")}catch(a){console.error("评分提交失败:",a),r.nk.error("评分提交失败："+(a.response?.data?.message||a.message))}finally{B.value=!1}}))};return(0,l.sV)((async()=>{await de(),await ve(),await ce()})),(e,a)=>{const t=(0,l.g2)("el-button"),n=(0,l.g2)("el-tag"),i=(0,l.g2)("el-card"),r=(0,l.g2)("el-option"),u=(0,l.g2)("el-select"),de=(0,l.g2)("el-form-item"),ce=(0,l.g2)("el-form"),ge=(0,l.g2)("el-empty"),_e=(0,l.g2)("el-table-column"),ye=(0,l.g2)("el-link"),we=(0,l.g2)("el-table"),he=(0,l.g2)("el-pagination"),Le=(0,l.g2)("el-input-number"),Fe=(0,l.g2)("el-input"),Ce=(0,l.g2)("el-dialog"),xe=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",c,[(0,l.Lk)("div",v,[(0,l.bF)(t,{onClick:ue,icon:"ArrowLeft",circle:"",plain:""}),(0,l.Lk)("h1",null,(0,s.v_)(se.value||"作业提交列表"),1)]),J.value?((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)(n,{type:ne(J.value.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(ie(J.value.status)),1)])),_:1},8,["type"]),(0,l.Lk)("span",null,"所属课程: "+(0,s.v_)(J.value.courseName),1),(0,l.Lk)("span",null,"截止时间: "+(0,s.v_)(J.value.deadline),1)])):(0,l.Q3)("",!0)]),M.value?((0,l.uX)(),(0,l.Wv)(i,{key:0,class:"statistics-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",k,[(0,l.Lk)("div",p,[(0,l.Lk)("div",b,(0,s.v_)(M.value.totalStudents||0),1),a[5]||(a[5]=(0,l.Lk)("div",{class:"stat-label"},"学生总数",-1))]),(0,l.Lk)("div",f,[(0,l.Lk)("div",g,(0,s.v_)(M.value.submittedCount||0),1),a[6]||(a[6]=(0,l.Lk)("div",{class:"stat-label"},"已提交",-1))]),(0,l.Lk)("div",_,[(0,l.Lk)("div",y,(0,s.v_)(M.value.submissionRate||"0%"),1),a[7]||(a[7]=(0,l.Lk)("div",{class:"stat-label"},"提交率",-1))]),(0,l.Lk)("div",w,[(0,l.Lk)("div",h,(0,s.v_)(M.value.gradedCount||0),1),a[8]||(a[8]=(0,l.Lk)("div",{class:"stat-label"},"已批改",-1))]),(0,l.Lk)("div",L,[(0,l.Lk)("div",F,(0,s.v_)(M.value.gradingRate||"0%"),1),a[9]||(a[9]=(0,l.Lk)("div",{class:"stat-label"},"批改率",-1))]),(0,l.Lk)("div",C,[(0,l.Lk)("div",x,(0,s.v_)(M.value.avgScore||"暂无"),1),a[10]||(a[10]=(0,l.Lk)("div",{class:"stat-label"},"平均分",-1))])])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(i,{class:"filter-card"},{default:(0,l.k6)((()=>[(0,l.bF)(ce,{inline:!0,model:ee,class:"filter-form"},{default:(0,l.k6)((()=>[(0,l.bF)(de,{label:"状态"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:ee.status,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.status=e),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:(0,l.k6)((()=>[(0,l.bF)(r,{label:"已提交",value:0}),(0,l.bF)(r,{label:"已批改",value:1})])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(de,null,{default:(0,l.k6)((()=>[(0,l.bF)(t,{type:"primary",onClick:ve},{default:(0,l.k6)((()=>a[11]||(a[11]=[(0,l.eW)("查询")]))),_:1}),(0,l.bF)(t,{onClick:me},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(i,{class:"submissions-card"},{default:(0,l.k6)((()=>[G.value.length||o.value?((0,l.uX)(),(0,l.Wv)(we,{key:1,data:G.value,style:{width:"100%"},border:""},{default:(0,l.k6)((()=>[(0,l.bF)(_e,{prop:"studentName",label:"学生姓名",width:"120"}),(0,l.bF)(_e,{prop:"studentId",label:"学号",width:"100"}),(0,l.bF)(_e,{prop:"courseName",label:"所属课程",width:"150","show-overflow-tooltip":""}),(0,l.bF)(_e,{prop:"content",label:"提交内容","min-width":"200","show-overflow-tooltip":""},{default:(0,l.k6)((e=>[e.row.content?((0,l.uX)(),(0,l.CE)("div",V,(0,s.v_)(e.row.content),1)):((0,l.uX)(),(0,l.CE)("div",X,"无文本内容"))])),_:1}),(0,l.bF)(_e,{prop:"fileName",label:"提交文件",width:"180","show-overflow-tooltip":""},{default:(0,l.k6)((e=>[e.row.filePath?((0,l.uX)(),(0,l.Wv)(ye,{key:0,href:`/api/assignment/submission/download/${e.row.id}`,target:"_blank",type:"primary"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.row.fileName||"下载文件"),1)])),_:2},1032,["href"])):((0,l.uX)(),(0,l.CE)("span",z,"无文件"))])),_:1}),(0,l.bF)(_e,{prop:"status",label:"状态",width:"100"},{default:(0,l.k6)((e=>[(0,l.bF)(n,{type:re(e.row.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(oe(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,l.bF)(_e,{prop:"isOverdue",label:"是否逾期",width:"100"},{default:(0,l.k6)((e=>[(0,l.bF)(n,{type:e.row.isOverdue?"danger":"success",size:"small"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.row.isOverdue?"已逾期":"按时提交"),1)])),_:2},1032,["type"])])),_:1}),(0,l.bF)(_e,{prop:"score",label:"得分",width:"80",align:"center"},{default:(0,l.k6)((e=>[(0,l.eW)((0,s.v_)(null!==e.row.score&&void 0!==e.row.score?e.row.score:"未批改"),1)])),_:1}),(0,l.bF)(_e,{prop:"createTime",label:"提交时间",width:"180"}),(0,l.bF)(_e,{label:"操作",width:"120",fixed:"right"},{default:(0,l.k6)((e=>[(0,l.bF)(t,{type:"primary",size:"small",plain:"",onClick:a=>be(e.row)},{default:(0,l.k6)((()=>a[13]||(a[13]=[(0,l.eW)("批改")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):((0,l.uX)(),(0,l.CE)("div",W,[(0,l.bF)(ge,{description:"暂无符合条件的作业提交"})])),(0,l.Lk)("div",I,[(0,l.bF)(he,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:H.value,"page-sizes":[10,20,50,100],"page-size":ee.pageSize,"current-page":ee.current,onSizeChange:pe,onCurrentChange:ke},null,8,["total","page-size","current-page"])])])),_:1})),[[xe,o.value]]),(0,l.bF)(Ce,{modelValue:Y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.value=e),title:"批改作业",width:"600px","close-on-click-modal":!1},{footer:(0,l.k6)((()=>[(0,l.Lk)("span",j,[(0,l.bF)(t,{onClick:a[3]||(a[3]=e=>Y.value=!1)},{default:(0,l.k6)((()=>a[20]||(a[20]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(t,{type:"primary",onClick:fe,loading:B.value},{default:(0,l.k6)((()=>a[21]||(a[21]=[(0,l.eW)("提交评分")]))),_:1},8,["loading"])])])),default:(0,l.k6)((()=>[Z.value?((0,l.uX)(),(0,l.CE)("div",R,[(0,l.Lk)("div",E,[a[18]||(a[18]=(0,l.Lk)("h3",null,"提交信息",-1)),(0,l.Lk)("div",K,[a[14]||(a[14]=(0,l.Lk)("div",{class:"info-label"},"学生",-1)),(0,l.Lk)("div",S,(0,s.v_)(Z.value.studentName)+" ("+(0,s.v_)(Z.value.studentId)+")",1)]),(0,l.Lk)("div",N,[a[15]||(a[15]=(0,l.Lk)("div",{class:"info-label"},"提交内容",-1)),(0,l.Lk)("div",q,[Z.value.content?((0,l.uX)(),(0,l.CE)("div",O,(0,s.v_)(Z.value.content),1)):((0,l.uX)(),(0,l.CE)("div",$,"无文本内容"))])]),Z.value.filePath?((0,l.uX)(),(0,l.CE)("div",Q,[a[16]||(a[16]=(0,l.Lk)("div",{class:"info-label"},"提交文件",-1)),(0,l.Lk)("div",U,[(0,l.bF)(ye,{href:`/api/assignment/submission/download/${Z.value.id}`,target:"_blank",type:"primary"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(Z.value.fileName||"下载文件"),1)])),_:1},8,["href"])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",A,[a[17]||(a[17]=(0,l.Lk)("div",{class:"info-label"},"提交时间",-1)),(0,l.Lk)("div",T,[(0,l.eW)((0,s.v_)(Z.value.createTime)+" ",1),(0,l.bF)(n,{type:Z.value.isOverdue?"danger":"success",size:"small",style:{"margin-left":"10px"}},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(Z.value.isOverdue?"已逾期":"按时提交"),1)])),_:1},8,["type"])])])]),(0,l.Lk)("div",D,[a[19]||(a[19]=(0,l.Lk)("h3",null,"评分",-1)),(0,l.bF)(ce,{model:te,rules:le,ref_key:"gradeFormRef",ref:ae,"label-width":"80px"},{default:(0,l.k6)((()=>[(0,l.bF)(de,{label:"得分",prop:"score"},{default:(0,l.k6)((()=>[(0,l.bF)(Le,{modelValue:te.score,"onUpdate:modelValue":a[1]||(a[1]=e=>te.score=e),min:0,max:J.value?.maxScore||100,step:1,style:{width:"120px"}},null,8,["modelValue","max"]),(0,l.Lk)("span",P,"满分: "+(0,s.v_)(J.value?.maxScore||100),1)])),_:1}),(0,l.bF)(de,{label:"评语",prop:"comment"},{default:(0,l.k6)((()=>[(0,l.bF)(Fe,{modelValue:te.comment,"onUpdate:modelValue":a[2]||(a[2]=e=>te.comment=e),type:"textarea",rows:4,placeholder:"请输入评语"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])):(0,l.Q3)("",!0)])),_:1},8,["modelValue"])])}}},G=t(1241);const H=(0,G.A)(B,[["__scopeId","data-v-b7c18006"]]);var J=H}}]);
//# sourceMappingURL=390.898b95d7.js.map