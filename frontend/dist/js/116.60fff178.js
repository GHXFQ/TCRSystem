"use strict";(self["webpackChunktcr_system_frontend"]=self["webpackChunktcr_system_frontend"]||[]).push([[116],{6116:function(e,a,t){t.r(a),t.d(a,{default:function(){return z}});var l=t(6768),o=t(4232),s=t(144),r=t(782),c=t(1387),n=t(788),i=t.n(n),d=t(7477),u=t(1219);const v={class:"teacher-home"},k={class:"welcome-section"},p={class:"welcome-content"},g={class:"welcome-text"},h={class:"subtitle"},m={class:"stats-content"},f={class:"stat-item"},w={class:"stat-icon upload"},b={class:"stat-info"},_={class:"stat-value"},y={class:"stat-item"},F={class:"stat-icon review"},L={class:"stat-info"},I={class:"stat-value"},S={class:"quick-actions"},C={class:"action-content"},D={class:"action-text"},W={class:"recent-section"},E={class:"card-header"},X={key:0},N={class:"card-header"},R={key:0},O={class:"tasks-section"},T={class:"card-header"},J={key:0};var x={__name:"Home",setup(e){const a=(0,r.Pj)(),t=(0,c.rd)(),n=(0,l.EW)((()=>a.state.user)),x=(0,l.EW)((()=>{const e=new Date;return`${e.getFullYear()}年${e.getMonth()+1}月${e.getDate()}日`})),K=(0,s.KR)(0),$=(0,s.KR)(0),z=[{title:"上传材料",description:"上传新的教学材料",icon:"Upload",iconClass:"upload-icon",path:"/teacher/material-upload"},{title:"材料审核",description:"查看材料审核状态",icon:"Document",iconClass:"review-icon",path:"/teacher/material-review"},{title:"返回首页",description:"回到教师首页",icon:"HomeFilled",iconClass:"home-icon",path:"/teacher/home"}],U=(0,s.KR)([]),M=(0,s.KR)([]),V=(0,s.KR)([]),q=(0,s.KR)(0),Y=async()=>{console.log("开始获取用户信息");try{const e=localStorage.getItem("token");if(!e)throw console.error("用户未登录，请先登录"),u.nk.warning("用户未登录，请先登录"),t.push("/login"),new Error("未登录");if(n.value&&n.value.id)return console.log("从store获取到用户信息:",n.value),n.value;const l=JSON.parse(localStorage.getItem("userInfo")||"{}");if(l&&l.id)return a.commit("SET_USER",l),console.log("从localStorage获取并设置用户信息:",l),l;console.log("从服务器获取用户信息");const o=await i().get("/api/user/info");if(200===o.data.code&&o.data.data)return a.commit("SET_USER",o.data.data),localStorage.setItem("userInfo",JSON.stringify(o.data.data)),console.log("从服务器获取并设置用户信息成功:",o.data.data),o.data.data;throw console.warn("获取用户信息失败:",o.data),t.push("/login"),new Error("获取用户信息失败")}catch(e){throw console.error("获取用户信息出错:",e),t.push("/login"),e}},j=async()=>{try{let e=n.value?.id;if(!e){console.warn("从Vuex未获取到教师ID，尝试从localStorage获取");const a=JSON.parse(localStorage.getItem("userInfo")||"{}");e=a.id}if(!e)return void console.error("无法获取教师ID，请重新登录");console.log("开始获取最近上传材料，教师ID:",e);const a=await i().get("/api/material/teacher",{params:{current:1,size:5,teacherId:e,type:0}});console.log("最近上传材料响应:",a.data),a.data&&200===a.data.code&&a.data.data?(U.value=a.data.data.records||[],K.value=a.data.data.total||0,console.log("已设置最近上传材料数据:",U.value.length),console.log("已设置上传总数:",K.value)):(console.warn("获取最近上传材料返回异常:",a.data),U.value=[],K.value=0)}catch(e){console.error("获取最近上传材料失败:",e),U.value=[],K.value=0}},A=async()=>{try{let e=n.value?.id;if(!e){console.warn("从Vuex未获取到教师ID，尝试从localStorage获取");const a=JSON.parse(localStorage.getItem("userInfo")||"{}");e=a.id}if(!e)return void console.error("无法获取教师ID，请重新登录");console.log("开始获取待审核材料，教师ID:",e);const a=await i().get("/api/material-review/teacher-submit",{params:{current:1,size:5,teacherId:e}});if(console.log("待审核材料响应:",a.data),a.data&&200===a.data.code&&a.data.data){M.value=a.data.data.records||[],console.log("已设置待审核材料数据:",M.value.length);const e=M.value.filter((e=>1===e.status||2===e.status||3===e.status||4===e.status)).length;$.value=e,console.log("已设置审核中数量:",$.value)}else console.warn("获取待审核材料返回异常:",a.data),M.value=[],$.value=0}catch(e){console.error("获取待审核材料失败:",e),M.value=[],$.value=0}},H=e=>{switch(e){case 0:return"待审核";case 1:return"课程负责人审核中";case 2:return"专业负责人审核中";case 3:return"副院长审核中";case 4:return"教务人员审核中";case 5:return"审核通过";case 6:return"审核不通过";default:return"未知状态"}},B=e=>{switch(e){case 0:return"info";case 1:case 2:case 3:case 4:return"warning";case 5:return"success";case 6:return"danger";default:return"info"}},P=e=>{t.push(e)},Q=async()=>{console.log("======= 开始执行fetchMaterialTasks函数 =======",(new Date).toISOString());try{let e=n.value?.id;if(!e){console.warn("从Vuex未获取到教师ID，尝试从localStorage获取");const a=JSON.parse(localStorage.getItem("userInfo")||"{}");e=a.id}if(!e)throw console.error("无法获取教师ID，未加载用户信息"),new Error("无法获取教师ID");console.log("开始获取教师任务列表，教师ID:",e),console.log("请求URL:","/api/material-task/teacher/tasks");const a={url:"/api/material-task/teacher/tasks",method:"get",params:{teacherId:e},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}};console.log("请求配置:",JSON.stringify(a)),console.log("正在发送请求...");const t=await i()(a);console.log("接收到教师任务列表响应:",t.status),console.log("响应数据:",JSON.stringify(t.data)),200===t.data.code?(V.value=t.data.data||[],console.log("成功获取任务列表，数量:",V.value.length),V.value.length>0?console.log("任务列表第一项:",JSON.stringify(V.value[0])):console.warn("任务列表为空"),q.value=V.value.filter((e=>!e.completed)).length,console.log("未完成任务数量:",q.value)):(console.error("获取教师任务列表失败:",t.data.message),V.value=[],q.value=0)}catch(e){console.error("获取教学材料任务失败:",e),console.error("错误详情:",e.response||e.message||e),V.value=[],q.value=0,u.nk.error("获取任务列表失败: "+(e.message||"未知错误"))}finally{console.log("======= fetchMaterialTasks函数执行结束 =======")}},G=e=>{if(!e)return!1;const a=new Date(e),t=new Date;return a<t},Z=e=>{t.push({path:"/teacher/material-upload",query:{taskId:e.id,materialTypeId:e.materialTypeId,courseId:e.courseId,academicYear:e.academicYear,semester:e.semester}})},ee=e=>{e&&window.open(`/api/material/download/${e}`,"_blank")};return(0,l.sV)((()=>{console.log("====== 教师首页组件挂载 ======"),Y().then((()=>{console.log("用户信息获取完成，开始获取任务数据"),j(),A(),console.log("准备调用fetchMaterialTasks函数"),Q()})).catch((e=>{console.error("获取用户信息失败，无法继续获取任务:",e)}))})),(e,a)=>{const t=(0,l.g2)("el-card"),r=(0,l.g2)("el-col"),c=(0,l.g2)("el-icon"),i=(0,l.g2)("el-row"),u=(0,l.g2)("el-button"),Y=(0,l.g2)("el-table-column"),j=(0,l.g2)("el-table"),A=(0,l.g2)("el-empty"),Q=(0,l.g2)("el-tag"),ae=(0,l.g2)("el-badge");return(0,l.uX)(),(0,l.CE)("div",v,[(0,l.Lk)("div",k,[(0,l.bF)(i,{gutter:20},{default:(0,l.k6)((()=>[(0,l.bF)(r,{span:16},{default:(0,l.k6)((()=>[(0,l.bF)(t,{class:"welcome-card",shadow:"hover"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",p,[(0,l.Lk)("div",g,[(0,l.Lk)("h2",null,"欢迎回来，"+(0,o.v_)(n.value?.realName||"老师"),1),(0,l.Lk)("p",h,"今天是 "+(0,o.v_)(x.value)+"，祝您工作愉快！",1),a[2]||(a[2]=(0,l.Lk)("p",{class:"description"},"您可以在这里上传教学材料并提交审核，查看审核进度和结果。",-1))]),a[3]||(a[3]=(0,l.Lk)("div",{class:"welcome-image"},[(0,l.Lk)("img",{src:"https://img.icons8.com/color/240/000000/teacher.png",alt:"教师图标"})],-1))])])),_:1})])),_:1}),(0,l.bF)(r,{span:8},{default:(0,l.k6)((()=>[(0,l.bF)(t,{class:"quick-stats",shadow:"hover"},{header:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("span",null,"数据概览")],-1)]))),default:(0,l.k6)((()=>[(0,l.Lk)("div",m,[(0,l.Lk)("div",f,[(0,l.Lk)("div",w,[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,s.R1)(d.Upload))])),_:1})]),(0,l.Lk)("div",b,[(0,l.Lk)("div",_,(0,o.v_)(K.value),1),a[5]||(a[5]=(0,l.Lk)("div",{class:"stat-label"},"已上传材料",-1))])]),(0,l.Lk)("div",y,[(0,l.Lk)("div",F,[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,s.R1)(d.Document))])),_:1})]),(0,l.Lk)("div",L,[(0,l.Lk)("div",I,(0,o.v_)($.value),1),a[6]||(a[6]=(0,l.Lk)("div",{class:"stat-label"},"审核中材料",-1))])])])])),_:1})])),_:1})])),_:1})]),(0,l.Lk)("div",S,[(0,l.bF)(i,{gutter:20},{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(z,((e,a)=>(0,l.bF)(r,{span:8,key:a},{default:(0,l.k6)((()=>[(0,l.bF)(t,{class:"action-card",shadow:"hover",onClick:a=>P(e.path)},{default:(0,l.k6)((()=>[(0,l.Lk)("div",C,[(0,l.Lk)("div",{class:(0,o.C4)(["action-icon",e.iconClass])},[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.Wv)((0,l.$y)(e.icon)))])),_:2},1024)],2),(0,l.Lk)("div",D,[(0,l.Lk)("h3",null,(0,o.v_)(e.title),1),(0,l.Lk)("p",null,(0,o.v_)(e.description),1)])])])),_:2},1032,["onClick"])])),_:2},1024))),64))])),_:1})]),(0,l.Lk)("div",W,[(0,l.bF)(i,{gutter:20},{default:(0,l.k6)((()=>[(0,l.bF)(r,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(t,{shadow:"hover"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",E,[a[8]||(a[8]=(0,l.Lk)("span",null,"最近上传的材料",-1)),(0,l.bF)(u,{type:"primary",text:"",onClick:a[0]||(a[0]=e=>P("/teacher/material-upload"))},{default:(0,l.k6)((()=>a[7]||(a[7]=[(0,l.eW)("查看全部")]))),_:1})])])),default:(0,l.k6)((()=>[U.value.length>0?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.bF)(j,{data:U.value,style:{width:"100%"}},{default:(0,l.k6)((()=>[(0,l.bF)(Y,{prop:"name",label:"材料名称",width:"180"}),(0,l.bF)(Y,{prop:"course_name",label:"所属课程"}),(0,l.bF)(Y,{prop:"create_time",label:"上传时间",width:"180"})])),_:1},8,["data"])])):((0,l.uX)(),(0,l.Wv)(A,{key:1,description:"暂无上传记录"}))])),_:1})])),_:1}),(0,l.bF)(r,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(t,{shadow:"hover"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",N,[a[10]||(a[10]=(0,l.Lk)("span",null,"待审核的材料",-1)),(0,l.bF)(u,{type:"primary",text:"",onClick:a[1]||(a[1]=e=>P("/teacher/material-review"))},{default:(0,l.k6)((()=>a[9]||(a[9]=[(0,l.eW)("查看全部")]))),_:1})])])),default:(0,l.k6)((()=>[M.value.length>0?((0,l.uX)(),(0,l.CE)("div",R,[(0,l.bF)(j,{data:M.value,style:{width:"100%"}},{default:(0,l.k6)((()=>[(0,l.bF)(Y,{prop:"material_name",label:"材料名称",width:"180"}),(0,l.bF)(Y,{prop:"status",label:"状态"},{default:(0,l.k6)((e=>[(0,l.bF)(Q,{type:B(e.row.status)},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(H(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,l.bF)(Y,{prop:"current_reviewer_name",label:"当前审核人"})])),_:1},8,["data"])])):((0,l.uX)(),(0,l.Wv)(A,{key:1,description:"暂无待审核材料"}))])),_:1})])),_:1})])),_:1})]),(0,l.Lk)("div",O,[(0,l.bF)(t,{shadow:"hover"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",T,[a[11]||(a[11]=(0,l.Lk)("span",null,"教学材料任务",-1)),(0,l.bF)(ae,{value:q.value,hidden:0===q.value,type:"warning"},{default:(0,l.k6)((()=>[q.value>0?((0,l.uX)(),(0,l.Wv)(Q,{key:0,type:"warning"},{default:(0,l.k6)((()=>[(0,l.eW)("有 "+(0,o.v_)(q.value)+" 个任务待完成",1)])),_:1})):(0,l.Q3)("",!0)])),_:1},8,["value","hidden"])])])),default:(0,l.k6)((()=>[V.value.length>0?((0,l.uX)(),(0,l.CE)("div",J,[(0,l.bF)(j,{data:V.value,style:{width:"100%"}},{default:(0,l.k6)((()=>[(0,l.bF)(Y,{prop:"title",label:"任务标题",width:"250"}),(0,l.bF)(Y,{prop:"materialTypeName",label:"材料类型",width:"120"}),(0,l.bF)(Y,{prop:"courseName",label:"课程",width:"180"}),(0,l.bF)(Y,{prop:"deadline",label:"截止日期",width:"180"}),(0,l.bF)(Y,{label:"状态",width:"100"},{default:(0,l.k6)((e=>[(0,l.bF)(Q,{type:e.row.completed?"success":G(e.row.deadline)?"danger":"warning"},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.completed?"已完成":G(e.row.deadline)?"已过期":"未完成"),1)])),_:2},1032,["type"])])),_:1}),(0,l.bF)(Y,{label:"操作"},{default:(0,l.k6)((e=>[e.row.completed?((0,l.uX)(),(0,l.Wv)(u,{key:1,type:"success",size:"small",onClick:a=>ee(e.row.materialId)},{default:(0,l.k6)((()=>a[13]||(a[13]=[(0,l.eW)(" 查看 ")]))),_:2},1032,["onClick"])):((0,l.uX)(),(0,l.Wv)(u,{key:0,type:"primary",size:"small",onClick:a=>Z(e.row)},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)(" 上传材料 ")]))),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data"])])):((0,l.uX)(),(0,l.Wv)(A,{key:1,description:"暂无教学材料任务"}))])),_:1})])])}}},K=t(1241);const $=(0,K.A)(x,[["__scopeId","data-v-0d4c2d74"]]);var z=$}}]);
//# sourceMappingURL=116.60fff178.js.map