{"ast":null,"code":"import { createStore } from 'vuex';\nimport axios from 'axios';\nimport router from '@/router';\nimport user from './modules/user';\n\n// 创建axios实例\nconst api = axios.create({\n  baseURL: process.env.VUE_APP_API_URL || '/api',\n  timeout: 10000\n});\n\n// 请求拦截器\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers['Authorization'] = token;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// 响应拦截器\napi.interceptors.response.use(response => {\n  return response.data;\n}, error => {\n  if (error.response && error.response.status === 401) {\n    // 401 清除token信息并跳转到登录页面\n    store.commit('clearAuth');\n    router.push('/login');\n  }\n  return Promise.reject(error.response ? error.response.data : error);\n});\nconst store = createStore({\n  state: {\n    token: localStorage.getItem('token') || '',\n    userInfo: JSON.parse(localStorage.getItem('userInfo') || '{}')\n  },\n  getters: {\n    isLoggedIn: state => !!state.token,\n    userRole: state => state.userInfo.role || -1,\n    userInfo: state => state.userInfo,\n    token: state => state.token\n  },\n  mutations: {\n    setToken(state, token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n    },\n    setUser(state, user) {\n      state.userInfo = user;\n      localStorage.setItem('userInfo', JSON.stringify(user));\n    },\n    clearAuth(state) {\n      state.token = '';\n      state.userInfo = {};\n      localStorage.removeItem('token');\n      localStorage.removeItem('userInfo');\n    }\n  },\n  actions: {\n    // 用户注册\n    async register(_, user) {\n      const response = await api.post('/user/register', user);\n      return response.data;\n    },\n    // 用户登录\n    async login({\n      commit\n    }, credentials) {\n      const response = await api.post('/user/login', credentials);\n      const {\n        token,\n        ...userInfo\n      } = response.data;\n\n      // 保存token和用户信息\n      commit('setToken', token);\n      commit('setUser', userInfo);\n      return userInfo;\n    },\n    // 用户登出\n    logout({\n      commit\n    }) {\n      // 清除认证信息\n      commit('clearAuth');\n      return Promise.resolve();\n    },\n    // 获取用户信息\n    async getUserInfo({\n      commit\n    }) {\n      const response = await api.get('/user/info');\n      commit('setUser', response.data);\n      return response.data;\n    }\n  },\n  modules: {\n    user\n  }\n});\nexport default store;\nexport { api };","map":{"version":3,"names":["createStore","axios","router","user","api","create","baseURL","process","env","VUE_APP_API_URL","timeout","interceptors","request","use","config","token","localStorage","getItem","headers","error","Promise","reject","response","data","status","store","commit","push","state","userInfo","JSON","parse","getters","isLoggedIn","userRole","role","mutations","setToken","setItem","setUser","stringify","clearAuth","removeItem","actions","register","_","post","login","credentials","logout","resolve","getUserInfo","get","modules"],"sources":["C:/Users/18083/Desktop/CCIT/TCRSystem/TCRSystem/frontend/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\r\nimport axios from 'axios'\r\nimport router from '@/router'\r\nimport user from './modules/user'\r\n\r\n// 创建axios实例\r\nconst api = axios.create({\r\n  baseURL: process.env.VUE_APP_API_URL || '/api',\r\n  timeout: 10000\r\n})\r\n\r\n// 请求拦截器\r\napi.interceptors.request.use(\r\n  config => {\r\n    const token = localStorage.getItem('token')\r\n    if (token) {\r\n      config.headers['Authorization'] = token\r\n    }\r\n    return config\r\n  },\r\n  error => {\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\n// 响应拦截器\r\napi.interceptors.response.use(\r\n  response => {\r\n    return response.data\r\n  },\r\n  error => {\r\n    if (error.response && error.response.status === 401) {\r\n      // 401 清除token信息并跳转到登录页面\r\n      store.commit('clearAuth')\r\n      router.push('/login')\r\n    }\r\n    return Promise.reject(error.response ? error.response.data : error)\r\n  }\r\n)\r\n\r\nconst store = createStore({\r\n  state: {\r\n    token: localStorage.getItem('token') || '',\r\n    userInfo: JSON.parse(localStorage.getItem('userInfo') || '{}')\r\n  },\r\n  getters: {\r\n    isLoggedIn: state => !!state.token,\r\n    userRole: state => state.userInfo.role || -1,\r\n    userInfo: state => state.userInfo,\r\n    token: state => state.token\r\n  },\r\n  mutations: {\r\n    setToken(state, token) {\r\n      state.token = token\r\n      localStorage.setItem('token', token)\r\n    },\r\n    setUser(state, user) {\r\n      state.userInfo = user\r\n      localStorage.setItem('userInfo', JSON.stringify(user))\r\n    },\r\n    clearAuth(state) {\r\n      state.token = ''\r\n      state.userInfo = {}\r\n      localStorage.removeItem('token')\r\n      localStorage.removeItem('userInfo')\r\n    }\r\n  },\r\n  actions: {\r\n    // 用户注册\r\n    async register(_, user) {\r\n      const response = await api.post('/user/register', user)\r\n      return response.data\r\n    },\r\n    \r\n    // 用户登录\r\n    async login({ commit }, credentials) {\r\n      const response = await api.post('/user/login', credentials)\r\n      const { token, ...userInfo } = response.data\r\n      \r\n      // 保存token和用户信息\r\n      commit('setToken', token)\r\n      commit('setUser', userInfo)\r\n      \r\n      return userInfo\r\n    },\r\n    \r\n    // 用户登出\r\n    logout({ commit }) {\r\n      // 清除认证信息\r\n      commit('clearAuth')\r\n      return Promise.resolve()\r\n    },\r\n    \r\n    // 获取用户信息\r\n    async getUserInfo({ commit }) {\r\n      const response = await api.get('/user/info')\r\n      commit('setUser', response.data)\r\n      return response.data\r\n    }\r\n  },\r\n  modules: {\r\n    user\r\n  }\r\n})\r\n\r\nexport default store\r\nexport { api } "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}