{"ast":null,"code":"import { ref, reactive, onMounted, computed } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport '@element-plus/icons-vue';\nimport axios from 'axios';\nexport default {\n  __name: 'AssignmentSubmissions',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const router = useRouter();\n\n    // 状态变量\n    const loading = ref(false);\n    const submitting = ref(false);\n    const submissionList = ref([]);\n    const total = ref(0);\n    const assignmentInfo = ref(null);\n    const statistics = ref(null);\n    const gradeDialogVisible = ref(false);\n    const currentSubmission = ref(null);\n\n    // 查询参数\n    const queryParams = reactive({\n      current: 1,\n      pageSize: 10,\n      assignmentId: null,\n      status: null\n    });\n\n    // 评分表单\n    const gradeFormRef = ref(null);\n    const gradeForm = reactive({\n      id: null,\n      score: 0,\n      comment: ''\n    });\n\n    // 表单校验规则\n    const rules = {\n      score: [{\n        required: true,\n        message: '请输入分数',\n        trigger: 'blur'\n      }]\n    };\n\n    // 计算属性\n    const title = computed(() => {\n      return route.query.title ? `作业: ${route.query.title}` : '作业提交列表';\n    });\n\n    // 获取作业状态类型\n    const getStatusType = status => {\n      switch (status) {\n        case 0:\n          return 'danger';\n        // 已关闭\n        case 1:\n          return 'primary';\n        // 进行中\n        case 2:\n          return 'success';\n        // 已结束\n        default:\n          return 'info';\n      }\n    };\n\n    // 获取作业状态文本\n    const getStatusText = status => {\n      switch (status) {\n        case 0:\n          return '已关闭';\n        case 1:\n          return '进行中';\n        case 2:\n          return '已结束';\n        default:\n          return '未知';\n      }\n    };\n\n    // 获取提交状态类型\n    const getSubmissionStatusType = status => {\n      switch (status) {\n        case 0:\n          return 'warning';\n        // 已提交\n        case 1:\n          return 'success';\n        // 已批改\n        default:\n          return 'info';\n      }\n    };\n\n    // 获取提交状态文本\n    const getSubmissionStatusText = status => {\n      switch (status) {\n        case 0:\n          return '已提交';\n        case 1:\n          return '已批改';\n        default:\n          return '未知';\n      }\n    };\n\n    // 返回上一页\n    const goBack = () => {\n      router.go(-1);\n    };\n\n    // 获取作业信息\n    const fetchAssignmentInfo = async () => {\n      try {\n        const assignmentId = route.query.assignmentId;\n        if (!assignmentId) {\n          ElMessage.warning('未指定作业ID');\n          return;\n        }\n        const response = await axios.get(`/api/assignment/${assignmentId}`);\n        if (response.data.code === 200) {\n          assignmentInfo.value = response.data.data;\n        } else {\n          ElMessage.error(response.data.message || '获取作业信息失败');\n        }\n      } catch (error) {\n        console.error('获取作业信息失败:', error);\n        ElMessage.error('获取作业信息失败');\n      }\n    };\n\n    // 获取提交统计\n    const fetchSubmissionStatistics = async () => {\n      try {\n        const assignmentId = route.query.assignmentId;\n        if (!assignmentId) return;\n        const response = await axios.get(`/api/assignment/submission/statistics/${assignmentId}`);\n        if (response.data.code === 200) {\n          statistics.value = response.data.data;\n        }\n      } catch (error) {\n        console.error('获取提交统计失败:', error);\n        ElMessage.error('获取提交统计失败');\n      }\n    };\n\n    // 获取提交列表\n    const fetchSubmissions = async () => {\n      loading.value = true;\n      try {\n        const assignmentId = route.query.assignmentId;\n        if (!assignmentId) {\n          ElMessage.warning('未指定作业ID');\n          loading.value = false;\n          return;\n        }\n        queryParams.assignmentId = assignmentId;\n        const params = {\n          current: queryParams.current,\n          size: queryParams.pageSize,\n          assignmentId: queryParams.assignmentId,\n          status: queryParams.status\n        };\n        const response = await axios.get('/api/assignment/submission/list', {\n          params\n        });\n        if (response.data.code === 200) {\n          submissionList.value = response.data.data.records || [];\n          total.value = response.data.data.total || 0;\n        } else {\n          ElMessage.error(response.data.message || '获取提交列表失败');\n        }\n      } catch (error) {\n        console.error('获取提交列表失败:', error);\n        ElMessage.error('获取提交列表失败：' + (error.response?.data?.message || error.message));\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 重置查询\n    const resetQuery = () => {\n      queryParams.status = null;\n      queryParams.current = 1;\n      fetchSubmissions();\n    };\n\n    // 处理页码变化\n    const handleCurrentChange = current => {\n      queryParams.current = current;\n      fetchSubmissions();\n    };\n\n    // 处理每页条数变化\n    const handleSizeChange = size => {\n      queryParams.pageSize = size;\n      queryParams.current = 1;\n      fetchSubmissions();\n    };\n\n    // 打开批改对话框\n    const openGradeDialog = submission => {\n      currentSubmission.value = submission;\n\n      // 初始化表单\n      gradeForm.id = submission.id;\n      gradeForm.score = submission.score !== null && submission.score !== undefined ? submission.score : 0;\n      gradeForm.comment = submission.comment || '';\n\n      // 打开对话框\n      gradeDialogVisible.value = true;\n\n      // 重置表单验证\n      setTimeout(() => {\n        gradeFormRef.value?.clearValidate();\n      }, 0);\n    };\n\n    // 提交评分\n    const submitGrade = async () => {\n      if (!gradeFormRef.value) return;\n      await gradeFormRef.value.validate(async valid => {\n        if (!valid) {\n          return false;\n        }\n        submitting.value = true;\n        try {\n          const params = {\n            id: gradeForm.id,\n            score: gradeForm.score,\n            comment: gradeForm.comment\n          };\n          const response = await axios.post('/api/assignment/grade', null, {\n            params\n          });\n          if (response.data.code === 200) {\n            ElMessage.success('评分提交成功');\n            gradeDialogVisible.value = false;\n\n            // 更新本地数据\n            const index = submissionList.value.findIndex(item => item.id === gradeForm.id);\n            if (index !== -1) {\n              submissionList.value[index].score = gradeForm.score;\n              submissionList.value[index].comment = gradeForm.comment;\n              submissionList.value[index].status = 2; // 已批改\n            }\n\n            // 重新获取统计数据\n            fetchSubmissionStatistics();\n          } else {\n            ElMessage.error(response.data.message || '评分提交失败');\n          }\n        } catch (error) {\n          console.error('评分提交失败:', error);\n          ElMessage.error('评分提交失败：' + (error.response?.data?.message || error.message));\n        } finally {\n          submitting.value = false;\n        }\n      });\n    };\n\n    // 页面加载时获取数据\n    onMounted(async () => {\n      await fetchAssignmentInfo();\n      await fetchSubmissions();\n      await fetchSubmissionStatistics();\n    });\n    const __returned__ = {\n      route,\n      router,\n      loading,\n      submitting,\n      submissionList,\n      total,\n      assignmentInfo,\n      statistics,\n      gradeDialogVisible,\n      currentSubmission,\n      queryParams,\n      gradeFormRef,\n      gradeForm,\n      rules,\n      title,\n      getStatusType,\n      getStatusText,\n      getSubmissionStatusType,\n      getSubmissionStatusText,\n      goBack,\n      fetchAssignmentInfo,\n      fetchSubmissionStatistics,\n      fetchSubmissions,\n      resetQuery,\n      handleCurrentChange,\n      handleSizeChange,\n      openGradeDialog,\n      submitGrade,\n      ref,\n      reactive,\n      onMounted,\n      computed,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","computed","useRoute","useRouter","ElMessage","axios","route","router","loading","submitting","submissionList","total","assignmentInfo","statistics","gradeDialogVisible","currentSubmission","queryParams","current","pageSize","assignmentId","status","gradeFormRef","gradeForm","id","score","comment","rules","required","message","trigger","title","query","getStatusType","getStatusText","getSubmissionStatusType","getSubmissionStatusText","goBack","go","fetchAssignmentInfo","warning","response","get","data","code","value","error","console","fetchSubmissionStatistics","fetchSubmissions","params","size","records","resetQuery","handleCurrentChange","handleSizeChange","openGradeDialog","submission","undefined","setTimeout","clearValidate","submitGrade","validate","valid","post","success","index","findIndex","item"],"sources":["C:/Users/18083/Desktop/CCIT/TCRSystem/TCRSystem/frontend/src/views/teacher/AssignmentSubmissions.vue"],"sourcesContent":["<template>\r\n  <div class=\"assignment-submissions-container\">\r\n    <div class=\"page-header\">\r\n      <div class=\"title-section\">\r\n        <el-button @click=\"goBack\" icon=\"ArrowLeft\" circle plain></el-button>\r\n        <h1>{{ title || '作业提交列表' }}</h1>\r\n      </div>\r\n      <div class=\"info-section\" v-if=\"assignmentInfo\">\r\n        <el-tag :type=\"getStatusType(assignmentInfo.status)\">{{ getStatusText(assignmentInfo.status) }}</el-tag>\r\n        <span>所属课程: {{ assignmentInfo.courseName }}</span>\r\n        <span>截止时间: {{ assignmentInfo.deadline }}</span>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 统计卡片 -->\r\n    <el-card class=\"statistics-card\" v-if=\"statistics\">\r\n      <div class=\"statistics-row\">\r\n        <div class=\"stat-box\">\r\n          <div class=\"stat-value\">{{ statistics.totalStudents || 0 }}</div>\r\n          <div class=\"stat-label\">学生总数</div>\r\n        </div>\r\n        <div class=\"stat-box\">\r\n          <div class=\"stat-value\">{{ statistics.submittedCount || 0 }}</div>\r\n          <div class=\"stat-label\">已提交</div>\r\n        </div>\r\n        <div class=\"stat-box\">\r\n          <div class=\"stat-value\">{{ statistics.submissionRate || '0%' }}</div>\r\n          <div class=\"stat-label\">提交率</div>\r\n        </div>\r\n        <div class=\"stat-box\">\r\n          <div class=\"stat-value\">{{ statistics.gradedCount || 0 }}</div>\r\n          <div class=\"stat-label\">已批改</div>\r\n        </div>\r\n        <div class=\"stat-box\">\r\n          <div class=\"stat-value\">{{ statistics.gradingRate || '0%' }}</div>\r\n          <div class=\"stat-label\">批改率</div>\r\n        </div>\r\n        <div class=\"stat-box\">\r\n          <div class=\"stat-value\">{{ statistics.avgScore || '暂无' }}</div>\r\n          <div class=\"stat-label\">平均分</div>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n    \r\n    <!-- 过滤器 -->\r\n    <el-card class=\"filter-card\">\r\n      <el-form :inline=\"true\" :model=\"queryParams\" class=\"filter-form\">\r\n        <el-form-item label=\"状态\">\r\n          <el-select \r\n            v-model=\"queryParams.status\" \r\n            placeholder=\"选择状态\" \r\n            clearable \r\n            style=\"width: 120px;\"\r\n          >\r\n            <el-option label=\"已提交\" :value=\"0\"></el-option>\r\n            <el-option label=\"已批改\" :value=\"1\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"fetchSubmissions\">查询</el-button>\r\n          <el-button @click=\"resetQuery\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-card>\r\n    \r\n    <!-- 提交列表 -->\r\n    <el-card v-loading=\"loading\" class=\"submissions-card\">\r\n      <div class=\"empty-tip\" v-if=\"!submissionList.length && !loading\">\r\n        <el-empty description=\"暂无符合条件的作业提交\"></el-empty>\r\n      </div>\r\n      \r\n      <el-table \r\n        v-else \r\n        :data=\"submissionList\" \r\n        style=\"width: 100%\"\r\n        border\r\n      >\r\n        <el-table-column prop=\"studentName\" label=\"学生姓名\" width=\"120\" />\r\n        <el-table-column prop=\"studentId\" label=\"学号\" width=\"100\" />\r\n        <el-table-column prop=\"courseName\" label=\"所属课程\" width=\"150\" show-overflow-tooltip />\r\n        <el-table-column prop=\"content\" label=\"提交内容\" min-width=\"200\" show-overflow-tooltip>\r\n          <template #default=\"scope\">\r\n            <div v-if=\"scope.row.content\" class=\"submission-content\">{{ scope.row.content }}</div>\r\n            <div v-else class=\"submission-content empty\">无文本内容</div>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"fileName\" label=\"提交文件\" width=\"180\" show-overflow-tooltip>\r\n          <template #default=\"scope\">\r\n            <el-link \r\n              v-if=\"scope.row.filePath\" \r\n              :href=\"`/api/assignment/submission/download/${scope.row.id}`\" \r\n              target=\"_blank\"\r\n              type=\"primary\"\r\n            >\r\n              {{ scope.row.fileName || '下载文件' }}\r\n            </el-link>\r\n            <span v-else>无文件</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"getSubmissionStatusType(scope.row.status)\">\r\n              {{ getSubmissionStatusText(scope.row.status) }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"isOverdue\" label=\"是否逾期\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"scope.row.isOverdue ? 'danger' : 'success'\" size=\"small\">\r\n              {{ scope.row.isOverdue ? '已逾期' : '按时提交' }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"score\" label=\"得分\" width=\"80\" align=\"center\">\r\n          <template #default=\"scope\">\r\n            {{ scope.row.score !== null && scope.row.score !== undefined ? scope.row.score : '未批改' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"createTime\" label=\"提交时间\" width=\"180\" />\r\n        <el-table-column label=\"操作\" width=\"120\" fixed=\"right\">\r\n          <template #default=\"scope\">\r\n            <el-button \r\n              type=\"primary\" \r\n              size=\"small\" \r\n              plain\r\n              @click=\"openGradeDialog(scope.row)\"\r\n            >批改</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      \r\n      <div class=\"pagination-container\">\r\n        <el-pagination\r\n          background\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"total\"\r\n          :page-sizes=\"[10, 20, 50, 100]\"\r\n          :page-size=\"queryParams.pageSize\"\r\n          :current-page=\"queryParams.current\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n    \r\n    <!-- 批改对话框 -->\r\n    <el-dialog\r\n      v-model=\"gradeDialogVisible\"\r\n      title=\"批改作业\"\r\n      width=\"600px\"\r\n      :close-on-click-modal=\"false\"\r\n    >\r\n      <div v-if=\"currentSubmission\" class=\"grading-form\">\r\n        <div class=\"submission-info\">\r\n          <h3>提交信息</h3>\r\n          \r\n          <div class=\"info-row\">\r\n            <div class=\"info-label\">学生</div>\r\n            <div class=\"info-value\">{{ currentSubmission.studentName }} ({{ currentSubmission.studentId }})</div>\r\n          </div>\r\n          \r\n          <div class=\"info-row\">\r\n            <div class=\"info-label\">提交内容</div>\r\n            <div class=\"info-value content\">\r\n              <div v-if=\"currentSubmission.content\" class=\"content-text\">{{ currentSubmission.content }}</div>\r\n              <div v-else class=\"content-text empty\">无文本内容</div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"info-row\" v-if=\"currentSubmission.filePath\">\r\n            <div class=\"info-label\">提交文件</div>\r\n            <div class=\"info-value\">\r\n              <el-link \r\n                :href=\"`/api/assignment/submission/download/${currentSubmission.id}`\" \r\n                target=\"_blank\"\r\n                type=\"primary\"\r\n              >\r\n                {{ currentSubmission.fileName || '下载文件' }}\r\n              </el-link>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"info-row\">\r\n            <div class=\"info-label\">提交时间</div>\r\n            <div class=\"info-value\">\r\n              {{ currentSubmission.createTime }}\r\n              <el-tag \r\n                :type=\"currentSubmission.isOverdue ? 'danger' : 'success'\" \r\n                size=\"small\" \r\n                style=\"margin-left: 10px;\"\r\n              >\r\n                {{ currentSubmission.isOverdue ? '已逾期' : '按时提交' }}\r\n              </el-tag>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"grading-section\">\r\n          <h3>评分</h3>\r\n          \r\n          <el-form :model=\"gradeForm\" :rules=\"rules\" ref=\"gradeFormRef\" label-width=\"80px\">\r\n            <el-form-item label=\"得分\" prop=\"score\">\r\n              <el-input-number \r\n                v-model=\"gradeForm.score\" \r\n                :min=\"0\" \r\n                :max=\"assignmentInfo?.maxScore || 100\" \r\n                :step=\"1\"\r\n                style=\"width: 120px;\"\r\n              />\r\n              <span class=\"score-hint\">满分: {{ assignmentInfo?.maxScore || 100 }}</span>\r\n            </el-form-item>\r\n            \r\n            <el-form-item label=\"评语\" prop=\"comment\">\r\n              <el-input \r\n                v-model=\"gradeForm.comment\" \r\n                type=\"textarea\" \r\n                :rows=\"4\" \r\n                placeholder=\"请输入评语\" \r\n              />\r\n            </el-form-item>\r\n          </el-form>\r\n        </div>\r\n      </div>\r\n      \r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"gradeDialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"submitGrade\" :loading=\"submitting\">提交评分</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport {  } from '@element-plus/icons-vue'\r\nimport axios from 'axios'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\n// 状态变量\r\nconst loading = ref(false)\r\nconst submitting = ref(false)\r\nconst submissionList = ref([])\r\nconst total = ref(0)\r\nconst assignmentInfo = ref(null)\r\nconst statistics = ref(null)\r\nconst gradeDialogVisible = ref(false)\r\nconst currentSubmission = ref(null)\r\n\r\n// 查询参数\r\nconst queryParams = reactive({\r\n  current: 1,\r\n  pageSize: 10,\r\n  assignmentId: null,\r\n  status: null\r\n})\r\n\r\n// 评分表单\r\nconst gradeFormRef = ref(null)\r\nconst gradeForm = reactive({\r\n  id: null,\r\n  score: 0,\r\n  comment: ''\r\n})\r\n\r\n// 表单校验规则\r\nconst rules = {\r\n  score: [\r\n    { required: true, message: '请输入分数', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\n// 计算属性\r\nconst title = computed(() => {\r\n  return route.query.title ? `作业: ${route.query.title}` : '作业提交列表'\r\n})\r\n\r\n// 获取作业状态类型\r\nconst getStatusType = (status) => {\r\n  switch (status) {\r\n    case 0: return 'danger'   // 已关闭\r\n    case 1: return 'primary'  // 进行中\r\n    case 2: return 'success'  // 已结束\r\n    default: return 'info'\r\n  }\r\n}\r\n\r\n// 获取作业状态文本\r\nconst getStatusText = (status) => {\r\n  switch (status) {\r\n    case 0: return '已关闭'\r\n    case 1: return '进行中'\r\n    case 2: return '已结束'\r\n    default: return '未知'\r\n  }\r\n}\r\n\r\n// 获取提交状态类型\r\nconst getSubmissionStatusType = (status) => {\r\n  switch (status) {\r\n    case 0: return 'warning' // 已提交\r\n    case 1: return 'success' // 已批改\r\n    default: return 'info'\r\n  }\r\n}\r\n\r\n// 获取提交状态文本\r\nconst getSubmissionStatusText = (status) => {\r\n  switch (status) {\r\n    case 0: return '已提交'\r\n    case 1: return '已批改'\r\n    default: return '未知'\r\n  }\r\n}\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  router.go(-1)\r\n}\r\n\r\n// 获取作业信息\r\nconst fetchAssignmentInfo = async () => {\r\n  try {\r\n    const assignmentId = route.query.assignmentId\r\n    if (!assignmentId) {\r\n      ElMessage.warning('未指定作业ID')\r\n      return\r\n    }\r\n    \r\n    const response = await axios.get(`/api/assignment/${assignmentId}`)\r\n    if (response.data.code === 200) {\r\n      assignmentInfo.value = response.data.data\r\n    } else {\r\n      ElMessage.error(response.data.message || '获取作业信息失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取作业信息失败:', error)\r\n    ElMessage.error('获取作业信息失败')\r\n  }\r\n}\r\n\r\n// 获取提交统计\r\nconst fetchSubmissionStatistics = async () => {\r\n  try {\r\n    const assignmentId = route.query.assignmentId\r\n    if (!assignmentId) return\r\n    \r\n    const response = await axios.get(`/api/assignment/submission/statistics/${assignmentId}`)\r\n    if (response.data.code === 200) {\r\n      statistics.value = response.data.data\r\n    }\r\n  } catch (error) {\r\n    console.error('获取提交统计失败:', error)\r\n    ElMessage.error('获取提交统计失败')\r\n  }\r\n}\r\n\r\n// 获取提交列表\r\nconst fetchSubmissions = async () => {\r\n  loading.value = true\r\n  try {\r\n    const assignmentId = route.query.assignmentId\r\n    if (!assignmentId) {\r\n      ElMessage.warning('未指定作业ID')\r\n      loading.value = false\r\n      return\r\n    }\r\n    \r\n    queryParams.assignmentId = assignmentId\r\n    \r\n    const params = {\r\n      current: queryParams.current,\r\n      size: queryParams.pageSize,\r\n      assignmentId: queryParams.assignmentId,\r\n      status: queryParams.status\r\n    }\r\n    \r\n    const response = await axios.get('/api/assignment/submission/list', { params })\r\n    \r\n    if (response.data.code === 200) {\r\n      submissionList.value = response.data.data.records || []\r\n      total.value = response.data.data.total || 0\r\n    } else {\r\n      ElMessage.error(response.data.message || '获取提交列表失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取提交列表失败:', error)\r\n    ElMessage.error('获取提交列表失败：' + (error.response?.data?.message || error.message))\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 重置查询\r\nconst resetQuery = () => {\r\n  queryParams.status = null\r\n  queryParams.current = 1\r\n  fetchSubmissions()\r\n}\r\n\r\n// 处理页码变化\r\nconst handleCurrentChange = (current) => {\r\n  queryParams.current = current\r\n  fetchSubmissions()\r\n}\r\n\r\n// 处理每页条数变化\r\nconst handleSizeChange = (size) => {\r\n  queryParams.pageSize = size\r\n  queryParams.current = 1\r\n  fetchSubmissions()\r\n}\r\n\r\n// 打开批改对话框\r\nconst openGradeDialog = (submission) => {\r\n  currentSubmission.value = submission\r\n  \r\n  // 初始化表单\r\n  gradeForm.id = submission.id\r\n  gradeForm.score = submission.score !== null && submission.score !== undefined ? submission.score : 0\r\n  gradeForm.comment = submission.comment || ''\r\n  \r\n  // 打开对话框\r\n  gradeDialogVisible.value = true\r\n  \r\n  // 重置表单验证\r\n  setTimeout(() => {\r\n    gradeFormRef.value?.clearValidate()\r\n  }, 0)\r\n}\r\n\r\n// 提交评分\r\nconst submitGrade = async () => {\r\n  if (!gradeFormRef.value) return\r\n  \r\n  await gradeFormRef.value.validate(async (valid) => {\r\n    if (!valid) {\r\n      return false\r\n    }\r\n    \r\n    submitting.value = true\r\n    try {\r\n      const params = {\r\n        id: gradeForm.id,\r\n        score: gradeForm.score,\r\n        comment: gradeForm.comment\r\n      }\r\n      \r\n      const response = await axios.post('/api/assignment/grade', null, { params })\r\n      \r\n      if (response.data.code === 200) {\r\n        ElMessage.success('评分提交成功')\r\n        gradeDialogVisible.value = false\r\n        \r\n        // 更新本地数据\r\n        const index = submissionList.value.findIndex(item => item.id === gradeForm.id)\r\n        if (index !== -1) {\r\n          submissionList.value[index].score = gradeForm.score\r\n          submissionList.value[index].comment = gradeForm.comment\r\n          submissionList.value[index].status = 2 // 已批改\r\n        }\r\n        \r\n        // 重新获取统计数据\r\n        fetchSubmissionStatistics()\r\n      } else {\r\n        ElMessage.error(response.data.message || '评分提交失败')\r\n      }\r\n    } catch (error) {\r\n      console.error('评分提交失败:', error)\r\n      ElMessage.error('评分提交失败：' + (error.response?.data?.message || error.message))\r\n    } finally {\r\n      submitting.value = false\r\n    }\r\n  })\r\n}\r\n\r\n// 页面加载时获取数据\r\nonMounted(async () => {\r\n  await fetchAssignmentInfo()\r\n  await fetchSubmissions()\r\n  await fetchSubmissionStatistics()\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.assignment-submissions-container {\r\n  padding: 20px;\r\n  \r\n  .page-header {\r\n    margin-bottom: 20px;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    flex-wrap: wrap;\r\n    gap: 10px;\r\n    \r\n    .title-section {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 10px;\r\n      \r\n      h1 {\r\n        margin: 0;\r\n        font-size: 22px;\r\n        font-weight: 500;\r\n        color: #303133;\r\n      }\r\n    }\r\n    \r\n    .info-section {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 15px;\r\n      color: #606266;\r\n    }\r\n  }\r\n  \r\n  .statistics-card {\r\n    margin-bottom: 20px;\r\n    \r\n    .statistics-row {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      flex-wrap: wrap;\r\n      gap: 10px;\r\n      \r\n      .stat-box {\r\n        padding: 10px 15px;\r\n        text-align: center;\r\n        flex: 1;\r\n        min-width: 100px;\r\n        \r\n        .stat-value {\r\n          font-size: 22px;\r\n          font-weight: bold;\r\n          color: #409EFF;\r\n          margin-bottom: 5px;\r\n        }\r\n        \r\n        .stat-label {\r\n          font-size: 14px;\r\n          color: #909399;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  .filter-card {\r\n    margin-bottom: 20px;\r\n  }\r\n  \r\n  .submissions-card {\r\n    .empty-tip {\r\n      padding: 30px 0;\r\n    }\r\n    \r\n    .submission-content {\r\n      max-height: 60px;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      display: -webkit-box;\r\n      -webkit-line-clamp: 3;\r\n      -webkit-box-orient: vertical;\r\n      \r\n      &.empty {\r\n        color: #909399;\r\n        font-style: italic;\r\n      }\r\n    }\r\n    \r\n    .pagination-container {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      margin-top: 20px;\r\n    }\r\n  }\r\n  \r\n  .grading-form {\r\n    .submission-info {\r\n      margin-bottom: 20px;\r\n      \r\n      h3 {\r\n        font-size: 16px;\r\n        font-weight: 500;\r\n        margin-bottom: 15px;\r\n        color: #303133;\r\n        border-bottom: 1px solid #EBEEF5;\r\n        padding-bottom: 10px;\r\n      }\r\n      \r\n      .info-row {\r\n        display: flex;\r\n        margin-bottom: 15px;\r\n        \r\n        .info-label {\r\n          width: 80px;\r\n          color: #606266;\r\n          font-weight: 500;\r\n        }\r\n        \r\n        .info-value {\r\n          flex: 1;\r\n          \r\n          &.content {\r\n            .content-text {\r\n              padding: 10px;\r\n              background-color: #f9f9f9;\r\n              border-radius: 4px;\r\n              max-height: 100px;\r\n              overflow-y: auto;\r\n              \r\n              &.empty {\r\n                color: #909399;\r\n                font-style: italic;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    .grading-section {\r\n      h3 {\r\n        font-size: 16px;\r\n        font-weight: 500;\r\n        margin-bottom: 15px;\r\n        color: #303133;\r\n        border-bottom: 1px solid #EBEEF5;\r\n        padding-bottom: 10px;\r\n      }\r\n      \r\n      .score-hint {\r\n        margin-left: 10px;\r\n        color: #909399;\r\n        font-size: 14px;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}