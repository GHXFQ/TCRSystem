{"ast":null,"code":"import { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport axios from 'axios';\nimport { HomeFilled, Document, Upload, ArrowDown, Reading, Connection, Calendar, ChatDotRound } from '@element-plus/icons-vue';\nexport default {\n  __name: 'TeacherLayout',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const userInfo = ref(JSON.parse(localStorage.getItem('userInfo') || '{}'));\n    const avatarUrl = ref('');\n\n    // 处理头像路径，确保使用正确的服务器地址\n    const getFullAvatarUrl = path => {\n      if (!path) return '';\n      // 如果已经是完整URL，则直接返回\n      if (path.startsWith('http')) {\n        return path;\n      }\n      // 否则拼接后端地址\n      return `http://localhost:8080${path}`;\n    };\n\n    // 初始化用户头像\n    if (userInfo.value.avatar) {\n      avatarUrl.value = getFullAvatarUrl(userInfo.value.avatar);\n    }\n    const handleCommand = async command => {\n      if (command === 'profile') {\n        // 跳转到个人信息页面\n        router.push('/profile');\n      } else if (command === 'logout') {\n        try {\n          // 发送退出登录请求\n          await axios.post('/api/user/logout', null, {\n            headers: {\n              Authorization: localStorage.getItem('token')\n            }\n          });\n\n          // 清除本地存储的用户信息和token\n          localStorage.removeItem('token');\n          localStorage.removeItem('userInfo');\n          ElMessage.success('退出成功');\n          router.push('/login');\n        } catch (error) {\n          console.error('退出失败:', error);\n\n          // 即使请求失败，也清除本地存储并跳转到登录页\n          localStorage.removeItem('token');\n          localStorage.removeItem('userInfo');\n          router.push('/login');\n        }\n      }\n    };\n    const __returned__ = {\n      router,\n      userInfo,\n      avatarUrl,\n      getFullAvatarUrl,\n      handleCommand,\n      ref,\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get axios() {\n        return axios;\n      },\n      get HomeFilled() {\n        return HomeFilled;\n      },\n      get Document() {\n        return Document;\n      },\n      get Upload() {\n        return Upload;\n      },\n      get ArrowDown() {\n        return ArrowDown;\n      },\n      get Reading() {\n        return Reading;\n      },\n      get Connection() {\n        return Connection;\n      },\n      get Calendar() {\n        return Calendar;\n      },\n      get ChatDotRound() {\n        return ChatDotRound;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","useRouter","ElMessage","axios","HomeFilled","Document","Upload","ArrowDown","Reading","Connection","Calendar","ChatDotRound","router","userInfo","JSON","parse","localStorage","getItem","avatarUrl","getFullAvatarUrl","path","startsWith","value","avatar","handleCommand","command","push","post","headers","Authorization","removeItem","success","error","console"],"sources":["C:/Users/18083/Desktop/CCIT/TCRSystem/TCRSystem/frontend/src/layouts/TeacherLayout.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n  <el-container class=\"layout-container\">\n    <el-aside width=\"220px\">\n      <el-menu\n        :router=\"true\"\n        :default-active=\"$route.path\"\n        class=\"el-menu-vertical\"\n        background-color=\"#304156\"\n        text-color=\"#bfcbd9\"\n        active-text-color=\"#409EFF\"\n      >\n        <div class=\"logo-container\">\n          <h1 class=\"logo-text\">教学资源管理系统</h1>\n          <div class=\"sub-title\">教师端</div>\n        </div>\n        <el-menu-item index=\"/teacher/home\">\n          <el-icon><HomeFilled /></el-icon>\n          <span>首页</span>\n        </el-menu-item>\n        <el-menu-item index=\"/teacher/course-management\">\n          <el-icon><Reading /></el-icon>\n          <span>课程管理</span>\n        </el-menu-item>\n        <el-menu-item index=\"/teacher/material-upload\">\n          <el-icon><Upload /></el-icon>\n          <span>材料上传</span>\n        </el-menu-item>\n        <el-menu-item index=\"/teacher/material-review\">\n          <el-icon><Document /></el-icon>\n          <span>材料审核</span>\n        </el-menu-item>\n        <el-menu-item index=\"/teacher/resource-sharing\">\n          <el-icon><Connection /></el-icon>\n          <span>课程资源协同</span>\n        </el-menu-item>\n        <el-menu-item index=\"/teacher/assignment-management\">\n          <el-icon><Calendar /></el-icon>\n          <span>课程任务管理</span>\n        </el-menu-item>\n        <el-menu-item index=\"/teacher/course-feedback\">\n          <el-icon><ChatDotRound /></el-icon>\n          <span>课程反馈</span>\n        </el-menu-item>\n      </el-menu>\n    </el-aside>\n    <el-container>\n      <el-header>\n        <div class=\"breadcrumb\">\n          <el-breadcrumb separator=\"/\">\n            <el-breadcrumb-item :to=\"{ path: '/teacher/home' }\">首页</el-breadcrumb-item>\n            <el-breadcrumb-item v-if=\"$route.meta.title\">{{ $route.meta.title }}</el-breadcrumb-item>\n          </el-breadcrumb>\n        </div>\n        <div class=\"header-right\">\n          <el-dropdown @command=\"handleCommand\">\n            <span class=\"el-dropdown-link\">\n              <img v-if=\"avatarUrl\" :src=\"avatarUrl\" class=\"avatar-image\" alt=\"用户头像\" />\n              <el-avatar v-else :size=\"32\" class=\"user-avatar\">\n                {{ userInfo?.realName?.substring(0, 1) || 'U' }}\n              </el-avatar>\n              <span class=\"username\">{{ userInfo?.realName || '用户' }}</span>\n              <el-icon class=\"el-icon--right\"><ArrowDown /></el-icon>\n            </span>\n            <template #dropdown>\n              <el-dropdown-menu>\n                <el-dropdown-item command=\"profile\">个人信息</el-dropdown-item>\n                <el-dropdown-item command=\"logout\">退出登录</el-dropdown-item>\n              </el-dropdown-menu>\n            </template>\n          </el-dropdown>\n        </div>\n      </el-header>\n      <el-main>\n        <router-view />\n      </el-main>\n      <el-footer>\n        <div class=\"footer-content\">\n          © 2023 教学课程资源管理系统 - 教师端\n        </div>\n      </el-footer>\n    </el-container>\n  </el-container>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport axios from 'axios'\nimport { HomeFilled, Document, Upload, ArrowDown, Reading, Connection, Calendar, ChatDotRound } from '@element-plus/icons-vue'\n\nconst router = useRouter()\n\nconst userInfo = ref(JSON.parse(localStorage.getItem('userInfo') || '{}'))\nconst avatarUrl = ref('')\n\n// 处理头像路径，确保使用正确的服务器地址\nconst getFullAvatarUrl = (path) => {\n  if (!path) return '';\n  // 如果已经是完整URL，则直接返回\n  if (path.startsWith('http')) {\n    return path;\n  }\n  // 否则拼接后端地址\n  return `http://localhost:8080${path}`;\n};\n\n// 初始化用户头像\nif (userInfo.value.avatar) {\n  avatarUrl.value = getFullAvatarUrl(userInfo.value.avatar);\n}\n\nconst handleCommand = async (command) => {\n  if (command === 'profile') {\n    // 跳转到个人信息页面\n    router.push('/profile')\n  } else if (command === 'logout') {\n    try {\n      // 发送退出登录请求\n      await axios.post('/api/user/logout', null, {\n        headers: { Authorization: localStorage.getItem('token') }\n      })\n      \n      // 清除本地存储的用户信息和token\n      localStorage.removeItem('token')\n      localStorage.removeItem('userInfo')\n      \n      ElMessage.success('退出成功')\n      router.push('/login')\n    } catch (error) {\n      console.error('退出失败:', error)\n      \n      // 即使请求失败，也清除本地存储并跳转到登录页\n      localStorage.removeItem('token')\n      localStorage.removeItem('userInfo')\n      router.push('/login')\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.layout-container {\n  height: 100vh;\n\n  .el-aside {\n    background-color: #304156;\n    box-shadow: 2px 0 6px rgba(0, 21, 41, 0.35);\n    \n    .logo-container {\n      height: 80px;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      padding: 10px 0;\n      \n      .logo-text {\n        color: #fff;\n        font-size: 16px;\n        margin: 0;\n        font-weight: 600;\n      }\n      \n      .sub-title {\n        color: #97a8be;\n        font-size: 12px;\n      }\n    }\n    \n    .el-menu-vertical {\n      border-right: none;\n    }\n    \n    .el-menu-item {\n      height: 56px;\n      line-height: 56px;\n      \n      &.is-active {\n        background-color: #263445 !important;\n      }\n      \n      .el-icon {\n        margin-right: 10px;\n      }\n    }\n  }\n\n  .el-header {\n    background-color: #fff;\n    box-shadow: 0 1px 4px rgba(0, 21, 41, 0.08);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 50px !important;\n    \n    .breadcrumb {\n      display: flex;\n      align-items: center;\n    }\n\n    .header-right {\n      display: flex;\n      align-items: center;\n      \n      .el-dropdown-link {\n        display: flex;\n        align-items: center;\n        cursor: pointer;\n        \n        .user-avatar {\n          margin-right: 8px;\n        }\n        \n        .avatar-image {\n          width: 32px;\n          height: 32px;\n          border-radius: 50%;\n          margin-right: 8px;\n          object-fit: cover;\n        }\n        \n        .username {\n          margin-right: 4px;\n        }\n      }\n    }\n  }\n\n  .el-main {\n    background-color: #f0f2f5;\n    padding: 20px;\n    overflow-y: auto;\n  }\n  \n  .el-footer {\n    background-color: #fff;\n    box-shadow: 0 -1px 4px rgba(0, 21, 41, 0.08);\n    text-align: center;\n    padding: 15px 0;\n    \n    .footer-content {\n      color: #606266;\n      font-size: 14px;\n    }\n  }\n}\n</style> "],"mappings":"AAsFA,SAASA,GAAG,QAAQ,KAAI;AACxB,SAASC,SAAS,QAAQ,YAAW;AACrC,SAASC,SAAS,QAAQ,cAAa;AACvC,OAAOC,KAAK,MAAM,OAAM;AACxB,SAASC,UAAU,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAEC,OAAO,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,YAAY,QAAQ,yBAAwB;;;;;;;IAE7H,MAAMC,MAAM,GAAGX,SAAS,CAAC;IAEzB,MAAMY,QAAQ,GAAGb,GAAG,CAACc,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC;IACzE,MAAMC,SAAS,GAAGlB,GAAG,CAAC,EAAE;;IAExB;IACA,MAAMmB,gBAAgB,GAAIC,IAAI,IAAK;MACjC,IAAI,CAACA,IAAI,EAAE,OAAO,EAAE;MACpB;MACA,IAAIA,IAAI,CAACC,UAAU,CAAC,MAAM,CAAC,EAAE;QAC3B,OAAOD,IAAI;MACb;MACA;MACA,OAAO,wBAAwBA,IAAI,EAAE;IACvC,CAAC;;IAED;IACA,IAAIP,QAAQ,CAACS,KAAK,CAACC,MAAM,EAAE;MACzBL,SAAS,CAACI,KAAK,GAAGH,gBAAgB,CAACN,QAAQ,CAACS,KAAK,CAACC,MAAM,CAAC;IAC3D;IAEA,MAAMC,aAAa,GAAG,MAAOC,OAAO,IAAK;MACvC,IAAIA,OAAO,KAAK,SAAS,EAAE;QACzB;QACAb,MAAM,CAACc,IAAI,CAAC,UAAU;MACxB,CAAC,MAAM,IAAID,OAAO,KAAK,QAAQ,EAAE;QAC/B,IAAI;UACF;UACA,MAAMtB,KAAK,CAACwB,IAAI,CAAC,kBAAkB,EAAE,IAAI,EAAE;YACzCC,OAAO,EAAE;cAAEC,aAAa,EAAEb,YAAY,CAACC,OAAO,CAAC,OAAO;YAAE;UAC1D,CAAC;;UAED;UACAD,YAAY,CAACc,UAAU,CAAC,OAAO;UAC/Bd,YAAY,CAACc,UAAU,CAAC,UAAU;UAElC5B,SAAS,CAAC6B,OAAO,CAAC,MAAM;UACxBnB,MAAM,CAACc,IAAI,CAAC,QAAQ;QACtB,CAAC,CAAC,OAAOM,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK;;UAE5B;UACAhB,YAAY,CAACc,UAAU,CAAC,OAAO;UAC/Bd,YAAY,CAACc,UAAU,CAAC,UAAU;UAClClB,MAAM,CAACc,IAAI,CAAC,QAAQ;QACtB;MACF;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}